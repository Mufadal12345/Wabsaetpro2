<!doctype html>
<html lang="ar" dir="rtl" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù…ØªØ­Ù Ø§Ù„ÙÙƒØ± - Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ Ø§Ù„ÙÙƒØ±ÙŠ Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Tajawal', sans-serif;
    }
    
    * {
      scrollbar-width: thin;
      scrollbar-color: rgba(233, 69, 96, 0.5) rgba(255, 255, 255, 0.1);
    }
    
    *::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    *::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
    }
    
    *::-webkit-scrollbar-thumb {
      background: rgba(233, 69, 96, 0.5);
      border-radius: 10px;
    }
    
    *::-webkit-scrollbar-thumb:hover {
      background: rgba(233, 69, 96, 0.7);
    }
    
    .bg-gradient-custom {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
    }
    
    .glass-effect {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .card-hover {
      transition: all 0.3s ease;
    }
    
    .card-hover:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 40px rgba(233, 69, 96, 0.3);
      border-color: rgba(233, 69, 96, 0.5);
    }
    
    .idea-card {
      background: linear-gradient(135deg, rgba(233, 69, 96, 0.1) 0%, rgba(22, 33, 62, 0.8) 100%);
      border: 1px solid rgba(233, 69, 96, 0.3);
    }
    
    .category-badge {
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
      font-weight: 600;
    }
    
    .tab-btn {
      padding: 0.75rem 1.5rem;
      border-radius: 1rem;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid transparent;
    }
    
    .tab-btn:hover {
      background: rgba(233, 69, 96, 0.2);
      border-color: rgba(233, 69, 96, 0.5);
    }
    
    .tab-btn.active {
      background: linear-gradient(135deg, #e94560 0%, #f39c12 100%);
      border-color: transparent;
      box-shadow: 0 4px 15px rgba(233, 69, 96, 0.4);
    }
    
    .sidebar-item {
      padding: 1rem;
      border-radius: 1rem;
      transition: all 0.3s ease;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      background: transparent;
      border: 1px solid transparent;
    }
    
    .sidebar-item:hover {
      background: rgba(233, 69, 96, 0.1);
      border-color: rgba(233, 69, 96, 0.3);
    }
    
    .sidebar-item.active {
      background: linear-gradient(135deg, rgba(233, 69, 96, 0.3) 0%, rgba(243, 156, 18, 0.3) 100%);
      border-color: rgba(233, 69, 96, 0.5);
    }
    
    .modal-backdrop {
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(5px);
    }
    
    .toast {
      animation: slideIn 0.3s ease-out;
    }
    
    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    .line-clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    .line-clamp-3 {
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    .prose {
      max-width: 65ch;
    }
    
    .prose p {
      margin-bottom: 1.25em;
    }
    
    @media (max-width: 768px) {
      .sidebar-hidden {
        transform: translateX(100%);
      }
      
      .sidebar-visible {
        transform: translateX(0);
      }
    }
    
    .tag {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 0.75rem;
      background: rgba(233, 69, 96, 0.2);
      border: 1px solid rgba(233, 69, 96, 0.4);
      border-radius: 9999px;
      font-size: 0.875rem;
    }
    
    .tag button {
      width: 1.25rem;
      height: 1.25rem;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
      transition: all 0.2s;
    }
    
    .tag button:hover {
      background: rgba(233, 69, 96, 0.5);
    }
    
    .sync-indicator {
      transition: all 0.3s ease;
    }
    
    .sync-syncing {
      background: rgba(59, 130, 246, 0.2);
      border-color: rgba(59, 130, 246, 0.5);
    }
    
    .sync-success {
      background: rgba(34, 197, 94, 0.2);
      border-color: rgba(34, 197, 94, 0.5);
    }
    
    .sync-error {
      background: rgba(239, 68, 68, 0.2);
      border-color: rgba(239, 68, 68, 0.5);
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .animate-spin {
      animation: spin 1s linear infinite;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="bg-gradient-custom text-white h-full overflow-x-hidden"><!-- Loading Screen -->
  <div id="loading-screen" class="fixed inset-0 bg-gradient-custom flex items-center justify-center z-50">
   <div class="text-center">
    <div class="text-6xl mb-4 animate-bounce">
     ğŸ›ï¸
    </div>
    <h2 class="text-3xl font-bold mb-2">Ù…ØªØ­Ù Ø§Ù„ÙÙƒØ±</h2>
    <p class="text-gray-400">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
   </div>
  </div><!-- Login Page -->
  <div id="login-page" class="hidden h-full flex items-center justify-center p-4">
   <div class="glass-effect rounded-3xl p-8 max-w-md w-full">
    <div class="text-center mb-8">
     <div class="text-6xl mb-4">
      ğŸ›ï¸
     </div>
     <h1 id="login-title" class="text-4xl font-bold mb-2">Ù…ØªØ­Ù Ø§Ù„ÙÙƒØ±</h1>
     <p id="login-subtitle" class="text-gray-400 mb-1">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ Ø§Ù„ÙÙƒØ±ÙŠ Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</p>
     <p id="login-welcome" class="text-sm text-pink-400">Ø­ÙŠØ« ØªØªØ­ÙˆÙ„ Ø§Ù„Ø£ÙÙƒØ§Ø± Ø¥Ù„Ù‰ Ø¥Ø±Ø« Ø®Ø§Ù„Ø¯</p>
    </div>
    <form id="login-form" class="space-y-4">
     <div><label for="login-name" class="block text-sm font-medium mb-2">Ø§Ù„Ø§Ø³Ù…</label> <input type="text" id="login-name" required class="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:border-pink-500">
     </div>
     <div><label for="login-specialty" class="block text-sm font-medium mb-2">Ø§Ù„ØªØ®ØµØµ / Ø§Ù„Ù…Ø¬Ø§Ù„</label> <input type="text" id="login-specialty" required class="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:border-pink-500">
     </div><button type="submit" id="login-btn" class="w-full py-3 rounded-xl bg-gradient-to-r from-pink-600 to-orange-500 font-bold text-lg hover:opacity-90 transition"> ğŸš€ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…ØªØ­Ù </button>
    </form>
   </div>
  </div><!-- Dashboard -->
  <div id="dashboard" class="hidden h-full w-full"><!-- Sync Status Indicator -->
   <div id="sync-indicator" class="fixed top-4 right-4 z-50 glass-effect rounded-xl px-4 py-2 border-2 flex items-center gap-2 hidden"><span id="sync-icon" class="text-xl"></span> <span id="sync-text" class="text-sm font-medium"></span>
   </div><!-- Mobile Header -->
   <header class="lg:hidden fixed top-0 left-0 right-0 glass-effect border-b border-white/10 z-40 p-4">
    <div class="flex items-center justify-between">
     <div class="flex items-center gap-3">
      <div class="text-3xl">
       ğŸ›ï¸
      </div>
      <div>
       <h1 class="font-bold text-lg">Ù…ØªØ­Ù Ø§Ù„ÙÙƒØ±</h1>
       <p class="text-xs text-gray-400">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹</p>
      </div>
     </div><button id="menu-toggle" class="p-2 rounded-lg bg-white/10 hover:bg-white/20 transition">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
      </svg></button>
    </div>
   </header>
   <div class="flex h-full w-full pt-16 lg:pt-0"><!-- Sidebar -->
    <aside id="sidebar" class="fixed lg:sticky top-16 lg:top-0 right-0 w-80 h-[calc(100%-4rem)] lg:h-full glass-effect border-l border-white/10 p-6 overflow-y-auto z-30 transition-transform duration-300 sidebar-hidden lg:sidebar-visible">
     <div class="mb-8 text-center">
      <div class="text-5xl mb-3">
       ğŸ›ï¸
      </div>
      <h1 id="sidebar-title" class="text-2xl font-bold mb-1">Ù…ØªØ­Ù Ø§Ù„ÙÙƒØ±</h1>
      <p class="text-sm text-gray-400">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ Ø§Ù„ÙÙƒØ±ÙŠ</p>
     </div><!-- User Profile -->
     <div class="glass-effect rounded-2xl p-4 mb-6">
      <div class="flex items-center gap-3 mb-3">
       <div class="w-12 h-12 rounded-full bg-gradient-to-r from-pink-600 to-orange-500 flex items-center justify-center text-2xl" id="user-avatar">
        ğŸ’¡
       </div>
       <div class="flex-1">
        <h3 id="user-name" class="font-bold">Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h3>
        <p id="user-specialty" class="text-sm text-gray-400">Ø§Ù„ØªØ®ØµØµ</p>
       </div>
      </div>
     </div><!-- Navigation -->
     <nav class="space-y-2 mb-6">
      <div class="sidebar-item active" data-section="home" onclick="navigateTo('home')"><span class="text-2xl">ğŸ </span> <span class="font-medium">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
      </div>
      <div class="sidebar-item" data-section="ideas" onclick="navigateTo('ideas')"><span class="text-2xl">ğŸ’¡</span> <span class="font-medium">Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø£ÙÙƒØ§Ø±</span>
      </div>
      <div class="sidebar-item" data-section="trending" onclick="navigateTo('trending')"><span class="text-2xl">ğŸ”¥</span> <span class="font-medium">Ø§Ù„Ø£ÙƒØ«Ø± Ø±ÙˆØ§Ø¬Ø§Ù‹</span>
      </div>
      <div class="sidebar-item" data-section="search" onclick="navigateTo('search')"><span class="text-2xl">ğŸ”</span> <span class="font-medium">Ø§Ù„Ø¨Ø­Ø«</span>
      </div>
      <div class="sidebar-item" data-section="suggestions" onclick="navigateTo('suggestions')"><span class="text-2xl">ğŸ“‹</span> <span class="font-medium">Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª</span> <span id="suggestions-badge" class="hidden mr-auto bg-pink-600 text-white text-xs px-2 py-1 rounded-full">0</span>
      </div>
     </nav><!-- Admin Section -->
     <div class="border-t border-white/10 pt-4 space-y-2 mb-6">
      <div id="members-btn" class="sidebar-item hidden" data-section="members" onclick="navigateTo('members')"><span class="text-2xl">ğŸ‘¥</span> <span class="font-medium">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</span>
      </div>
      <div id="invites-btn" class="sidebar-item hidden" data-section="invites" onclick="navigateTo('invites')"><span class="text-2xl">ğŸ«</span> <span class="font-medium">Ø±Ù…ÙˆØ² Ø§Ù„Ø¯Ø¹ÙˆØ©</span>
      </div>
      <div id="settings-btn" class="sidebar-item hidden" data-section="settings" onclick="navigateTo('settings')"><span class="text-2xl">âš™ï¸</span> <span class="font-medium">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
      </div>
     </div><!-- Admin Stats -->
     <div id="admin-stats-sidebar" class="hidden glass-effect rounded-2xl p-4 mb-6">
      <h3 class="text-sm font-bold mb-3 text-gray-400">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
      <div class="space-y-2 text-sm">
       <div class="flex justify-between"><span>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª:</span> <span id="admin-stats-total" class="font-bold text-pink-400">0</span>
       </div>
       <div class="flex justify-between"><span>Ø§Ù„Ø£ÙÙƒØ§Ø±:</span> <span id="admin-stats-ideas" class="font-bold">0</span>
       </div>
       <div class="flex justify-between"><span>Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡:</span> <span id="admin-stats-members" class="font-bold">0</span>
       </div>
       <div class="flex justify-between"><span>Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª:</span> <span id="admin-stats-suggestions" class="font-bold">0</span>
       </div>
      </div>
     </div><button onclick="logout()" class="w-full py-3 rounded-xl bg-red-600/20 hover:bg-red-600/30 transition border border-red-600/50 font-medium"> ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ </button>
    </aside><!-- Main Content -->
    <main id="main-content" class="flex-1 p-6 lg:p-8 overflow-y-auto h-full w-full"><!-- Home Section -->
     <section id="home-section">
      <div class="mb-8">
       <h2 class="text-4xl font-bold mb-2">Ù…Ø±Ø­Ø¨Ø§Ù‹ ÙÙŠ Ù…ØªØ­Ù Ø§Ù„ÙÙƒØ± ğŸ›ï¸</h2>
       <p class="text-gray-400">Ø­ÙŠØ« ØªØªØ­ÙˆÙ„ Ø§Ù„Ø£ÙÙƒØ§Ø± Ø¥Ù„Ù‰ Ø¥Ø±Ø« Ø®Ø§Ù„Ø¯</p>
      </div><!-- Stats Cards (Admin Only) -->
      <div id="admin-stats-cards" class="hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
       <div class="glass-effect rounded-2xl p-6 card-hover">
        <div class="flex items-center justify-between mb-2"><span class="text-3xl">ğŸ’¡</span> <span id="stats-ideas" class="text-3xl font-bold text-pink-400">0</span>
        </div>
        <p class="text-gray-400">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ÙÙƒØ§Ø±</p>
       </div>
       <div class="glass-effect rounded-2xl p-6 card-hover">
        <div class="flex items-center justify-between mb-2"><span class="text-3xl">ğŸ‘¥</span> <span id="stats-members" class="text-3xl font-bold text-blue-400">0</span>
        </div>
        <p class="text-gray-400">Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</p>
       </div>
       <div class="glass-effect rounded-2xl p-6 card-hover">
        <div class="flex items-center justify-between mb-2"><span class="text-3xl">ğŸ‘ï¸</span> <span id="stats-views" class="text-3xl font-bold text-green-400">0</span>
        </div>
        <p class="text-gray-400">Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª</p>
       </div>
       <div class="glass-effect rounded-2xl p-6 card-hover">
        <div class="flex items-center justify-between mb-2"><span class="text-3xl">â­</span> <span id="stats-featured" class="text-3xl font-bold text-yellow-400">0</span>
        </div>
        <p class="text-gray-400">Ø§Ù„Ø£ÙÙƒØ§Ø± Ø§Ù„Ù…Ù…ÙŠØ²Ø©</p>
       </div>
      </div><!-- Quick Actions -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8"><button id="add-idea-home-btn" onclick="openModal('add-idea')" class="glass-effect rounded-2xl p-6 card-hover text-right">
        <div class="text-4xl mb-3">
         âœ¨
        </div><h3 class="text-xl font-bold mb-2">Ø´Ø§Ø±Ùƒ ÙÙƒØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3><p class="text-gray-400">Ø£Ø¶Ù ÙÙƒØ±ØªÙƒ Ø¥Ù„Ù‰ Ø§Ù„Ù…ØªØ­Ù ÙˆØ´Ø§Ø±ÙƒÙ‡Ø§ Ù…Ø¹ Ø§Ù„Ø¹Ø§Ù„Ù…</p></button> <button onclick="openModal('add-suggestion')" class="glass-effect rounded-2xl p-6 card-hover text-right">
        <div class="text-4xl mb-3">
         ğŸ’­
        </div><h3 class="text-xl font-bold mb-2">Ø§Ù‚ØªØ±Ø­ ØªØ­Ø³ÙŠÙ†Ø§Ù‹</h3><p class="text-gray-400">Ø³Ø§Ø¹Ø¯Ù†Ø§ ÙÙŠ ØªØ·ÙˆÙŠØ± Ø§Ù„Ù…ØªØ­Ù Ø¨Ø§Ù‚ØªØ±Ø§Ø­Ø§ØªÙƒ</p></button>
      </div><!-- Recent Ideas -->
      <div class="mb-8">
       <h3 class="text-2xl font-bold mb-4">Ø£Ø­Ø¯Ø« Ø§Ù„Ø£ÙÙƒØ§Ø± ğŸ†•</h3>
       <div id="recent-ideas" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"><!-- Will be filled by JS -->
       </div>
      </div>
     </section><!-- Ideas Section -->
     <section id="ideas-section" class="hidden">
      <div class="mb-6 flex items-center justify-between flex-wrap gap-4">
       <div>
        <h2 class="text-3xl font-bold mb-2">Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø£ÙÙƒØ§Ø± ğŸ’¡</h2>
        <p class="text-gray-400">Ø§Ø³ØªÙƒØ´Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙÙƒØ§Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©</p>
       </div><button id="add-idea-btn" onclick="openModal('add-idea')" class="px-6 py-3 rounded-xl bg-gradient-to-r from-pink-600 to-orange-500 hover:opacity-90 transition font-medium"> âœ¨ ÙÙƒØ±Ø© Ø¬Ø¯ÙŠØ¯Ø© </button>
      </div><!-- Category Filters -->
      <div class="flex gap-2 mb-6 overflow-x-auto pb-2"><button class="tab-btn active" onclick="filterIdeas('all')">Ø§Ù„ÙƒÙ„</button> <button class="tab-btn" onclick="filterIdeas('ØªÙ‚Ù†ÙŠØ©')">ğŸ’» ØªÙ‚Ù†ÙŠØ©</button> <button class="tab-btn" onclick="filterIdeas('ÙÙƒØ±ÙŠØ©')">ğŸ§  ÙÙƒØ±ÙŠØ©</button> <button class="tab-btn" onclick="filterIdeas('Ø¥Ø¨Ø¯Ø§Ø¹ÙŠØ©')">ğŸ¨ Ø¥Ø¨Ø¯Ø§Ø¹ÙŠØ©</button> <button class="tab-btn" onclick="filterIdeas('Ø¹Ù„Ù…ÙŠØ©')">ğŸ”¬ Ø¹Ù„Ù…ÙŠØ©</button>
      </div>
      <div id="ideas-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"><!-- Will be filled by JS -->
      </div>
     </section><!-- Trending Section -->
     <section id="trending-section" class="hidden">
      <div class="mb-6">
       <h2 class="text-3xl font-bold mb-2">Ø§Ù„Ø£ÙÙƒØ§Ø± Ø§Ù„Ø±Ø§Ø¦Ø¬Ø© ğŸ”¥</h2>
       <p class="text-gray-400">Ø§Ù„Ø£ÙÙƒØ§Ø± Ø§Ù„Ø£ÙƒØ«Ø± ØªÙØ§Ø¹Ù„Ø§Ù‹ ÙˆÙ…Ø´Ø§Ù‡Ø¯Ø©</p>
      </div>
      <div id="trending-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"><!-- Will be filled by JS -->
      </div>
     </section><!-- Search Section -->
     <section id="search-section" class="hidden">
      <div class="mb-6">
       <h2 class="text-3xl font-bold mb-2">Ø§Ù„Ø¨Ø­Ø« ğŸ”</h2>
       <p class="text-gray-400">Ø§Ø¨Ø­Ø« ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙÙƒØ§Ø± ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰</p>
      </div>
      <div class="glass-effect rounded-2xl p-4 mb-6"><input type="text" id="search-input" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø£ÙÙƒØ§Ø±ØŒ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ©ØŒ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡..." class="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:border-pink-500">
      </div>
      <div id="search-results" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
       <p class="text-gray-400 text-center py-12 col-span-full">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¨Ø­Ø« Ù„Ø¥ÙŠØ¬Ø§Ø¯ Ø§Ù„Ø£ÙÙƒØ§Ø±...</p>
      </div>
     </section><!-- Members Section (Admin Only) -->
     <section id="members-section" class="hidden">
      <div class="mb-6">
       <h2 class="text-3xl font-bold mb-2">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ ğŸ‘¥</h2>
       <p class="text-gray-400">Ø¬Ù…ÙŠØ¹ Ø£Ø¹Ø¶Ø§Ø¡ Ù…ØªØ­Ù Ø§Ù„ÙÙƒØ±</p>
      </div>
      <div id="members-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"><!-- Will be filled by JS -->
      </div>
     </section><!-- Suggestions Section -->
     <section id="suggestions-section" class="hidden">
      <div class="mb-6">
       <h2 class="text-3xl font-bold mb-2">Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª ğŸ“‹</h2>
       <p class="text-gray-400">Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø§Ù„ØªØ­Ø³ÙŠÙ† ÙˆØ§Ù„ØªØ·ÙˆÙŠØ±</p>
      </div>
      <div id="suggestions-list" class="space-y-4"><!-- Will be filled by JS -->
      </div>
     </section><!-- Settings Section (Admin Only) -->
     <section id="settings-section" class="hidden">
      <div class="mb-6">
       <h2 class="text-3xl font-bold mb-2">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª âš™ï¸</h2>
       <p class="text-gray-400">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù… ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>
      </div>
      <div class="space-y-4">
       <div class="glass-effect rounded-2xl p-6">
        <h3 class="text-xl font-bold mb-4">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
        <div class="space-y-3"><button onclick="syncNow()" class="w-full px-6 py-3 rounded-xl bg-blue-600/20 hover:bg-blue-600/30 border border-blue-600/50 transition"> ğŸ”„ Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¢Ù† </button> <button onclick="exportData()" class="w-full px-6 py-3 rounded-xl bg-green-600/20 hover:bg-green-600/30 border border-green-600/50 transition"> ğŸ“¤ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (JSON) </button> <button onclick="clearCache()" class="w-full px-6 py-3 rounded-xl bg-yellow-600/20 hover:bg-yellow-600/30 border border-yellow-600/50 transition"> ğŸ—„ï¸ Ù…Ø³Ø­ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø¤Ù‚ØªØ© </button> <button onclick="confirmClearAllData()" class="w-full px-6 py-3 rounded-xl bg-red-600/20 hover:bg-red-600/30 border border-red-600/50 transition"> ğŸ—‘ï¸ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª </button>
        </div>
       </div>
      </div>
     </section><!-- Invites Section (Admin Only) -->
     <section id="invites-section" class="hidden">
      <div class="mb-6 flex items-center justify-between flex-wrap gap-4">
       <div>
        <h2 class="text-3xl font-bold mb-2">Ø±Ù…ÙˆØ² Ø§Ù„Ø¯Ø¹ÙˆØ© ğŸ«</h2>
        <p class="text-gray-400">Ø¥Ø¯Ø§Ø±Ø© Ø±Ù…ÙˆØ² Ø¯Ø¹ÙˆØ© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ø¬Ø¯Ø¯</p>
       </div><button onclick="generateInviteCode()" class="px-6 py-3 rounded-xl bg-gradient-to-r from-pink-600 to-orange-500 hover:opacity-90 transition font-medium"> âœ¨ Ø¥Ù†Ø´Ø§Ø¡ Ø±Ù…Ø² Ø¬Ø¯ÙŠØ¯ </button>
      </div>
      <div id="invites-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"><!-- Will be filled by JS -->
      </div>
     </section><!-- Idea Detail Section -->
     <section id="idea-detail-section" class="hidden">
      <div class="mb-4"><button onclick="closeIdeaDetail()" class="px-4 py-2 rounded-xl bg-white/10 hover:bg-white/20 transition flex items-center gap-2"> <span>â†</span> <span>Ø±Ø¬ÙˆØ¹</span> </button>
      </div>
      <div id="idea-detail-content"><!-- Will be filled by JS -->
      </div>
     </section>
    </main>
   </div>
  </div><!-- Modals --> <!-- Add Idea Modal -->
  <div id="add-idea-modal" class="hidden fixed inset-0 modal-backdrop z-50 flex items-center justify-center p-4">
   <div class="glass-effect rounded-3xl p-8 max-w-2xl w-full max-h-[90%] overflow-y-auto">
    <div class="flex items-center justify-between mb-6">
     <h2 class="text-2xl font-bold">Ø´Ø§Ø±Ùƒ ÙÙƒØ±Ø© Ø¬Ø¯ÙŠØ¯Ø© âœ¨</h2><button onclick="closeModal('add-idea')" class="text-3xl hover:text-pink-400 transition">Ã—</button>
    </div>
    <form id="idea-form" class="space-y-4">
     <div><label for="idea-title" class="block text-sm font-medium mb-2">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙÙƒØ±Ø©</label> <input type="text" id="idea-title" required class="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:border-pink-500">
     </div>
     <div><label for="idea-category" class="block text-sm font-medium mb-2">Ø§Ù„ØªØµÙ†ÙŠÙ</label> <select id="idea-category" required class="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/20 text-white focus:outline-none focus:border-pink-500"> <option value="ØªÙ‚Ù†ÙŠØ©">ğŸ’» ØªÙ‚Ù†ÙŠØ©</option> <option value="ÙÙƒØ±ÙŠØ©">ğŸ§  ÙÙƒØ±ÙŠØ©</option> <option value="Ø¥Ø¨Ø¯Ø§Ø¹ÙŠØ©">ğŸ¨ Ø¥Ø¨Ø¯Ø§Ø¹ÙŠØ©</option> <option value="Ø¹Ù„Ù…ÙŠØ©">ğŸ”¬ Ø¹Ù„Ù…ÙŠØ©</option> </select>
     </div>
     <div><label for="idea-content" class="block text-sm font-medium mb-2">ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙÙƒØ±Ø©</label> <textarea id="idea-content" rows="6" required class="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:border-pink-500 resize-none"></textarea>
     </div>
     <div><label class="block text-sm font-medium mb-2">Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ© (Ø§Ø¶ØºØ· Enter Ø¨Ø¹Ø¯ ÙƒÙ„ ÙƒÙ„Ù…Ø©)</label>
      <div id="tags-container" class="flex flex-wrap gap-2 mb-2"><input type="text" id="idea-tags" placeholder="Ø£Ø¶Ù ÙƒÙ„Ù…Ø© Ù…ÙØªØ§Ø­ÙŠØ©..." class="flex-1 min-w-[150px] px-4 py-2 rounded-full bg-white/10 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:border-pink-500">
      </div><input type="hidden" id="tags-hidden" value="">
     </div><button type="submit" id="submit-idea-btn" class="w-full py-3 rounded-xl bg-gradient-to-r from-pink-600 to-orange-500 font-bold hover:opacity-90 transition"> ğŸš€ Ù†Ø´Ø± Ø§Ù„ÙÙƒØ±Ø© </button>
    </form>
   </div>
  </div><!-- Add Suggestion Modal -->
  <div id="add-suggestion-modal" class="hidden fixed inset-0 modal-backdrop z-50 flex items-center justify-center p-4">
   <div class="glass-effect rounded-3xl p-8 max-w-2xl w-full max-h-[90%] overflow-y-auto">
    <div class="flex items-center justify-between mb-6">
     <h2 class="text-2xl font-bold">Ø§Ù‚ØªØ±Ø­ ØªØ­Ø³ÙŠÙ†Ø§Ù‹ ğŸ’­</h2><button onclick="closeModal('add-suggestion')" class="text-3xl hover:text-pink-400 transition">Ã—</button>
    </div>
    <form id="suggestion-form" class="space-y-4">
     <div><label for="suggestion-type" class="block text-sm font-medium mb-2">Ù†ÙˆØ¹ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­</label> <select id="suggestion-type" required class="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/20 text-white focus:outline-none focus:border-pink-500"> <option value="ØªØµÙ…ÙŠÙ…">ğŸ¨ ØªØµÙ…ÙŠÙ…</option> <option value="Ù…Ø­ØªÙˆÙ‰">ğŸ“ Ù…Ø­ØªÙˆÙ‰</option> <option value="Ù…ÙŠØ²Ø§Øª">âœ¨ Ù…ÙŠØ²Ø§Øª</option> <option value="ØªØ­Ø³ÙŠÙ†Ø§Øª">ğŸ”§ ØªØ­Ø³ÙŠÙ†Ø§Øª</option> <option value="Ø£Ø®Ø±Ù‰">ğŸ’¬ Ø£Ø®Ø±Ù‰</option> </select>
     </div>
     <div><label for="suggestion-title" class="block text-sm font-medium mb-2">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­</label> <input type="text" id="suggestion-title" required class="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:border-pink-500">
     </div>
     <div><label for="suggestion-content" class="block text-sm font-medium mb-2">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­</label> <textarea id="suggestion-content" rows="6" required class="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:border-pink-500 resize-none"></textarea>
     </div><button type="submit" id="submit-suggestion-btn" class="w-full py-3 rounded-xl bg-gradient-to-r from-pink-600 to-orange-500 font-bold hover:opacity-90 transition"> ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­ </button>
    </form>
   </div>
  </div><!-- Delete Confirmation Modal -->
  <div id="delete-confirm-modal" class="hidden fixed inset-0 modal-backdrop z-50 flex items-center justify-center p-4">
   <div class="glass-effect rounded-3xl p-8 max-w-md w-full">
    <div class="text-center mb-6">
     <div class="text-6xl mb-4">
      âš ï¸
     </div>
     <h2 class="text-2xl font-bold mb-2">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù</h2>
     <p id="delete-confirm-text" class="text-gray-400">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ØŸ</p>
    </div>
    <div class="flex gap-3"><button onclick="closeModal('delete-confirm')" class="flex-1 py-3 rounded-xl bg-white/10 hover:bg-white/20 transition font-medium"> Ø¥Ù„ØºØ§Ø¡ </button> <button id="confirm-delete-btn" class="flex-1 py-3 rounded-xl bg-red-600 hover:bg-red-700 transition font-medium"> ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù </button>
    </div>
   </div>
  </div><!-- Toast Container -->
  <div id="toast-container" class="fixed bottom-4 left-4 z-50 space-y-2"><!-- Toasts will be added here -->
  </div>
  <script>
    // Supabase Configuration
    const SUPABASE_URL = 'https://lpjimlprsbtcbitanxop.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxwamltkXByc2J0Y2JpdGFueG9wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzgxNjIxMzIsImV4cCI6MjA1MzczODEzMn0.hoT5CVzRy8ZvzmyB9_UGMQ_5GHi2B73kF8vT0wXHqXg';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    // App State
    let appData = [];
    let currentUser = null;
    let currentFilter = 'all';
    let deleteTarget = null;
    let recordCount = 0;
    let isSidebarVisible = false;
    let currentTags = [];

    // Config
    const defaultConfig = {
      site_title: 'Ù…ØªØ­Ù Ø§Ù„ÙÙƒØ±',
      site_subtitle: 'Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ Ø§Ù„ÙÙƒØ±ÙŠ Ø§Ù„Ø±Ù‚Ù…ÙŠØ©',
      welcome_message: 'Ø­ÙŠØ« ØªØªØ­ÙˆÙ„ Ø§Ù„Ø£ÙÙƒØ§Ø± Ø¥Ù„Ù‰ Ø¥Ø±Ø« Ø®Ø§Ù„Ø¯',
      primary_color: '#e94560',
      secondary_color: '#1a1a2e',
      text_color: '#ffffff',
      accent_color: '#f39c12',
      surface_color: '#16213e',
      font_family: 'Tajawal',
      font_size: 16
    };

    const ADMIN_NAME = 'Rasha';
    const ADMIN_SPECIALTY = '20250929';

    // Sync Status Management
    function showSyncStatus(status, message) {
      const indicator = document.getElementById('sync-indicator');
      const icon = document.getElementById('sync-icon');
      const text = document.getElementById('sync-text');
      
      if (!indicator || !icon || !text) return;
      
      indicator.className = 'fixed top-4 right-4 z-50 glass-effect rounded-xl px-4 py-2 border-2 flex items-center gap-2';
      
      if (status === 'syncing') {
        indicator.classList.add('sync-syncing');
        icon.textContent = 'ğŸ”„';
        text.textContent = message || 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©...';
      } else if (status === 'success') {
        indicator.classList.add('sync-success');
        icon.textContent = 'âœ…';
        text.textContent = message || 'ØªÙ…Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø¨Ù†Ø¬Ø§Ø­';
        setTimeout(() => indicator.classList.add('hidden'), 3000);
      } else if (status === 'error') {
        indicator.classList.add('sync-error');
        icon.textContent = 'âŒ';
        text.textContent = message || 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©';
        setTimeout(() => indicator.classList.add('hidden'), 5000);
      }
      
      indicator.classList.remove('hidden');
    }

    // Initialize Supabase Tables
    async function initializeTables() {
      try {
        showSyncStatus('syncing', 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
        
        const { data: existingData, error } = await supabase
          .from('museum_data')
          .select('*')
          .limit(1);

        if (error && error.code === '42P01') {
          showSyncStatus('error', 'Ø§Ù„Ø¬Ø¯ÙˆÙ„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
          console.log('ÙŠØ±Ø¬Ù‰ Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ museum_data ÙÙŠ Supabase');
        } else if (!error) {
          showSyncStatus('success', 'Ù…ØªØµÙ„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
        }
      } catch (err) {
        showSyncStatus('error', 'ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„:', err);
      }
    }

    // Data Handler for Data SDK
    const dataHandler = {
      async onDataChanged(data) {
        appData = data;
        recordCount = data.length;
        
        const newItems = data.filter(item => {
          return !window.syncedIds?.has(item.__backendId);
        });
        
        if (newItems.length > 0) {
          newItems.forEach(queueForSync);
          if (!window.syncedIds) window.syncedIds = new Set();
          newItems.forEach(item => window.syncedIds.add(item.__backendId));
        }
        
        updateUI();
      }
    };

    // Sync Queue Management
    let syncQueue = [];
    let isSyncing = false;

    async function syncWithSupabase() {
      if (isSyncing || syncQueue.length === 0) return;
      
      try {
        isSyncing = true;
        showSyncStatus('syncing', `Ù…Ø²Ø§Ù…Ù†Ø© ${syncQueue.length} Ø¹Ù†ØµØ±...`);
        
        const itemsToSync = [...syncQueue];
        syncQueue = [];
        
        const insertData = itemsToSync.map(item => ({
          id: item.__backendId,
          type: item.type || '',
          title: item.title || '',
          content: item.content || '',
          author: item.author || '',
          specialty: item.specialty || '',
          category: item.category || '',
          status: item.status || '',
          created_at: item.createdAt || new Date().toISOString(),
          is_admin: item.isAdmin || false,
          role: item.role || '',
          invite_code: item.inviteCode || '',
          used_by: item.usedBy || '',
          likes: item.likes || 0,
          liked_by: item.likedBy || '',
          parent_id: item.parentId || '',
          views: item.views || 0,
          tags: item.tags || '',
          image_url: item.imageUrl || ''
        }));
        
        const { error } = await supabase.from('museum_data').upsert(insertData, { onConflict: 'id' });
        
        if (error) {
          showSyncStatus('error', 'ÙØ´Ù„Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©');
          console.error('Sync error:', error);
        } else {
          showSyncStatus('success', 'ØªÙ…Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø¨Ù†Ø¬Ø§Ø­');
        }
      } catch (error) {
        showSyncStatus('error', 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©');
        console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©:', error);
      } finally {
        isSyncing = false;
      }
    }

    function queueForSync(item) {
      syncQueue.push(item);
      clearTimeout(window.syncTimeout);
      window.syncTimeout = setTimeout(syncWithSupabase, 500);
    }

    // Load Data from Supabase with Caching
    async function loadFromSupabase() {
      try {
        showSyncStatus('syncing', 'Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
        
        const cachedData = localStorage.getItem('museum_cache');
        const cacheTime = localStorage.getItem('museum_cache_time');
        const now = Date.now();
        
        if (cachedData && cacheTime && (now - parseInt(cacheTime)) < 300000) {
          const convertedData = JSON.parse(cachedData);
          appData = convertedData;
          recordCount = appData.length;
          updateUI();
          showSyncStatus('success', 'ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ù† Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø¤Ù‚ØªØ©');
          
          loadFreshDataInBackground();
          return;
        }
        
        const { data, error } = await supabase
          .from('museum_data')
          .select('*')
          .order('created_at', { ascending: false });

        if (error) {
          showSyncStatus('error', 'ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
          throw error;
        }

        if (data && data.length > 0) {
          const convertedData = data.map(item => ({
            __backendId: item.id,
            type: item.type || '',
            title: item.title || '',
            content: item.content || '',
            author: item.author || '',
            specialty: item.specialty || '',
            category: item.category || '',
            status: item.status || '',
            createdAt: item.created_at || new Date().toISOString(),
            isAdmin: item.is_admin || false,
            role: item.role || '',
            inviteCode: item.invite_code || '',
            usedBy: item.used_by || '',
            likes: item.likes || 0,
            likedBy: item.liked_by || '',
            parentId: item.parent_id || '',
            views: item.views || 0,
            tags: item.tags || '',
            imageUrl: item.image_url || ''
          }));

          localStorage.setItem('museum_cache', JSON.stringify(convertedData));
          localStorage.setItem('museum_cache_time', now.toString());
          
          window.syncedIds = new Set(convertedData.map(item => item.__backendId));

          appData = convertedData;
          recordCount = appData.length;
          updateUI();
          showSyncStatus('success', `ØªÙ… ØªØ­Ù…ÙŠÙ„ ${data.length} Ø¹Ù†ØµØ±`);
        } else {
          showSyncStatus('success', 'Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙØ§Ø±ØºØ©');
        }
      } catch (error) {
        showSyncStatus('error', 'Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
        console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
      }
    }

    function loadFreshDataInBackground() {
      setTimeout(async () => {
        try {
          const { data, error } = await supabase
            .from('museum_data')
            .select('*')
            .order('created_at', { ascending: false });

          if (error) return;

          if (data && data.length > 0) {
            const convertedData = data.map(item => ({
              __backendId: item.id,
              type: item.type || '',
              title: item.title || '',
              content: item.content || '',
              author: item.author || '',
              specialty: item.specialty || '',
              category: item.category || '',
              status: item.status || '',
              createdAt: item.created_at || new Date().toISOString(),
              isAdmin: item.is_admin || false,
              role: item.role || '',
              inviteCode: item.invite_code || '',
              usedBy: item.used_by || '',
              likes: item.likes || 0,
              likedBy: item.liked_by || '',
              parentId: item.parent_id || '',
              views: item.views || 0,
              tags: item.tags || '',
              imageUrl: item.image_url || ''
            }));

            localStorage.setItem('museum_cache', JSON.stringify(convertedData));
            localStorage.setItem('museum_cache_time', Date.now().toString());
            
            window.syncedIds = new Set(convertedData.map(item => item.__backendId));
          }
        } catch (error) {
          console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ« ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©:', error);
        }
      }, 100);
    }

    // Tags Management
    function initTagsInput() {
      const input = document.getElementById('idea-tags');
      const container = document.getElementById('tags-container');
      
      if (!input || !container) return;
      
      input.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ',') {
          e.preventDefault();
          const tag = input.value.trim();
          if (tag && !currentTags.includes(tag)) {
            currentTags.push(tag);
            renderTags();
            input.value = '';
          }
        }
      });
    }

    function renderTags() {
      const container = document.getElementById('tags-container');
      const input = document.getElementById('idea-tags');
      
      if (!container || !input) return;
      
      const tagsHTML = currentTags.map(tag => `
        <div class="tag">
          <span>${escapeHtml(tag)}</span>
          <button type="button" onclick="removeTag('${escapeHtml(tag)}')">Ã—</button>
        </div>
      `).join('');
      
      container.innerHTML = tagsHTML + input.outerHTML;
      
      const newInput = document.getElementById('idea-tags');
      if (newInput) {
        newInput.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ',') {
            e.preventDefault();
            const tag = newInput.value.trim();
            if (tag && !currentTags.includes(tag)) {
              currentTags.push(tag);
              renderTags();
            }
          }
        });
      }
      
      const hiddenInput = document.getElementById('tags-hidden');
      if (hiddenInput) {
        hiddenInput.value = currentTags.join(',');
      }
    }

    function removeTag(tag) {
      currentTags = currentTags.filter(t => t !== tag);
      renderTags();
    }

    // Search Functionality
    let searchTimeout;
    function initSearch() {
      const searchInput = document.getElementById('search-input');
      if (searchInput) {
        searchInput.addEventListener('input', (e) => {
          clearTimeout(searchTimeout);
          searchTimeout = setTimeout(() => {
            performSearch(e.target.value);
          }, 300);
        });
      }
    }

    function performSearch(query) {
      const resultsContainer = document.getElementById('search-results');
      if (!resultsContainer) return;
      
      if (!query.trim()) {
        resultsContainer.innerHTML = '<p class="text-gray-400 text-center py-12 col-span-full">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¨Ø­Ø« Ù„Ø¥ÙŠØ¬Ø§Ø¯ Ø§Ù„Ø£ÙÙƒØ§Ø±...</p>';
        return;
      }

      const ideas = appData.filter(d => d.type === 'idea');
      const searchLower = query.toLowerCase();
      
      const results = ideas.filter(idea => {
        const titleMatch = idea.title.toLowerCase().includes(searchLower);
        const contentMatch = idea.content.toLowerCase().includes(searchLower);
        const authorMatch = idea.author.toLowerCase().includes(searchLower);
        const tagsMatch = idea.tags && idea.tags.toLowerCase().includes(searchLower);
        
        return titleMatch || contentMatch || authorMatch || tagsMatch;
      });

      if (results.length === 0) {
        resultsContainer.innerHTML = '<p class="text-gray-400 text-center py-12 col-span-full">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬ ğŸ˜”</p>';
        return;
      }

      resultsContainer.innerHTML = results.map(idea => `
        <div class="glass-effect rounded-xl p-6 card-hover cursor-pointer" onclick="openIdeaDetail('${idea.__backendId}')">
          <div class="flex justify-between items-start mb-3">
            <span class="category-badge rounded-full bg-pink-600/30 text-pink-400">${getCategoryEmoji(idea.category)} ${idea.category}</span>
            ${idea.status === 'featured' ? '<span class="text-yellow-400">â­</span>' : ''}
          </div>
          <h3 class="font-bold text-xl mb-2">${escapeHtml(idea.title)}</h3>
          <p class="text-gray-400 mb-3 line-clamp-2">${escapeHtml(idea.content)}</p>
          ${idea.tags ? `
            <div class="flex flex-wrap gap-2 mb-3">
              ${idea.tags.split(',').map(tag => `<span class="text-xs bg-pink-500/20 text-pink-400 px-2 py-1 rounded-full">#${escapeHtml(tag.trim())}</span>`).join('')}
            </div>
          ` : ''}
          <div class="flex justify-between items-center text-sm text-gray-500">
            <span>ğŸ‘¤ ${escapeHtml(idea.author)}</span>
            <div class="flex items-center gap-3">
              <span>${idea.views || 0} ğŸ‘ï¸</span>
              <span>${idea.likes || 0} â¤ï¸</span>
            </div>
          </div>
        </div>
      `).join('');
    }

    // Initialize App
    async function initApp() {
      try {
        await initializeTables();
        
        const storedUser = localStorage.getItem('museum_user');
        if (storedUser) {
          currentUser = JSON.parse(storedUser);
          showDashboard();
          hideLoading();
        }
        
        await loadFromSupabase();

        if (window.dataSdk) {
          const result = await window.dataSdk.init(dataHandler);
          if (!result.isOk) {
            console.error('Failed to init data SDK');
          }
        }

        if (window.elementSdk) {
          window.elementSdk.init({
            defaultConfig,
            onConfigChange: applyConfig,
            mapToCapabilities: (config) => ({
              recolorables: [
                { get: () => config.primary_color || defaultConfig.primary_color, set: (v) => window.elementSdk.setConfig({ primary_color: v }) },
                { get: () => config.secondary_color || defaultConfig.secondary_color, set: (v) => window.elementSdk.setConfig({ secondary_color: v }) },
                { get: () => config.text_color || defaultConfig.text_color, set: (v) => window.elementSdk.setConfig({ text_color: v }) },
                { get: () => config.accent_color || defaultConfig.accent_color, set: (v) => window.elementSdk.setConfig({ accent_color: v }) },
                { get: () => config.surface_color || defaultConfig.surface_color, set: (v) => window.elementSdk.setConfig({ surface_color: v }) }
              ],
              borderables: [],
              fontEditable: { get: () => config.font_family || defaultConfig.font_family, set: (v) => window.elementSdk.setConfig({ font_family: v }) },
              fontSizeable: { get: () => config.font_size || defaultConfig.font_size, set: (v) => window.elementSdk.setConfig({ font_size: v }) }
            }),
            mapToEditPanelValues: (config) => new Map([
              ['site_title', config.site_title || defaultConfig.site_title],
              ['site_subtitle', config.site_subtitle || defaultConfig.site_subtitle],
              ['welcome_message', config.welcome_message || defaultConfig.welcome_message]
            ])
          });
        }

        if (!storedUser) {
          showLogin();
          hideLoading();
        }
        
        const menuToggle = document.getElementById('menu-toggle');
        if (menuToggle) {
          menuToggle.addEventListener('click', toggleSidebar);
        }
        
        initTagsInput();
        initSearch();
      } catch (err) {
        console.error('Init error:', err);
        hideLoading();
        showLogin();
      }
    }

    // Apply Config
    async function applyConfig(config) {
      const c = { ...defaultConfig, ...config };
      
      const loginTitle = document.getElementById('login-title');
      const loginSubtitle = document.getElementById('login-subtitle');
      const loginWelcome = document.getElementById('login-welcome');
      const sidebarTitle = document.getElementById('sidebar-title');
      
      if (loginTitle) loginTitle.textContent = c.site_title;
      if (loginSubtitle) loginSubtitle.textContent = c.site_subtitle;
      if (loginWelcome) loginWelcome.textContent = c.welcome_message;
      if (sidebarTitle) sidebarTitle.textContent = c.site_title;

      document.body.style.fontFamily = `${c.font_family}, Tajawal, sans-serif`;
      document.body.style.fontSize = `${c.font_size}px`;
    }

    // Sidebar Functions
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      if (!sidebar) return;
      
      isSidebarVisible = !isSidebarVisible;
      
      if (isSidebarVisible) {
        sidebar.classList.remove('sidebar-hidden');
        sidebar.classList.add('sidebar-visible');
      } else {
        sidebar.classList.remove('sidebar-visible');
        sidebar.classList.add('sidebar-hidden');
      }
    }

    function hideSidebar() {
      const sidebar = document.getElementById('sidebar');
      if (!sidebar) return;
      
      isSidebarVisible = false;
      sidebar.classList.remove('sidebar-visible');
      sidebar.classList.add('sidebar-hidden');
    }

    // UI Functions
    function hideLoading() {
      const loadingScreen = document.getElementById('loading-screen');
      if (loadingScreen) {
        loadingScreen.classList.add('hidden');
      }
    }

    function showLogin() {
      const loginPage = document.getElementById('login-page');
      const dashboard = document.getElementById('dashboard');
      
      if (loginPage) loginPage.classList.remove('hidden');
      if (dashboard) dashboard.classList.add('hidden');
    }

    function showDashboard() {
      const loginPage = document.getElementById('login-page');
      const dashboard = document.getElementById('dashboard');
      
      if (loginPage) loginPage.classList.add('hidden');
      if (dashboard) dashboard.classList.remove('hidden');
      
      const userName = document.getElementById('user-name');
      const userSpecialty = document.getElementById('user-specialty');
      const userAvatar = document.getElementById('user-avatar');
      
      if (userName) userName.textContent = currentUser.name;
      if (userSpecialty) userSpecialty.textContent = currentUser.specialty;
      if (userAvatar) userAvatar.textContent = currentUser.role === 'admin' ? 'ğŸ‘‘' : 'ğŸ’¡';
      
      const isAdmin = currentUser.role === 'admin';
      
      const settingsBtn = document.getElementById('settings-btn');
      const membersBtn = document.getElementById('members-btn');
      const invitesBtn = document.getElementById('invites-btn');
      const adminStatsCards = document.getElementById('admin-stats-cards');
      const adminStatsSidebar = document.getElementById('admin-stats-sidebar');
      const addIdeaHomeBtn = document.getElementById('add-idea-home-btn');
      const addIdeaBtn = document.getElementById('add-idea-btn');
      
      if (settingsBtn) settingsBtn.classList.toggle('hidden', !isAdmin);
      if (membersBtn) membersBtn.classList.toggle('hidden', !isAdmin);
      if (invitesBtn) invitesBtn.classList.toggle('hidden', !isAdmin);
      if (adminStatsCards) adminStatsCards.classList.toggle('hidden', !isAdmin);
      if (adminStatsSidebar) adminStatsSidebar.classList.toggle('hidden', !isAdmin);
      if (addIdeaHomeBtn) addIdeaHomeBtn.classList.remove('hidden');
      if (addIdeaBtn) addIdeaBtn.classList.remove('hidden');
      
      updateUI();
    }

    function navigateTo(section) {
      const sections = ['home', 'ideas', 'trending', 'search', 'members', 'suggestions', 'settings', 'invites'];
      sections.forEach(s => {
        const el = document.getElementById(`${s}-section`);
        const btn = document.querySelector(`[data-section="${s}"]`);
        if (el) el.classList.add('hidden');
        if (btn) btn.classList.remove('active');
      });
      
      const activeSection = document.getElementById(`${section}-section`);
      const activeBtn = document.querySelector(`[data-section="${section}"]`);
      if (activeSection) activeSection.classList.remove('hidden');
      if (activeBtn) activeBtn.classList.add('active');
      
      const ideaDetailSection = document.getElementById('idea-detail-section');
      if (ideaDetailSection) ideaDetailSection.classList.add('hidden');
      
      hideSidebar();
    }

    function openModal(type) {
      const modal = document.getElementById(`${type}-modal`);
      if (!modal) return;
      
      modal.classList.remove('hidden');
      if (type === 'add-idea') {
        currentTags = [];
        renderTags();
      }
    }

    function closeModal(type) {
      const modal = document.getElementById(`${type}-modal`);
      if (modal) {
        modal.classList.add('hidden');
      }
    }

    function showToast(message, type = 'success') {
      const container = document.getElementById('toast-container');
      if (!container) return;
      
      const toast = document.createElement('div');
      toast.className = `toast px-4 py-3 rounded-xl ${type === 'success' ? 'bg-green-600' : 'bg-red-600'} text-white shadow-lg`;
      toast.textContent = message;
      container.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }

    // Update UI
    let lastRenderedState = {};

    function updateUI() {
      const ideas = appData.filter(d => d.type === 'idea');
      const members = appData.filter(d => d.type === 'member');
      const suggestions = appData.filter(d => d.type === 'suggestion');
      const invites = appData.filter(d => d.type === 'invite');
      const featured = ideas.filter(i => i.status === 'featured');
      const totalViews = ideas.reduce((sum, i) => sum + (i.views || 0), 0);

      const currentState = {
        ideasCount: ideas.length,
        membersCount: members.length,
        suggestionsCount: suggestions.length,
        featuredCount: featured.length,
        viewsCount: totalViews
      };

      if (currentUser?.role === 'admin') {
        const statsIdeas = document.getElementById('stats-ideas');
        const statsMembers = document.getElementById('stats-members');
        const statsViews = document.getElementById('stats-views');
        const statsFeatured = document.getElementById('stats-featured');
        
        if (lastRenderedState.ideasCount !== currentState.ideasCount && statsIdeas) {
          statsIdeas.textContent = ideas.length;
        }
        if (lastRenderedState.membersCount !== currentState.membersCount && statsMembers) {
          statsMembers.textContent = members.length;
        }
        if (lastRenderedState.viewsCount !== currentState.viewsCount && statsViews) {
          statsViews.textContent = totalViews;
        }
        if (lastRenderedState.featuredCount !== currentState.featuredCount && statsFeatured) {
          statsFeatured.textContent = featured.length;
        }
        
        const adminStatsTotal = document.getElementById('admin-stats-total');
        const adminStatsIdeas = document.getElementById('admin-stats-ideas');
        const adminStatsMembers = document.getElementById('admin-stats-members');
        const adminStatsSuggestions = document.getElementById('admin-stats-suggestions');
        
        if (adminStatsTotal) adminStatsTotal.textContent = appData.length;
        if (adminStatsIdeas) adminStatsIdeas.textContent = ideas.length;
        if (adminStatsMembers) adminStatsMembers.textContent = members.length;
        if (adminStatsSuggestions) adminStatsSuggestions.textContent = suggestions.length;
      }

      const badge = document.getElementById('suggestions-badge');
      if (badge) {
        if (currentUser?.role === 'admin') {
          const pendingSuggestions = suggestions.filter(s => s.status === 'pending').length;
          if (pendingSuggestions > 0) {
            badge.textContent = pendingSuggestions;
            badge.classList.remove('hidden');
          } else {
            badge.classList.add('hidden');
          }
        } else {
          badge.classList.add('hidden');
        }
      }

      const homeSection = document.getElementById('home-section');
      const ideasSection = document.getElementById('ideas-section');
      const trendingSection = document.getElementById('trending-section');
      
      if (homeSection && !homeSection.classList.contains('hidden')) {
        renderRecentIdeas(ideas.slice(-6).reverse());
      }
      
      if (ideasSection && !ideasSection.classList.contains('hidden')) {
        renderIdeasGrid(currentFilter === 'all' ? ideas : ideas.filter(i => i.category === currentFilter));
      }

      if (trendingSection && !trendingSection.classList.contains('hidden')) {
        const trending = [...ideas].sort((a, b) => {
          const scoreA = (a.likes || 0) * 2 + (a.views || 0);
          const scoreB = (b.likes || 0) * 2 + (b.views || 0);
          return scoreB - scoreA;
        }).slice(0, 12);
        renderTrendingGrid(trending);
      }
      
      if (currentUser?.role === 'admin') {
        const membersSection = document.getElementById('members-section');
        const suggestionsSection = document.getElementById('suggestions-section');
        const invitesSection = document.getElementById('invites-section');
        
        if (membersSection && !membersSection.classList.contains('hidden')) {
          renderMembers(members);
        }
        if (suggestionsSection && !suggestionsSection.classList.contains('hidden')) {
          renderSuggestions(suggestions);
        }
        if (invitesSection && !invitesSection.classList.contains('hidden')) {
          renderInvites(invites);
        }
      }
      
      lastRenderedState = currentState;
    }

    function renderRecentIdeas(ideas) {
      const container = document.getElementById('recent-ideas');
      if (!container) return;
      
      if (ideas.length === 0) {
        container.innerHTML = '<p class="text-gray-400 col-span-full text-center py-8">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙÙƒØ§Ø± Ø¨Ø¹Ø¯. ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠØ´Ø§Ø±Ùƒ!</p>';
        return;
      }
      
      container.innerHTML = ideas.map(idea => {
        const likeCount = idea.likes || 0;
        const viewCount = idea.views || 0;
        
        return `
        <div class="idea-card rounded-xl p-4 card-hover cursor-pointer" onclick="openIdeaDetail('${idea.__backendId}')">
          <div class="flex justify-between items-start mb-2">
            <span class="category-badge rounded-full bg-pink-600/30 text-pink-400">${getCategoryEmoji(idea.category)} ${idea.category}</span>
            ${idea.status === 'featured' ? '<span class="text-yellow-400">â­</span>' : ''}
          </div>
          <h3 class="font-bold text-lg mb-2">${escapeHtml(idea.title)}</h3>
          <p class="text-gray-400 text-sm mb-3 line-clamp-2">${escapeHtml(idea.content)}</p>
          ${idea.tags ? `
            <div class="flex flex-wrap gap-1 mb-2">
              ${idea.tags.split(',').slice(0, 3).map(tag => `<span class="text-xs bg-pink-500/20 text-pink-400 px-2 py-0.5 rounded-full">#${escapeHtml(tag.trim())}</span>`).join('')}
            </div>
          ` : ''}
          <div class="flex justify-between items-center text-xs text-gray-500">
            <span>ğŸ‘¤ ${escapeHtml(idea.author)}</span>
            <div class="flex items-center gap-2">
              <span>${viewCount} ğŸ‘ï¸</span>
              <span>${likeCount} â¤ï¸</span>
            </div>
          </div>
        </div>
      `;
      }).join('');
    }

    function renderIdeasGrid(ideas) {
      const container = document.getElementById('ideas-grid');
      if (!container) return;
      
      if (ideas.length === 0) {
        container.innerHTML = '<p class="text-gray-400 col-span-full text-center py-12">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙÙƒØ§Ø± ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ø¨Ø¹Ø¯</p>';
        return;
      }
      
      container.innerHTML = ideas.map(idea => {
        const likeCount = idea.likes || 0;
        const viewCount = idea.views || 0;
        const commentCount = appData.filter(d => d.type === 'comment' && d.parentId === idea.__backendId).length;
        
        return `
        <div class="idea-card rounded-2xl p-5 card-hover relative group cursor-pointer" onclick="openIdeaDetail('${idea.__backendId}')">
          ${currentUser?.role === 'admin' ? `
            <div class="absolute top-2 left-2 opacity-0 group-hover:opacity-100 transition flex gap-1 z-10">
              <button onclick="event.stopPropagation(); toggleFeatured('${idea.__backendId}')" class="p-2 rounded-lg bg-white/10 hover:bg-yellow-500/30 transition" title="ØªÙ…ÙŠÙŠØ²">
                ${idea.status === 'featured' ? 'â­' : 'â˜†'}
              </button>
              <button onclick="event.stopPropagation(); confirmDelete('idea', '${idea.__backendId}')" class="p-2 rounded-lg bg-white/10 hover:bg-red-500/30 transition" title="Ø­Ø°Ù">
                ğŸ—‘ï¸
              </button>
            </div>
          ` : ''}
          <div class="flex justify-between items-start mb-3">
            <span class="category-badge rounded-full bg-pink-600/30 text-pink-400">${getCategoryEmoji(idea.category)} ${idea.category}</span>
            ${idea.status === 'featured' ? '<span class="text-yellow-400 text-xl">â­</span>' : ''}
          </div>
          <h3 class="font-bold text-xl mb-3">${escapeHtml(idea.title)}</h3>
          <p class="text-gray-400 mb-4 line-clamp-3">${escapeHtml(idea.content)}</p>
          ${idea.tags ? `
            <div class="flex flex-wrap gap-2 mb-3">
              ${idea.tags.split(',').slice(0, 3).map(tag => `<span class="text-xs bg-pink-500/20 text-pink-400 px-2 py-1 rounded-full">#${escapeHtml(tag.trim())}</span>`).join('')}
            </div>
          ` : ''}
          <div class="flex justify-between items-center text-sm text-gray-500 pt-3 border-t border-white/10">
            <span>ğŸ‘¤ ${escapeHtml(idea.author)}</span>
            <div class="flex items-center gap-3">
              <span>${viewCount} ğŸ‘ï¸</span>
              <span>${commentCount} ğŸ’¬</span>
              <span>${likeCount} â¤ï¸</span>
            </div>
          </div>
        </div>
      `;
      }).join('');
    }

    function renderTrendingGrid(ideas) {
      const container = document.getElementById('trending-grid');
      if (!container) return;
      
      if (ideas.length === 0) {
        container.innerHTML = '<p class="text-gray-400 col-span-full text-center py-12">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙÙƒØ§Ø± Ø±Ø§Ø¦Ø¬Ø© Ø¨Ø¹Ø¯</p>';
        return;
      }
      
      container.innerHTML = ideas.map((idea, index) => {
        const likeCount = idea.likes || 0;
        const viewCount = idea.views || 0;
        const score = likeCount * 2 + viewCount;
        
        return `
        <div class="idea-card rounded-2xl p-5 card-hover cursor-pointer relative" onclick="openIdeaDetail('${idea.__backendId}')">
          ${index < 3 ? `<div class="absolute top-2 right-2 text-2xl">${index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : 'ğŸ¥‰'}</div>` : ''}
          <div class="flex justify-between items-start mb-3">
            <span class="category-badge rounded-full bg-pink-600/30 text-pink-400">${getCategoryEmoji(idea.category)} ${idea.category}</span>
            ${idea.status === 'featured' ? '<span class="text-yellow-400">â­</span>' : ''}
          </div>
          <h3 class="font-bold text-xl mb-3">${escapeHtml(idea.title)}</h3>
          <p class="text-gray-400 mb-4 line-clamp-2">${escapeHtml(idea.content)}</p>
          <div class="flex justify-between items-center text-sm text-gray-500 pt-3 border-t border-white/10">
            <span>ğŸ‘¤ ${escapeHtml(idea.author)}</span>
            <div class="flex items-center gap-3">
              <span>${viewCount} ğŸ‘ï¸</span>
              <span>${likeCount} â¤ï¸</span>
              <span class="text-pink-400 font-bold">${score} ğŸ”¥</span>
            </div>
          </div>
        </div>
      `;
      }).join('');
    }

    function renderMembers(members) {
      const container = document.getElementById('members-grid');
      if (!container) return;
      
      if (members.length === 0) {
        container.innerHTML = '<p class="text-gray-400 col-span-full text-center py-12">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø¹Ø¶Ø§Ø¡ Ù…Ø³Ø¬Ù„ÙŠÙ† Ø¨Ø¹Ø¯</p>';
        return;
      }
      
      container.innerHTML = members.map(member => {
        const roleEmoji = member.role === 'admin' ? 'ğŸ‘‘' : 'ğŸ’¡';
        const memberIdeas = appData.filter(d => d.type === 'idea' && d.author === member.title);
        
        return `
        <div class="glass-effect rounded-xl p-4 flex items-center gap-4 card-hover relative group">
          ${currentUser?.role === 'admin' ? `
            <button onclick="confirmDelete('member', '${member.__backendId}')" class="absolute top-2 left-2 opacity-0 group-hover:opacity-100 p-2 rounded-lg bg-white/10 hover:bg-red-500/30 transition">
              ğŸ—‘ï¸
            </button>
          ` : ''}
          <div class="w-14 h-14 rounded-full bg-gradient-to-r from-pink-600 to-orange-500 flex items-center justify-center text-2xl">
            ${roleEmoji}
          </div>
          <div>
            <h3 class="font-bold">${escapeHtml(member.title)}</h3>
            <p class="text-sm text-gray-400">${escapeHtml(member.specialty || '')}</p>
            <p class="text-xs text-gray-500">${memberIdeas.length} ÙÙƒØ±Ø© â€¢ ${member.role === 'admin' ? 'Ù…Ø¯ÙŠØ±' : 'Ø¹Ø¶Ùˆ'}</p>
          </div>
        </div>
      `;
      }).join('');
    }

    function renderSuggestions(suggestions) {
      const container = document.getElementById('suggestions-list');
      if (!container) return;
      
      if (suggestions.length === 0) {
        container.innerHTML = '<p class="text-gray-400 text-center py-12">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø¨Ø¹Ø¯. ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠÙ‚ØªØ±Ø­!</p>';
        return;
      }
      
      container.innerHTML = suggestions.map(suggestion => `
        <div class="glass-effect rounded-xl p-5 card-hover relative group">
          ${currentUser?.role === 'admin' ? `
            <div class="absolute top-3 left-3 opacity-0 group-hover:opacity-100 transition flex gap-1">
              <button onclick="updateSuggestionStatus('${suggestion.__backendId}', 'approved')" class="p-2 rounded-lg bg-green-500/20 hover:bg-green-500/40 transition" title="Ù‚Ø¨ÙˆÙ„">âœ…</button>
              <button onclick="updateSuggestionStatus('${suggestion.__backendId}', 'rejected')" class="p-2 rounded-lg bg-red-500/20 hover:bg-red-500/40 transition" title="Ø±ÙØ¶">âŒ</button>
              <button onclick="confirmDelete('suggestion', '${suggestion.__backendId}')" class="p-2 rounded-lg bg-white/10 hover:bg-red-500/30 transition" title="Ø­Ø°Ù">ğŸ—‘ï¸</button>
            </div>
          ` : ''}
          <div class="flex items-start gap-4">
            <div class="text-3xl">${getSuggestionEmoji(suggestion.category)}</div>
            <div class="flex-1">
              <div class="flex items-center gap-2 mb-2">
                <span class="category-badge rounded-full bg-white/10">${suggestion.category}</span>
                <span class="category-badge rounded-full ${getStatusColor(suggestion.status)}">${getStatusText(suggestion.status)}</span>
              </div>
              <h3 class="font-bold text-lg mb-2">${escapeHtml(suggestion.title)}</h3>
              <p class="text-gray-400 mb-3">${escapeHtml(suggestion.content)}</p>
              <div class="text-sm text-gray-500">
                <span>ğŸ‘¤ ${escapeHtml(suggestion.author)}</span>
                <span class="mx-2">â€¢</span>
                <span>${formatDate(suggestion.createdAt)}</span>
              </div>
            </div>
          </div>
        </div>
      `).join('');
    }

    function renderInvites(invites) {
      const container = document.getElementById('invites-grid');
      if (!container) return;
      
      if (invites.length === 0) {
        container.innerHTML = '<p class="text-gray-400 col-span-full text-center py-12">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ù…ÙˆØ² Ø¯Ø¹ÙˆØ© Ø¨Ø¹Ø¯</p>';
        return;
      }
      
      container.innerHTML = invites.map(invite => `
        <div class="glass-effect rounded-xl p-5 card-hover relative group">
          ${currentUser?.role === 'admin' ? `
            <button onclick="confirmDelete('invite', '${invite.__backendId}')" class="absolute top-2 left-2 opacity-0 group-hover:opacity-100 p-2 rounded-lg bg-white/10 hover:bg-red-500/30 transition">
              ğŸ—‘ï¸
            </button>
          ` : ''}
          <div class="flex items-center gap-4 mb-3">
            <div class="text-3xl">ğŸ«</div>
            <div class="flex-1">
              <div class="flex items-center gap-2">
                <span class="font-mono text-lg text-pink-400">${invite.inviteCode}</span>
                <button onclick="copyInviteCode('${invite.inviteCode}')" class="p-1 rounded hover:bg-white/10 transition" title="Ù†Ø³Ø®">
                  ğŸ“‹
                </button>
              </div>
              <p class="text-xs text-gray-500">ØªÙ… Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ ${formatDate(invite.createdAt)}</p>
            </div>
          </div>
          <div class="pt-3 border-t border-white/10">
            ${invite.usedBy ? `
              <div class="flex items-center gap-2 text-sm">
                <span class="text-green-400">âœ… Ù…Ø³ØªØ®Ø¯Ù…</span>
                <span class="text-gray-400">Ø¨ÙˆØ§Ø³Ø·Ø©: ${escapeHtml(invite.usedBy)}</span>
              </div>
            ` : `
              <span class="text-sm text-gray-400">âœ¨ Ù…ØªØ§Ø­ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</span>
            `}
          </div>
        </div>
      `).join('');
    }

    // Filter Ideas
    function filterIdeas(category) {
      currentFilter = category;
      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      updateUI();
    }

    // Helper Functions
    function getCategoryEmoji(category) {
      const emojis = { 'ØªÙ‚Ù†ÙŠØ©': 'ğŸ’»', 'ÙÙƒØ±ÙŠØ©': 'ğŸ§ ', 'Ø¥Ø¨Ø¯Ø§Ø¹ÙŠØ©': 'ğŸ¨', 'Ø¹Ù„Ù…ÙŠØ©': 'ğŸ”¬' };
      return emojis[category] || 'ğŸ’¡';
    }

    function getSuggestionEmoji(type) {
      const emojis = { 'ØªØµÙ…ÙŠÙ…': 'ğŸ¨', 'Ù…Ø­ØªÙˆÙ‰': 'ğŸ“', 'Ù…ÙŠØ²Ø§Øª': 'âœ¨', 'ØªØ­Ø³ÙŠÙ†Ø§Øª': 'ğŸ”§', 'Ø£Ø®Ø±Ù‰': 'ğŸ’¬' };
      return emojis[type] || 'ğŸ’¡';
    }

    function getStatusColor(status) {
      const colors = { 'pending': 'bg-yellow-500/30 text-yellow-400', 'approved': 'bg-green-500/30 text-green-400', 'rejected': 'bg-red-500/30 text-red-400' };
      return colors[status] || colors.pending;
    }

    function getStatusText(status) {
      const texts = { 'pending': 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©', 'approved': 'Ù…Ù‚Ø¨ÙˆÙ„', 'rejected': 'Ù…Ø±ÙÙˆØ¶' };
      return texts[status] || 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©';
    }

    function formatDate(dateStr) {
      if (!dateStr) return '';
      const date = new Date(dateStr);
      return date.toLocaleDateString('ar-SA', { year: 'numeric', month: 'short', day: 'numeric' });
    }

    function escapeHtml(text) {
      if (!text) return '';
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function generateRandomCode() {
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
      let code = '';
      for (let i = 0; i < 8; i++) {
        code += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return code;
    }

    function hasUserLiked(idea) {
      if (!idea.likedBy || !currentUser) return false;
      const likedArray = idea.likedBy.split(',').filter(u => u);
      return likedArray.includes(currentUser.name);
    }

    // Event Handlers - Login Form
    document.addEventListener('DOMContentLoaded', () => {
      const loginForm = document.getElementById('login-form');
      if (loginForm) {
        loginForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          
          const name = document.getElementById('login-name').value.trim();
          const specialty = document.getElementById('login-specialty').value.trim();

          let userRole = 'member';

          if (name === ADMIN_NAME && specialty === ADMIN_SPECIALTY) {
            userRole = 'admin';
          }

          if (recordCount >= 999) {
            showToast('ØªÙ… Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù…Ù† Ø§Ù„Ø³Ø¬Ù„Ø§Øª', 'error');
            return;
          }

          const btn = document.getElementById('login-btn');
          if (!btn) return;
          
          btn.disabled = true;
          btn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...';

          currentUser = {
            name,
            specialty,
            role: userRole
          };

          localStorage.setItem('museum_user', JSON.stringify(currentUser));

          const existingMember = appData.find(d => d.type === 'member' && d.title === name);
          
          if (!existingMember && window.dataSdk) {
            const result = await window.dataSdk.create({
              type: 'member',
              title: name,
              specialty: specialty,
              role: userRole,
              isAdmin: userRole === 'admin',
              createdAt: new Date().toISOString(),
              status: 'active',
              content: '',
              author: name,
              category: '',
              inviteCode: '',
              usedBy: '',
              likes: 0,
              likedBy: '',
              parentId: '',
              views: 0,
              tags: '',
              imageUrl: ''
            });
            
            if (!result.isOk) {
              showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„', 'error');
            }
          }

          btn.disabled = false;
          btn.textContent = 'ğŸš€ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…ØªØ­Ù';
          showDashboard();
          showToast(`Ù…Ø±Ø­Ø¨Ø§Ù‹ ${name}! ğŸ‰`);
        });
      }

      // Idea Form
      const ideaForm = document.getElementById('idea-form');
      if (ideaForm) {
        ideaForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          
          if (recordCount >= 999) {
            showToast('ØªÙ… Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù…Ù† Ø§Ù„Ø³Ø¬Ù„Ø§Øª', 'error');
            return;
          }

          const btn = document.getElementById('submit-idea-btn');
          if (!btn) return;
          
          btn.disabled = true;
          btn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù†Ø´Ø±...';

          const idea = {
            type: 'idea',
            title: document.getElementById('idea-title').value.trim(),
            category: document.getElementById('idea-category').value,
            content: document.getElementById('idea-content').value.trim(),
            author: currentUser.name,
            specialty: currentUser.specialty,
            status: 'active',
            createdAt: new Date().toISOString(),
            isAdmin: currentUser.role === 'admin',
            role: currentUser.role,
            inviteCode: '',
            usedBy: '',
            likes: 0,
            likedBy: '',
            parentId: '',
            views: 0,
            tags: currentTags.join(','),
            imageUrl: ''
          };

          if (window.dataSdk) {
            const result = await window.dataSdk.create(idea);
            if (result.isOk) {
              showToast('ØªÙ… Ù†Ø´Ø± ÙÙƒØ±ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­! âœ¨');
              closeModal('add-idea');
              document.getElementById('idea-form').reset();
              currentTags = [];
            } else {
              showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù†Ø´Ø± Ø§Ù„ÙÙƒØ±Ø©', 'error');
            }
          }

          btn.disabled = false;
          btn.textContent = 'ğŸš€ Ù†Ø´Ø± Ø§Ù„ÙÙƒØ±Ø©';
        });
      }

      // Suggestion Form
      const suggestionForm = document.getElementById('suggestion-form');
      if (suggestionForm) {
        suggestionForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          
          if (recordCount >= 999) {
            showToast('ØªÙ… Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù…Ù† Ø§Ù„Ø³Ø¬Ù„Ø§Øª', 'error');
            return;
          }

          const btn = document.getElementById('submit-suggestion-btn');
          if (!btn) return;
          
          btn.disabled = true;
          btn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';

          const suggestion = {
            type: 'suggestion',
            category: document.getElementById('suggestion-type').value,
            title: document.getElementById('suggestion-title').value.trim(),
            content: document.getElementById('suggestion-content').value.trim(),
            author: currentUser.name,
            specialty: currentUser.specialty,
            status: 'pending',
            createdAt: new Date().toISOString(),
            isAdmin: false,
            role: currentUser.role,
            inviteCode: '',
            usedBy: '',
            likes: 0,
            likedBy: '',
            parentId: '',
            views: 0,
            tags: '',
            imageUrl: ''
          };

          if (window.dataSdk) {
            const result = await window.dataSdk.create(suggestion);
            if (result.isOk) {
              showToast('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù‚ØªØ±Ø§Ø­Ùƒ Ø¨Ù†Ø¬Ø§Ø­! ğŸ’¡');
              closeModal('add-suggestion');
              document.getElementById('suggestion-form').reset();
            } else {
              showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­', 'error');
            }
          }

          btn.disabled = false;
          btn.textContent = 'ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­';
        });
      }

      // Delete Confirmation
      const confirmDeleteBtn = document.getElementById('confirm-delete-btn');
      if (confirmDeleteBtn) {
        confirmDeleteBtn.addEventListener('click', async () => {
          if (deleteTarget && window.dataSdk) {
            const item = appData.find(d => d.__backendId === deleteTarget.id);
            if (item) {
              const result = await window.dataSdk.delete(item);
              if (result.isOk) {
                showToast('ØªÙ… Ø§Ù„Ø­Ø°Ù Ø¨Ù†Ø¬Ø§Ø­');
                if (deleteTarget.type === 'idea' && !document.getElementById('idea-detail-section').classList.contains('hidden')) {
                  closeIdeaDetail();
                }
              } else {
                showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù', 'error');
              }
            }
          }
          closeModal('delete-confirm');
          deleteTarget = null;
        });
      }
    });

    // Admin Functions
    async function generateInviteCode() {
      if (recordCount >= 999) {
        showToast('ØªÙ… Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù…Ù† Ø§Ù„Ø³Ø¬Ù„Ø§Øª', 'error');
        return;
      }

      const code = generateRandomCode();
      
      if (window.dataSdk) {
        const result = await window.dataSdk.create({
          type: 'invite',
          inviteCode: code,
          usedBy: '',
          createdAt: new Date().toISOString(),
          status: 'active',
          title: `Ø±Ù…Ø² Ø¯Ø¹ÙˆØ© ${code}`,
          content: '',
          author: currentUser.name,
          specialty: '',
          category: '',
          isAdmin: false,
          role: '',
          likes: 0,
          likedBy: '',
          parentId: '',
          views: 0,
          tags: '',
          imageUrl: ''
        });
        
        if (result.isOk) {
          showToast(`ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø±Ù…Ø² Ø§Ù„Ø¯Ø¹ÙˆØ©: ${code} ğŸ«`);
        } else {
          showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø±Ù…Ø² Ø§Ù„Ø¯Ø¹ÙˆØ©', 'error');
        }
      }
    }

    function copyInviteCode(code) {
      navigator.clipboard.writeText(code).then(() => {
        showToast('ØªÙ… Ù†Ø³Ø® Ø±Ù…Ø² Ø§Ù„Ø¯Ø¹ÙˆØ© ğŸ“‹');
      }).catch(() => {
        showToast('ÙØ´Ù„ Ù†Ø³Ø® Ø§Ù„Ø±Ù…Ø²', 'error');
      });
    }

    async function toggleFeatured(id) {
      const item = appData.find(d => d.__backendId === id);
      if (item && window.dataSdk) {
        const newStatus = item.status === 'featured' ? 'active' : 'featured';
        const result = await window.dataSdk.update({ ...item, status: newStatus });
        if (result.isOk) {
          showToast(newStatus === 'featured' ? 'ØªÙ… ØªÙ…ÙŠÙŠØ² Ø§Ù„ÙÙƒØ±Ø© â­' : 'ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªÙ…ÙŠÙŠØ²');
        }
      }
    }

    async function updateSuggestionStatus(id, status) {
      const item = appData.find(d => d.__backendId === id);
      if (item && window.dataSdk) {
        const result = await window.dataSdk.update({ ...item, status });
        if (result.isOk) {
          showToast(status === 'approved' ? 'ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­ âœ…' : 'ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­ âŒ');
        }
      }
    }

    async function toggleLike(ideaId) {
      const idea = appData.find(d => d.__backendId === ideaId);
      if (!idea || !window.dataSdk) return;

      const likedByArray = idea.likedBy ? idea.likedBy.split(',').filter(u => u) : [];
      const hasLiked = likedByArray.includes(currentUser.name);
      
      let newLikedBy;
      let newLikes;
      
      if (hasLiked) {
        newLikedBy = likedByArray.filter(u => u !== currentUser.name).join(',');
        newLikes = Math.max(0, (idea.likes || 0) - 1);
      } else {
        likedByArray.push(currentUser.name);
        newLikedBy = likedByArray.join(',');
        newLikes = (idea.likes || 0) + 1;
      }
      
      const result = await window.dataSdk.update({
        ...idea,
        likes: newLikes,
        likedBy: newLikedBy
      });
      
      if (result.isOk) {
        showToast(hasLiked ? 'ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨' : 'ØªÙ… Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨ Ø¨Ø§Ù„ÙÙƒØ±Ø© â¤ï¸');
        const ideaDetailSection = document.getElementById('idea-detail-section');
        if (ideaDetailSection && !ideaDetailSection.classList.contains('hidden')) {
          openIdeaDetail(ideaId);
        }
      }
    }

    async function addComment(ideaId) {
      const commentInput = document.getElementById('comment-input');
      if (!commentInput) return;
      
      const commentText = commentInput.value.trim();
      
      if (!commentText) {
        showToast('Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© ØªØ¹Ù„ÙŠÙ‚', 'error');
        return;
      }

      if (recordCount >= 999) {
        showToast('ØªÙ… Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù…Ù† Ø§Ù„Ø³Ø¬Ù„Ø§Øª', 'error');
        return;
      }

      const btn = document.getElementById('add-comment-btn');
      if (!btn) return;
      
      btn.disabled = true;
      btn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';

      if (window.dataSdk) {
        const result = await window.dataSdk.create({
          type: 'comment',
          parentId: ideaId,
          content: commentText,
          author: currentUser.name,
          createdAt: new Date().toISOString(),
          title: '',
          specialty: currentUser.specialty,
          category: '',
          status: 'active',
          isAdmin: false,
          role: currentUser.role,
          inviteCode: '',
          usedBy: '',
          likes: 0,
          likedBy: '',
          views: 0,
          tags: '',
          imageUrl: ''
        });
        
        if (result.isOk) {
          showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© ØªØ¹Ù„ÙŠÙ‚Ùƒ ğŸ’¬');
          commentInput.value = '';
          openIdeaDetail(ideaId);
        } else {
          showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ‚', 'error');
        }
      }

      btn.disabled = false;
      btn.textContent = 'ğŸ’¬ Ø¥Ø±Ø³Ø§Ù„';
    }

    function confirmDelete(type, id) {
      deleteTarget = { type, id };
      const texts = { idea: 'Ù‡Ø°Ù‡ Ø§Ù„ÙÙƒØ±Ø©', member: 'Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø¶Ùˆ', suggestion: 'Ù‡Ø°Ø§ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­', invite: 'Ø±Ù…Ø² Ø§Ù„Ø¯Ø¹ÙˆØ© Ù‡Ø°Ø§' };
      const deleteConfirmText = document.getElementById('delete-confirm-text');
      if (deleteConfirmText) {
        deleteConfirmText.textContent = `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ${texts[type]}ØŸ`;
      }
      openModal('delete-confirm');
    }

    function confirmClearAllData() {
      const deleteConfirmText = document.getElementById('delete-confirm-text');
      if (deleteConfirmText) {
        deleteConfirmText.textContent = 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡!';
      }
      
      const confirmBtn = document.getElementById('confirm-delete-btn');
      if (confirmBtn) {
        const oldHandler = confirmBtn.onclick;
        confirmBtn.onclick = async () => {
          if (window.dataSdk) {
            for (const item of appData) {
              await window.dataSdk.delete(item);
            }
            showToast('ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
          }
          closeModal('delete-confirm');
          confirmBtn.onclick = oldHandler;
        };
      }
      
      openModal('delete-confirm');
    }

    function exportData() {
      const dataStr = JSON.stringify(appData, null, 2);
      const blob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `museum_backup_${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);
      showToast('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ ğŸ“¤');
    }

    async function syncNow() {
      showSyncStatus('syncing', 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©...');
      localStorage.removeItem('museum_cache');
      localStorage.removeItem('museum_cache_time');
      await loadFromSupabase();
      showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ğŸ”„');
    }

    function clearCache() {
      localStorage.removeItem('museum_cache');
      localStorage.removeItem('museum_cache_time');
      showToast('ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø¤Ù‚ØªØ© ğŸ—„ï¸');
      window.location.reload();
    }

    function logout() {
      localStorage.removeItem('museum_user');
      currentUser = null;
      showLogin();
      showToast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬');
    }

    // Idea Detail Functions
    async function openIdeaDetail(ideaId) {
      const idea = appData.find(d => d.__backendId === ideaId);
      if (!idea) return;

      const newViews = (idea.views || 0) + 1;
      if (window.dataSdk) {
        await window.dataSdk.update({ ...idea, views: newViews });
      }

      const comments = appData.filter(d => d.type === 'comment' && d.parentId === ideaId);
      const likeCount = idea.likes || 0;
      const viewCount = idea.views || 0;
      const hasLiked = hasUserLiked(idea);

      const detailContent = document.getElementById('idea-detail-content');
      if (!detailContent) return;
      
      detailContent.innerHTML = `
        <div class="glass-effect rounded-3xl p-8 space-y-6">
          <div class="flex justify-between items-start flex-wrap gap-4">
            <div class="flex-1">
              <div class="flex items-center gap-2 mb-3">
                <span class="category-badge rounded-full bg-pink-600/30 text-pink-400 text-sm">
                  ${getCategoryEmoji(idea.category)} ${idea.category}
                </span>
                ${idea.status === 'featured' ? '<span class="text-yellow-400 text-2xl">â­</span>' : ''}
              </div>
              <h1 class="text-4xl font-bold mb-4">${escapeHtml(idea.title)}</h1>
              ${idea.tags ? `
                <div class="flex flex-wrap gap-2 mb-3">
                  ${idea.tags.split(',').map(tag => `<span class="text-sm bg-pink-500/20 text-pink-400 px-3 py-1 rounded-full">#${escapeHtml(tag.trim())}</span>`).join('')}
                </div>
              ` : ''}
            </div>
            ${currentUser?.role === 'admin' ? `
              <div class="flex gap-2">
                <button onclick="toggleFeatured('${idea.__backendId}')" class="p-3 rounded-xl bg-white/10 hover:bg-yellow-500/30 transition" title="ØªÙ…ÙŠÙŠØ²">
                  ${idea.status === 'featured' ? 'â­ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªÙ…ÙŠÙŠØ²' : 'â˜† ØªÙ…ÙŠÙŠØ²'}
                </button>
                <button onclick="confirmDelete('idea', '${idea.__backendId}')" class="p-3 rounded-xl bg-white/10 hover:bg-red-500/30 transition" title="Ø­Ø°Ù">
                  ğŸ—‘ï¸ Ø­Ø°Ù
                </button>
              </div>
            ` : ''}
          </div>

          <div class="flex items-center gap-4 pb-6 border-b border-white/10">
            <div class="w-16 h-16 rounded-full bg-gradient-to-r from-pink-600 to-orange-500 flex items-center justify-center text-2xl">
              ${idea.role === 'admin' ? 'ğŸ‘‘' : 'ğŸ’¡'}
            </div>
            <div>
              <h3 class="font-bold text-lg">${escapeHtml(idea.author)}</h3>
              <p class="text-gray-400">${escapeHtml(idea.specialty || 'Ø¹Ø¶Ùˆ')}</p>
              <p class="text-sm text-gray-500">${formatDate(idea.createdAt)}</p>
            </div>
          </div>

          <div class="prose prose-invert max-w-none">
            <div class="text-lg text-gray-300 leading-relaxed whitespace-pre-wrap">${escapeHtml(idea.content)}</div>
          </div>

          <div class="flex items-center gap-4 pt-6 border-t border-white/10">
            <button onclick="toggleLike('${idea.__backendId}')" class="flex items-center gap-2 px-4 py-2 rounded-xl ${hasLiked ? 'bg-pink-600' : 'bg-white/10'} hover:bg-pink-600/80 transition">
              <span>â¤ï¸</span>
              <span>${likeCount}</span>
              <span class="text-sm">${hasLiked ? 'Ø£Ø¹Ø¬Ø¨Ù†ÙŠ' : 'Ø¥Ø¹Ø¬Ø§Ø¨'}</span>
            </button>
            <div class="flex items-center gap-2 px-4 py-2 rounded-xl bg-white/10">
              <span>ğŸ‘ï¸</span>
              <span>${viewCount}</span>
              <span class="text-sm">Ù…Ø´Ø§Ù‡Ø¯Ø©</span>
            </div>
            <div class="flex items-center gap-2 px-4 py-2 rounded-xl bg-white/10">
              <span>ğŸ’¬</span>
              <span>${comments.length}</span>
              <span class="text-sm">ØªØ¹Ù„ÙŠÙ‚</span>
            </div>
          </div>

          <div class="pt-6 border-t border-white/10">
            <h3 class="text-xl font-bold mb-4">Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª (${comments.length})</h3>
            
            <div class="mb-6 bg-white/5 rounded-xl p-4">
              <textarea id="comment-input" rows="3" 
                class="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/20 text-white placeholder-gray-400 focus:outline-none focus:border-pink-500 resize-none"
                placeholder="Ø§ÙƒØªØ¨ ØªØ¹Ù„ÙŠÙ‚Ùƒ Ù‡Ù†Ø§..."></textarea>
              <button onclick="addComment('${idea.__backendId}')" id="add-comment-btn"
                class="mt-3 px-6 py-2 rounded-xl bg-gradient-to-r from-pink-600 to-orange-500 hover:opacity-90 transition">
                ğŸ’¬ Ø¥Ø±Ø³Ø§Ù„
              </button>
            </div>
            
            <div class="space-y-4">
              ${comments.length === 0 ? '<p class="text-gray-400 text-center py-4">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø¨Ø¹Ø¯. ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠØ¹Ù„Ù‚!</p>' : ''}
              ${comments.map(comment => `
                <div class="bg-white/5 rounded-xl p-4">
                  <div class="flex items-start gap-3">
                    <div class="w-10 h-10 rounded-full bg-gradient-to-r from-pink-600 to-orange-500 flex items-center justify-center">
                      ${comment.role === 'admin' ? 'ğŸ‘‘' : 'ğŸ’¡'}
                    </div>
                    <div class="flex-1">
                      <div class="flex items-center gap-2 mb-1">
                        <span class="font-bold">${escapeHtml(comment.author)}</span>
                        <span class="text-xs text-gray-500">${formatDate(comment.createdAt)}</span>
                      </div>
                      <p class="text-gray-300">${escapeHtml(comment.content)}</p>
                    </div>
                  </div>
                </div>
              `).join('')}
            </div>
          </div>
        </div>
      `;

      document.querySelectorAll('#main-content > section:not(#idea-detail-section)').forEach(s => s.classList.add('hidden'));
      const ideaDetailSection = document.getElementById('idea-detail-section');
      if (ideaDetailSection) {
        ideaDetailSection.classList.remove('hidden');
      }
    }

    function closeIdeaDetail() {
      const ideaDetailSection = document.getElementById('idea-detail-section');
      if (ideaDetailSection) {
        ideaDetailSection.classList.add('hidden');
      }
      
      const activeSidebarBtn = document.querySelector('.sidebar-item.active');
      if (activeSidebarBtn) {
        const section = activeSidebarBtn.getAttribute('data-section');
        const sectionElement = document.getElementById(`${section}-section`);
        if (sectionElement) {
          sectionElement.classList.remove('hidden');
        }
      } else {
        const homeSection = document.getElementById('home-section');
        if (homeSection) {
          homeSection.classList.remove('hidden');
        }
      }
    }

    // Initialize on load
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initApp);
    } else {
      initApp();
    }
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9bbfa3fa26348a49',t:'MTc2ODA4NDQ1My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
