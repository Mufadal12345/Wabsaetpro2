<!doctype html>
<html lang="ar" dir="rtl" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ØªØ­Ù Ø§Ù„ÙÙƒØ± - Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ Ø§Ù„ÙÙƒØ±ÙŠ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&amp;family=Amiri:wght@400;700&amp;display=swap" rel="stylesheet">
    <style>
        /* ... Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ... */
    </style>
    <style>@view-transition { navigation: auto; }</style>
</head>
<body class="h-full w-full gradient-bg text-white overflow-hidden">
    <!-- Menu Toggle Button (Mobile) -->
    <button id="menuToggle" onclick="toggleSidebar()" class="menu-toggle w-14 h-14 rounded-full flex items-center justify-center text-2xl hidden">ğŸ›ï¸</button>
    
    <!-- Sidebar Overlay (Mobile) -->
    <div id="sidebarOverlay" class="sidebar-overlay" onclick="toggleSidebar()"></div>
    
    <!-- Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ... -->
    
    <div id="app" class="h-full w-full">
        <!-- Login Screen -->
        <div id="loginScreen" class="h-full w-full flex items-center justify-center p-4 overflow-auto">
            <!-- ... Ù…Ø­ØªÙˆÙ‰ Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø³Ø§Ø¨Ù‚ ... -->
        </div>
        
        <!-- Main App -->
        <div id="mainApp" class="h-full w-full hidden flex">
            <!-- ... Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø§Ù„Ø³Ø§Ø¨Ù‚ ... -->
        </div>
    </div>
    
    <!-- Toast Container -->
    <div id="toastContainer" class="fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-80 z-50 space-y-2"></div>

    <script>
        // ============================================
        // Firebase Configuration
        // ============================================
        const firebaseConfig = {
            apiKey: "AIzaSyAVp26636YGOwPIT8X6kWsxKWEnta3A0G4",
            authDomain: "ideas-museum.firebaseapp.com",
            projectId: "ideas-museum",
            storageBucket: "ideas-museum.firebasestorage.app",
            messagingSenderId: "776953892130",
            appId: "1:776953892130:web:b72d1a6e4c9b5f8290697b",
            measurementId: "G-FNKDJSJLE6"
        };

        // Initialize Firebase
        try {
            firebase.initializeApp(firebaseConfig);
        } catch (error) {
            console.log("Firebase already initialized");
        }
        
        const db = firebase.firestore();
        const auth = firebase.auth();
        
        // Initialize Google Auth Provider
        const googleProvider = new firebase.auth.GoogleAuthProvider();
        
        // Email Mode State
        let emailMode = 'login'; // 'login' or 'register'

        // App State
        let appData = {
            users: [],
            ideas: [],
            content: [],
            suggestions: [],
            codes: [],
            quotes: [],
            messages: [],
            courses: [],
            comments: []
        };
        
        let currentUser = null;
        let currentPage = 'home';
        let currentFilter = 'all';
        let currentCourseFilter = 'all';
        let confirmAction = null;
        let viewedIdeas = new Set();
        let currentIdeaId = null;
        let replyingToCommentId = null;

        // Admin Credentials
        const ADMINS = [
            { name: 'Rasha', specialty: '20250929' },
            { name: 'MUF', specialty: 'CS' }
        ];

        // Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª ÙˆØ§Ù„Ù…Ø¯Ø§Ù„ÙŠØ§Øª
        const ACHIEVEMENTS_SYSTEM = {
            levels: [
                { level: 1, name: "Ù…Ø¨ØªØ¯Ø¦", points: 0, color: "text-gray-400" },
                { level: 2, name: "Ù…Ø´Ø§Ø±Ùƒ", points: 50, color: "text-blue-400" },
                { level: 3, name: "Ù†Ø´Ø·", points: 100, color: "text-green-400" },
                { level: 4, name: "Ù…Ù…ÙŠØ²", points: 200, color: "text-purple-400" },
                { level: 5, name: "Ø±Ø§Ø¦Ø¯", points: 500, color: "text-yellow-400" },
                { level: 6, name: "Ø®Ø¨ÙŠØ±", points: 1000, color: "text-orange-400" },
                { level: 7, name: "Ø£Ø³Ø·ÙˆØ±Ø©", points: 2000, color: "text-red-400" }
            ],
            
            badges: {
                'Ø£ÙˆÙ„ ÙÙƒØ±Ø©': { icon: 'ğŸ¥‡', points: 10, description: 'Ù†Ø´Ø± Ø£ÙˆÙ„ ÙÙƒØ±Ø©' },
                'Ù…ÙÙƒØ± Ù†Ø´Ø·': { icon: 'ğŸ’¡', points: 25, description: 'Ù†Ø´Ø± 5 Ø£ÙÙƒØ§Ø±' },
                'Ù…Ø¨Ø¯Ø¹': { icon: 'âœ¨', points: 50, description: 'Ù†Ø´Ø± 10 Ø£ÙÙƒØ§Ø±' },
                'Ù‚Ø§Ø¦Ø¯ Ø§Ù„Ø£ÙÙƒØ§Ø±': { icon: 'ğŸ‘‘', points: 100, description: 'Ù†Ø´Ø± 20 ÙÙƒØ±Ø©' },
                'Ø£ÙˆÙ„ ØªØ¹Ù„ÙŠÙ‚': { icon: 'ğŸ’¬', points: 5, description: 'Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ ØªØ¹Ù„ÙŠÙ‚' },
                'Ù…Ø¹Ù„Ù‚ Ù†Ø´Ø·': { icon: 'ğŸ—£ï¸', points: 20, description: '10 ØªØ¹Ù„ÙŠÙ‚Ø§Øª' },
                'Ù…ØªÙˆØ§ØµÙ„': { icon: 'ğŸ”', points: 30, description: 'Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª' },
                'Ù…Ø­Ø¨ÙˆØ¨': { icon: 'â¤ï¸', points: 15, description: '10 Ø¥Ø¹Ø¬Ø§Ø¨Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª' },
                'Ø´Ø¹Ø¨ÙŠ': { icon: 'ğŸ”¥', points: 40, description: 'ÙÙƒØ±Ø© Ø­ØµÙ„Øª Ø¹Ù„Ù‰ 50 Ù…Ø´Ø§Ù‡Ø¯Ø©' },
                'Ù…Ø¤Ø«Ø±': { icon: 'â­', points: 75, description: 'ÙÙƒØ±Ø© Ø­ØµÙ„Øª Ø¹Ù„Ù‰ 100 Ù…Ø´Ø§Ù‡Ø¯Ø©' },
                'Ù†Ø§Ø´Ø· Ø§Ù„Ù…Ø¬ØªÙ…Ø¹': { icon: 'ğŸ†', points: 150, description: '100 Ù†Ù‚Ø·Ø© Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©' },
                'Ø£Ø³Ø·ÙˆØ±Ø© Ø§Ù„Ù…ØªØ­Ù': { icon: 'ğŸ›ï¸', points: 500, description: '500 Ù†Ù‚Ø·Ø© Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©' }
            }
        };

        // Default Quotes
        const DEFAULT_QUOTES = [
            { text: "Ø§Ù„Ø¹Ù‚Ù„ ÙƒØ§Ù„Ù…Ø¸Ù„Ø©ØŒ Ù„Ø§ ÙŠØ¹Ù…Ù„ Ø¥Ù„Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙØªÙˆØ­Ø§Ù‹", author: "Ø­ÙƒÙ…Ø© Ø´Ø¹Ø¨ÙŠØ©", id: "default_1", isDefault: true },
            { text: "Ø£Ù†Ø§ Ø£ÙÙƒØ±ØŒ Ø¥Ø°Ù† Ø£Ù†Ø§ Ù…ÙˆØ¬ÙˆØ¯", author: "Ø±ÙŠÙ†ÙŠÙ‡ Ø¯ÙŠÙƒØ§Ø±Øª", id: "default_2", isDefault: true },
            { text: "Ø§Ù„ÙÙƒØ±Ø© Ù‡ÙŠ Ø§Ù„Ø¨Ø°Ø±Ø©ØŒ ÙˆØ§Ù„Ø¹Ù‚Ù„ Ù‡Ùˆ Ø§Ù„ØªØ±Ø¨Ø©ØŒ ÙˆØ§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ Ù‡Ùˆ Ø§Ù„Ø«Ù…Ø±Ø©", author: "Ù…Ù† Ø­ÙƒÙ… Ù…ØªØ­Ù Ø§Ù„ÙÙƒØ±", id: "default_3", isDefault: true }
        ];

        const CATEGORY_ICONS = {
            'ÙÙ„Ø³ÙØ©': 'ğŸ§ ', 'ØªÙ‚Ù†ÙŠØ©': 'ğŸ’»', 'Ø£Ø¯Ø¨': 'ğŸ“–', 
            'Ø¹Ù„ÙˆÙ…': 'ğŸ”¬', 'ÙÙ†': 'ğŸ¨', 'Ø§Ø¬ØªÙ…Ø§Ø¹': 'ğŸ‘¥'
        };

        const COURSE_ICONS = {
            'Ù‚Ù†Ø§Ø© ÙŠÙˆØªÙŠÙˆØ¨': 'ğŸ“º', 'ÙƒÙˆØ±Ø³ Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†': 'ğŸ“', 'Ù…Ù†ØµØ© ØªØ¹Ù„ÙŠÙ…ÙŠØ©': 'ğŸ’»',
            'Ù…Ù‚Ø§Ù„Ø§Øª': 'ğŸ“', 'ÙƒØªØ¨': 'ğŸ“š', 'Ø¨ÙˆØ¯ÙƒØ§Ø³Øª': 'ğŸ™ï¸'
        };

        // ============================================
        // Initialize App
        // ============================================
        async function initApp() {
            try {
                console.log("Initializing app...");
                
                // Check for saved user
                const savedUser = localStorage.getItem('muf_user');
                if (savedUser) {
                    try {
                        currentUser = JSON.parse(savedUser);
                        console.log("Found saved user:", currentUser.name);
                        await loadAllData();
                        showMainApp();
                        return;
                    } catch (e) {
                        console.error("Error parsing saved user:", e);
                        localStorage.removeItem('muf_user');
                    }
                }
                
                // Set up auth state listener
                auth.onAuthStateChanged(async (user) => {
                    console.log("Auth state changed:", user ? "User signed in" : "User signed out");
                    if (user) {
                        await handleAuthenticatedUser(user);
                    } else {
                        // User signed out, do nothing
                    }
                });
                
                // Initial render of quotes
                renderQuotes();
                
                // Show menu toggle on mobile
                if (window.innerWidth < 769) {
                    document.getElementById('menuToggle').classList.remove('hidden');
                }
                
                // Handle window resize
                window.addEventListener('resize', handleWindowResize);
                
                // Test Firebase connection
                try {
                    const testDoc = await db.collection('test').doc('test').get();
                    console.log("Firebase connected successfully");
                } catch (error) {
                    console.error("Firebase connection error:", error);
                    showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
                }
                
            } catch (error) {
                console.error('Error initializing app:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚', 'error');
            }
        }

        function handleWindowResize() {
            if (window.innerWidth < 769) {
                document.getElementById('menuToggle').classList.remove('hidden');
            } else {
                document.getElementById('menuToggle').classList.add('hidden');
                document.getElementById('sidebar').classList.remove('sidebar-open');
                document.getElementById('sidebarOverlay').classList.remove('active');
            }
        }

        // ============================================
        // Auth Functions
        // ============================================
        function switchAuthTab(tab) {
            document.getElementById('tabTraditional').classList.remove('active');
            document.getElementById('tabEmail').classList.remove('active');
            document.getElementById(`tab${tab.charAt(0).toUpperCase() + tab.slice(1)}`).classList.add('active');
            
            document.getElementById('traditionalLogin').classList.add('hidden');
            document.getElementById('emailLogin').classList.add('hidden');
            document.getElementById(`${tab}Login`).classList.remove('hidden');
            
            if (tab === 'email') {
                emailMode = 'login';
                document.getElementById('emailToggleText').textContent = 'Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯';
                document.getElementById('emailAuthBtnText').textContent = 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
                document.getElementById('registerFields').classList.add('hidden');
                document.getElementById('emailLoginFields').classList.remove('hidden');
            }
        }

        function toggleEmailMode() {
            if (emailMode === 'login') {
                emailMode = 'register';
                document.getElementById('emailToggleText').textContent = 'Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
                document.getElementById('emailAuthBtnText').textContent = 'Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨';
                document.getElementById('registerFields').classList.remove('hidden');
            } else {
                emailMode = 'login';
                document.getElementById('emailToggleText').textContent = 'Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯';
                document.getElementById('emailAuthBtnText').textContent = 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
                document.getElementById('registerFields').classList.add('hidden');
            }
        }

        // Traditional Login (Admin Only)
        async function handleTraditionalLogin() {
            const name = document.getElementById('loginName').value.trim();
            const specialty = document.getElementById('loginSpecialty').value.trim();
            
            if (!name || !specialty) {
                showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠØ± ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±', 'error');
                return;
            }
            
            const btnText = document.getElementById('traditionalLoginBtnText');
            const spinner = document.getElementById('traditionalLoginSpinner');
            
            btnText.classList.add('hidden');
            spinner.classList.remove('hidden');
            
            try {
                // Check if user is banned
                const bannedUsers = appData.users.filter(u => u.isBanned);
                const isBanned = bannedUsers.some(u => u.name === name);
                
                if (isBanned) {
                    showToast('Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ø­Ø¸ÙˆØ± Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø¯ÙŠØ±', 'error');
                    btnText.classList.remove('hidden');
                    spinner.classList.add('hidden');
                    return;
                }
                
                // Check admin credentials
                const isAdmin = ADMINS.find(admin => 
                    admin.name === name && admin.specialty === specialty
                );
                
                if (!isAdmin) {
                    showToast('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯ÙŠØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
                    btnText.classList.remove('hidden');
                    spinner.classList.add('hidden');
                    return;
                }
                
                // Create admin user object
                const adminUser = {
                    id: `admin_${name}_${Date.now()}`,
                    email: null,
                    name: name,
                    specialty: specialty,
                    role: 'admin',
                    points: 1000,
                    ideasCount: 0,
                    commentsCount: 0,
                    createdAt: new Date().toISOString(),
                    level: 7,
                    achievements: ['Ø£Ø³Ø·ÙˆØ±Ø© Ø§Ù„Ù…ØªØ­Ù', 'Ù‚Ø§Ø¦Ø¯ Ø§Ù„Ø£ÙÙƒØ§Ø±']
                };
                
                // Check if admin exists in Firestore
                const existingAdmin = appData.users.find(u => u.name === name && u.role === 'admin');
                if (!existingAdmin) {
                    // Save admin to Firestore
                    await db.collection('users').doc(adminUser.id).set(adminUser);
                }
                
                // Set current user
                currentUser = adminUser;
                
                // Save to localStorage
                localStorage.setItem('muf_user', JSON.stringify(adminUser));
                
                // Load data and show app
                await loadAllData();
                showMainApp();
                
                showToast(`Ù…Ø±Ø­Ø¨Ø§Ù‹ ${name}!`, 'success');
                
            } catch (error) {
                console.error('Traditional login error:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„', 'error');
            } finally {
                btnText.classList.remove('hidden');
                spinner.classList.add('hidden');
            }
        }

        // Email Authentication
        async function handleEmailAuth() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value.trim();
            const btnText = document.getElementById('emailAuthBtnText');
            const spinner = document.getElementById('emailAuthSpinner');
            
            if (emailMode === 'login') {
                if (!email || !password) {
                    showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±', 'error');
                    return;
                }
                
                btnText.classList.add('hidden');
                spinner.classList.remove('hidden');
                
                try {
                    const userCredential = await auth.signInWithEmailAndPassword(email, password);
                    console.log("Email login successful");
                } catch (error) {
                    console.error('Login error:', error);
                    showToast('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: ' + error.message, 'error');
                } finally {
                    btnText.classList.remove('hidden');
                    spinner.classList.add('hidden');
                }
            } else {
                // Register mode
                const name = document.getElementById('registerName').value.trim();
                const specialty = document.getElementById('registerSpecialty').value.trim();
                const code = document.getElementById('registerCode').value.trim();
                
                if (!email || !password || !name || !specialty) {
                    showToast('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
                    return;
                }
                
                btnText.classList.add('hidden');
                spinner.classList.remove('hidden');
                
                try {
                    const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                    const user = userCredential.user;
                    
                    console.log("Registration successful, user ID:", user.uid);
                    
                    // Prepare user data
                    let userData = {
                        id: user.uid,
                        email: user.email,
                        name: name,
                        specialty: specialty,
                        role: 'user',
                        points: 0,
                        ideasCount: 0,
                        commentsCount: 0,
                        createdAt: new Date().toISOString(),
                        level: 1,
                        achievements: []
                    };
                    
                    // Check if promotion code is provided
                    if (code) {
                        const codeDoc = await db.collection('codes').doc(code).get();
                        if (codeDoc.exists && !codeDoc.data().used) {
                            userData.role = 'premium';
                            // Mark code as used
                            await db.collection('codes').doc(code).update({
                                used: true,
                                usedBy: user.uid,
                                usedAt: new Date().toISOString()
                            });
                            showToast('ØªÙ… Ø§Ù„ØªØ±Ù‚ÙŠØ© Ø¥Ù„Ù‰ Ø¹Ø¶Ùˆ Ù…Ù…ÙŠØ²!', 'success');
                        } else if (code) {
                            showToast('Ø±Ù…Ø² Ø§Ù„ØªØ±Ù‚ÙŠØ© ØºÙŠØ± ØµØ§Ù„Ø­ Ø£Ùˆ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¨Ù‚Ø§Ù‹', 'warning');
                        }
                    }
                    
                    // Save user data to Firestore
                    await db.collection('users').doc(user.uid).set(userData);
                    console.log("User data saved to Firestore");
                    
                    // Set current user and save to localStorage
                    currentUser = userData;
                    localStorage.setItem('muf_user', JSON.stringify(userData));
                    
                    // Load data and show app
                    await loadAllData();
                    showMainApp();
                    
                    showToast('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                    
                } catch (error) {
                    console.error('Registration error:', error);
                    if (error.code === 'auth/email-already-in-use') {
                        showToast('Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„', 'error');
                    } else if (error.code === 'auth/weak-password') {
                        showToast('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¶Ø¹ÙŠÙØ©ØŒ ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', 'error');
                    } else {
                        showToast('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨: ' + error.message, 'error');
                    }
                } finally {
                    btnText.classList.remove('hidden');
                    spinner.classList.add('hidden');
                }
            }
        }

        // Google Authentication
        async function handleGoogleLogin() {
            try {
                const result = await auth.signInWithPopup(googleProvider);
                const user = result.user;
                
                console.log("Google login successful, user:", user.displayName);
                
            } catch (error) {
                console.error('Google login error:', error);
                if (error.code === 'auth/popup-closed-by-user') {
                    showToast('ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„', 'info');
                } else {
                    showToast('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø¬ÙˆØ¬Ù„: ' + error.message, 'error');
                }
            }
        }

        // Handle Authenticated User
        async function handleAuthenticatedUser(user) {
            try {
                console.log("Handling authenticated user:", user.uid);
                
                // Get user data from Firestore
                const userDoc = await db.collection('users').doc(user.uid).get();
                
                if (userDoc.exists) {
                    // User exists in Firestore
                    currentUser = { id: user.uid, ...userDoc.data() };
                    console.log("User found in Firestore:", currentUser.name);
                } else {
                    // New user - create user data
                    let role = 'user';
                    let name = user.displayName || 'Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯';
                    
                    // Check if it's a Google user
                    if (user.providerData && user.providerData[0].providerId === 'google.com') {
                        name = user.displayName || 'Ù…Ø³ØªØ®Ø¯Ù… Ø¬ÙˆØ¬Ù„';
                    }
                    
                    const userData = {
                        id: user.uid,
                        email: user.email,
                        name: name,
                        specialty: 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
                        role: role,
                        points: 0,
                        ideasCount: 0,
                        commentsCount: 0,
                        createdAt: new Date().toISOString(),
                        level: 1,
                        achievements: []
                    };
                    
                    // Save to Firestore
                    await db.collection('users').doc(user.uid).set(userData);
                    currentUser = userData;
                    console.log("New user created in Firestore:", currentUser.name);
                }
                
                // Save to localStorage
                localStorage.setItem('muf_user', JSON.stringify(currentUser));
                console.log("User saved to localStorage");
                
                // Load all data
                await loadAllData();
                
                // Show main app
                showMainApp();
                
                showToast(`Ù…Ø±Ø­Ø¨Ø§Ù‹ ${currentUser.name}!`, 'success');
                
            } catch (error) {
                console.error('Error handling authenticated user:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', 'error');
            }
        }

        // ============================================
        // Core Functions
        // ============================================
        async function loadAllData() {
            try {
                console.log("Loading all data...");
                
                // Load users
                const usersSnapshot = await db.collection('users').get();
                appData.users = usersSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                console.log("Users loaded:", appData.users.length);
                
                // Load ideas
                const ideasSnapshot = await db.collection('ideas').get();
                appData.ideas = ideasSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                console.log("Ideas loaded:", appData.ideas.length);
                
                // Load comments
                const commentsSnapshot = await db.collection('comments').get();
                appData.comments = commentsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                console.log("Comments loaded:", appData.comments.length);
                
                // Load quotes
                const quotesSnapshot = await db.collection('quotes').get();
                const userQuotes = quotesSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                appData.quotes = [...DEFAULT_QUOTES, ...userQuotes];
                console.log("Quotes loaded:", appData.quotes.length);
                
                // Load courses
                const coursesSnapshot = await db.collection('courses').get();
                appData.courses = coursesSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                console.log("Courses loaded:", appData.courses.length);
                
                // Load messages
                const messagesSnapshot = await db.collection('messages').get();
                appData.messages = messagesSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                console.log("Messages loaded:", appData.messages.length);
                
                // Load suggestions
                const suggestionsSnapshot = await db.collection('suggestions').get();
                appData.suggestions = suggestionsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                console.log("Suggestions loaded:", appData.suggestions.length);
                
                // Load codes
                const codesSnapshot = await db.collection('codes').get();
                appData.codes = codesSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                console.log("Codes loaded:", appData.codes.length);
                
                // Update UI
                updateUIAfterDataLoad();
                
                showToast('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                
            } catch (error) {
                console.error('Error loading data:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
            }
        }

        function updateUIAfterDataLoad() {
            if (!currentUser) return;
            
            console.log("Updating UI for user:", currentUser.name);
            
            // Update user info in sidebar
            document.getElementById('currentUserName').textContent = currentUser.name;
            document.getElementById('currentUserSpecialty').textContent = currentUser.specialty;
            document.getElementById('userRoleDisplay').textContent = 
                currentUser.role === 'admin' ? 'Ù…Ø¯ÙŠØ±' : 
                currentUser.role === 'premium' ? 'Ø¹Ø¶Ùˆ Ù…Ù…ÙŠØ²' : 'Ø¹Ø¶Ùˆ';
            
            // Update user avatar
            const avatar = document.getElementById('userAvatar');
            avatar.textContent = currentUser.role === 'admin' ? 'ğŸ‘‘' : 
                                currentUser.role === 'premium' ? 'ğŸ’¡' : 'ğŸ‘¤';
            
            // Update user level
            updateUserLevelDisplay();
            
            // Update achievements badge
            updateAchievementsBadge();
            
            // Show/hide admin menu items
            const adminMenu = document.getElementById('adminMenuItems');
            const userMessageButton = document.getElementById('userMessageButton');
            if (currentUser.role === 'admin') {
                adminMenu.classList.remove('hidden');
                userMessageButton.classList.add('hidden');
            } else {
                adminMenu.classList.add('hidden');
                userMessageButton.classList.remove('hidden');
            }
            
            // Show/hide add idea button based on role
            const addIdeaBtn = document.getElementById('addIdeaBtn');
            if (currentUser.role === 'admin' || currentUser.role === 'premium') {
                addIdeaBtn.classList.remove('hidden');
            } else {
                addIdeaBtn.classList.add('hidden');
            }
            
            // Update welcome name
            document.getElementById('welcomeName').textContent = currentUser.name.split(' ')[0];
            
            // Update stats
            updateStats();
            
            // Render current page
            renderPage(currentPage);
        }

        function showMainApp() {
            console.log("Showing main app");
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
        }

        // ============================================
        // Navigation
        // ============================================
        function navigateTo(page) {
            // Update sidebar active item
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.page === page) {
                    item.classList.add('active');
                }
            });
            
            // Hide all pages
            document.querySelectorAll('.page-content').forEach(pageElement => {
                pageElement.classList.add('hidden');
            });
            
            // Show selected page
            const pageElement = document.getElementById(page + 'Page');
            if (pageElement) {
                pageElement.classList.remove('hidden');
                currentPage = page;
                renderPage(page);
            }
            
            // Close sidebar on mobile
            if (window.innerWidth < 769) {
                toggleSidebar();
            }
        }

        function renderPage(page) {
            switch(page) {
                case 'home':
                    renderHomePage();
                    break;
                case 'ideas':
                    renderIdeasPage();
                    break;
                case 'comments':
                    renderCommentsPage();
                    break;
                case 'leaderboard':
                    renderLeaderboardPage();
                    break;
                case 'content':
                    renderContentPage();
                    break;
                case 'philosophy':
                    // Static page, already loaded
                    break;
                case 'quotes':
                    renderQuotesPage();
                    break;
                case 'skills':
                    renderSkillsPage();
                    break;
                case 'suggestions':
                    renderSuggestionsPage();
                    break;
                case 'members':
                    renderMembersPage();
                    break;
                case 'messages':
                    renderMessagesPage();
                    break;
                case 'codes':
                    renderCodesPage();
                    break;
                case 'settings':
                    renderSettingsPage();
                    break;
            }
        }

        // ============================================
        // Modal Functions
        // ============================================
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('hidden');
                document.body.style.overflow = 'auto';
            }
        }

        function openAddIdeaModal() {
            if (!currentUser) return;
            if (currentUser.role === 'user') {
                showToast('ÙŠØ¬Ø¨ ØªØ±Ù‚ÙŠØ© Ø­Ø³Ø§Ø¨Ùƒ Ù„Ù†Ø´Ø± Ø§Ù„Ø£ÙÙƒØ§Ø±', 'error');
                return;
            }
            openModal('addIdeaModal');
        }

        function openAddQuoteModal() {
            openModal('addQuoteModal');
        }

        function openAddCourseModal() {
            openModal('addCourseModal');
        }

        function openMessageAdminModal() {
            openModal('messageAdminModal');
        }

        function openRequestCodeModal() {
            document.getElementById('messageType').value = 'Ø·Ù„Ø¨ Ø±Ù…Ø² ØªØ±Ù‚ÙŠØ©';
            openModal('messageAdminModal');
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            if (window.innerWidth < 769) {
                sidebar.classList.toggle('sidebar-open');
                overlay.classList.toggle('active');
            }
        }

        // ============================================
        // Data Management Functions
        // ============================================
        async function submitNewIdea() {
            const title = document.getElementById('newIdeaTitle').value.trim();
            const category = document.getElementById('newIdeaCategory').value;
            const content = document.getElementById('newIdeaContent').value.trim();
            
            if (!title || !content) {
                showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† ÙˆÙ…Ø­ØªÙˆÙ‰ Ø§Ù„ÙÙƒØ±Ø©', 'error');
                return;
            }
            
            try {
                const ideaData = {
                    title: title,
                    category: category,
                    content: content,
                    authorId: currentUser.id,
                    authorName: currentUser.name,
                    authorRole: currentUser.role,
                    views: 0,
                    likes: 0,
                    commentsCount: 0,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                // Add to Firestore
                const docRef = await db.collection('ideas').add(ideaData);
                
                // Update user's ideas count
                await db.collection('users').doc(currentUser.id).update({
                    ideasCount: firebase.firestore.FieldValue.increment(1)
                });
                
                // Add points to user
                await addUserPoints(currentUser.id, 10);
                
                // Update local data
                ideaData.id = docRef.id;
                appData.ideas.unshift(ideaData);
                
                showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙÙƒØ±Ø© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                closeModal('addIdeaModal');
                
                // Navigate to ideas page
                navigateTo('ideas');
                
            } catch (error) {
                console.error('Error adding idea:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙÙƒØ±Ø©', 'error');
            }
        }

        async function submitNewQuote() {
            const text = document.getElementById('newQuoteText').value.trim();
            const author = document.getElementById('newQuoteAuthor').value.trim() || 'Ù…Ø¬Ù‡ÙˆÙ„';
            
            if (!text) {
                showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù†Øµ Ø§Ù„Ø¹Ø¨Ø§Ø±Ø©', 'error');
                return;
            }
            
            try {
                const quoteData = {
                    text: text,
                    author: author,
                    addedBy: currentUser.id,
                    addedByName: currentUser.name,
                    addedAt: new Date().toISOString(),
                    likes: 0
                };
                
                // Add to Firestore
                await db.collection('quotes').add(quoteData);
                
                showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø¨Ø§Ø±Ø© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                closeModal('addQuoteModal');
                
                // Update quotes
                await loadAllData();
                
            } catch (error) {
                console.error('Error adding quote:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø¨Ø§Ø±Ø©', 'error');
            }
        }

        async function submitNewCourse() {
            const title = document.getElementById('newCourseTitle').value.trim();
            const type = document.getElementById('newCourseType').value;
            const description = document.getElementById('newCourseDescription').value.trim();
            const link = document.getElementById('newCourseLink').value.trim();
            
            if (!title || !description) {
                showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† ÙˆÙˆØµÙ Ø§Ù„Ù…ØµØ¯Ø±', 'error');
                return;
            }
            
            try {
                const courseData = {
                    title: title,
                    type: type,
                    description: description,
                    link: link || null,
                    addedBy: currentUser.id,
                    addedByName: currentUser.name,
                    addedAt: new Date().toISOString(),
                    likes: 0
                };
                
                // Add to Firestore
                await db.collection('courses').add(courseData);
                
                showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ØµØ¯Ø± Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                closeModal('addCourseModal');
                
                // Update courses
                await loadAllData();
                
            } catch (error) {
                console.error('Error adding course:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ØµØ¯Ø±', 'error');
            }
        }

        async function sendMessageToAdmin() {
            const title = document.getElementById('messageTitle').value.trim();
            const type = document.getElementById('messageType').value;
            const content = document.getElementById('messageContent').value.trim();
            
            if (!title || !content) {
                showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† ÙˆÙ…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø³Ø§Ù„Ø©', 'error');
                return;
            }
            
            try {
                const messageData = {
                    title: title,
                    type: type,
                    content: content,
                    fromUserId: currentUser.id,
                    fromUserName: currentUser.name,
                    fromUserRole: currentUser.role,
                    isRead: false,
                    createdAt: new Date().toISOString()
                };
                
                // Add to Firestore
                await db.collection('messages').add(messageData);
                
                showToast('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                closeModal('messageAdminModal');
                
                // Update messages
                await loadAllData();
                
            } catch (error) {
                console.error('Error sending message:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©', 'error');
            }
        }

        // ============================================
        // User Functions
        // ============================================
        async function handleLogout() {
            try {
                // Sign out from Firebase
                await auth.signOut();
                
                // Clear local data
                currentUser = null;
                localStorage.removeItem('muf_user');
                
                // Show login screen
                document.getElementById('loginScreen').classList.remove('hidden');
                document.getElementById('mainApp').classList.add('hidden');
                
                // Reset login forms
                document.getElementById('loginEmail').value = '';
                document.getElementById('loginPassword').value = '';
                document.getElementById('loginName').value = '';
                document.getElementById('loginSpecialty').value = '';
                
                showToast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                
            } catch (error) {
                console.error('Logout error:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬', 'error');
            }
        }

        async function addUserPoints(userId, points) {
            try {
                const userRef = db.collection('users').doc(userId);
                await userRef.update({
                    points: firebase.firestore.FieldValue.increment(points)
                });
                
                // Update local user data
                const user = appData.users.find(u => u.id === userId);
                if (user) {
                    user.points = (user.points || 0) + points;
                    user.level = calculateLevel(user.points);
                }
                
                // Update current user if needed
                if (currentUser && currentUser.id === userId) {
                    currentUser.points += points;
                    currentUser.level = calculateLevel(currentUser.points);
                    updateUserLevelDisplay();
                    updateStats();
                }
                
            } catch (error) {
                console.error('Error adding user points:', error);
            }
        }

        function calculateLevel(points) {
            for (let i = ACHIEVEMENTS_SYSTEM.levels.length - 1; i >= 0; i--) {
                if (points >= ACHIEVEMENTS_SYSTEM.levels[i].points) {
                    return ACHIEVEMENTS_SYSTEM.levels[i].level;
                }
            }
            return 1;
        }

        function updateUserLevelDisplay() {
            const levelContainer = document.getElementById('userLevel');
            if (!currentUser || !levelContainer) return;
            
            const currentLevel = ACHIEVEMENTS_SYSTEM.levels.find(l => l.level === currentUser.level) || ACHIEVEMENTS_SYSTEM.levels[0];
            const nextLevel = ACHIEVEMENTS_SYSTEM.levels.find(l => l.level === currentUser.level + 1);
            
            let progress = 0;
            if (nextLevel) {
                const currentLevelPoints = currentLevel.points;
                const nextLevelPoints = nextLevel.points;
                const pointsNeeded = nextLevelPoints - currentLevelPoints;
                const pointsAchieved = currentUser.points - currentLevelPoints;
                progress = Math.min(100, Math.round((pointsAchieved / pointsNeeded) * 100));
            } else {
                progress = 100;
            }
            
            levelContainer.innerHTML = `
                <div class="flex justify-between text-xs mb-1">
                    <span class="${currentLevel.color}">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${currentUser.level}: ${currentLevel.name}</span>
                    <span>${currentUser.points} Ù†Ù‚Ø·Ø©</span>
                </div>
                <div class="level-indicator">
                    <div class="level-progress" style="width: ${progress}%"></div>
                </div>
            `;
        }

        function updateAchievementsBadge() {
            const badge = document.getElementById('achievementsBadge');
            if (!currentUser || !badge) return;
            
            const achievements = currentUser.achievements || [];
            
            if (achievements.length > 0) {
                badge.textContent = achievements.length;
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        }

        // ============================================
        // Page Rendering Functions
        // ============================================
        function renderHomePage() {
            // Update quote of the day
            const quoteOfDay = document.getElementById('quoteOfDay');
            const quoteAuthor = document.getElementById('quoteAuthor');
            
            if (appData.quotes.length > 0) {
                const randomQuote = appData.quotes[Math.floor(Math.random() * appData.quotes.length)];
                quoteOfDay.textContent = `"${randomQuote.text}"`;
                quoteAuthor.textContent = `- ${randomQuote.author}`;
            }
            
            // Update stats
            updateStats();
            
            // Render popular content
            renderPopularContent();
            
            // Render latest ideas
            renderLatestIdeas();
            
            // Hide admin stats for regular users
            if (currentUser.role !== 'admin') {
                document.getElementById('adminStats').classList.add('hidden');
            }
        }

        function updateStats() {
            if (!currentUser) return;
            
            // User stats
            document.getElementById('userIdeasCount').textContent = currentUser.ideasCount || 0;
            document.getElementById('userCommentsCount').textContent = currentUser.commentsCount || 0;
            document.getElementById('userPoints').textContent = currentUser.points || 0;
            
            // Admin stats (only show for admin)
            if (currentUser.role === 'admin') {
                document.getElementById('adminStats').classList.remove('hidden');
                
                const totalIdeas = appData.ideas.length;
                const totalViews = appData.ideas.reduce((sum, idea) => sum + (idea.views || 0), 0);
                const totalMembers = appData.users.length;
                const totalInteractions = appData.comments.length + 
                                        appData.ideas.reduce((sum, idea) => sum + (idea.likes || 0), 0);
                
                document.getElementById('totalIdeas').textContent = totalIdeas;
                document.getElementById('totalViews').textContent = totalViews;
                document.getElementById('totalMembers').textContent = totalMembers;
                document.getElementById('totalInteractions').textContent = totalInteractions;
            }
        }

        function renderPopularContent() {
            const popularContentGrid = document.getElementById('popularContentGrid');
            
            // Get most viewed ideas
            const popularIdeas = [...appData.ideas]
                .sort((a, b) => (b.views || 0) - (a.views || 0))
                .slice(0, 3);
            
            if (popularIdeas.length === 0) {
                popularContentGrid.innerHTML = `
                    <div class="glass-card rounded-xl p-6 text-center text-gray-400 col-span-3">
                        <p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø­ØªÙˆÙ‰ Ø´Ø§Ø¦Ø¹ Ø¨Ø¹Ø¯</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            popularIdeas.forEach((idea, index) => {
                const isTrending = index === 0;
                
                html += `
                    <div class="popular-content-card glass-card rounded-xl p-6 card-hover relative">
                        ${isTrending ? '<span class="trending-badge">ğŸ”¥</span>' : ''}
                        <div class="flex items-center gap-3 mb-4">
                            <span class="text-2xl">${CATEGORY_ICONS[idea.category] || 'ğŸ’¡'}</span>
                            <div class="flex-1">
                                <h4 class="font-bold line-clamp-1">${idea.title}</h4>
                                <p class="text-xs text-gray-400">${idea.authorName}</p>
                            </div>
                        </div>
                        <p class="text-sm text-gray-300 line-clamp-2 mb-4">${idea.content.substring(0, 100)}...</p>
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-gray-400">ğŸ‘ï¸ ${idea.views || 0}</span>
                            <button onclick="openIdeaDetailsModal('${idea.id}')" class="text-pink-400 hover:text-pink-300">
                                Ø§Ù‚Ø±Ø£ Ø§Ù„Ù…Ø²ÙŠØ¯
                            </button>
                        </div>
                    </div>
                `;
            });
            
            popularContentGrid.innerHTML = html;
        }

        function renderLatestIdeas() {
            const latestIdeasGrid = document.getElementById('latestIdeasGrid');
            
            const latestIdeas = [...appData.ideas]
                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
                .slice(0, 6);
            
            if (latestIdeas.length === 0) {
                latestIdeasGrid.innerHTML = `
                    <div class="glass-card rounded-xl p-6 text-center text-gray-400 col-span-3">
                        <p class="text-5xl mb-4">ğŸ’­</p>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙÙƒØ§Ø± Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</p>
                        <p class="text-sm mt-2">ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠØ´Ø§Ø±Ùƒ ÙÙƒØ±Ø©!</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            latestIdeas.forEach(idea => {
                html += `
                    <div class="glass-card rounded-xl p-6 card-hover">
                        <div class="flex justify-between items-start mb-3">
                            <span class="category-tag px-3 py-1 rounded-full text-sm">
                                ${CATEGORY_ICONS[idea.category] || 'ğŸ’¡'} ${idea.category}
                            </span>
                            <span class="text-xs text-gray-500">${new Date(idea.createdAt).toLocaleDateString('ar-EG')}</span>
                        </div>
                        <h4 class="font-bold mb-3 line-clamp-1">${idea.title}</h4>
                        <p class="text-sm text-gray-300 mb-4 line-clamp-2">${idea.content.substring(0, 80)}...</p>
                        <div class="flex justify-between items-center text-sm">
                            <div class="flex items-center gap-2">
                                <span class="text-gray-400">ğŸ‘¤ ${idea.authorName}</span>
                            </div>
                            <button onclick="openIdeaDetailsModal('${idea.id}')" class="text-pink-400 hover:text-pink-300">
                                Ø§Ù„ØªÙØ§ØµÙŠÙ„
                            </button>
                        </div>
                    </div>
                `;
            });
            
            latestIdeasGrid.innerHTML = html;
        }

        function renderIdeasPage() {
            const ideasGrid = document.getElementById('ideasGrid');
            
            let filteredIdeas = [...appData.ideas];
            if (currentFilter !== 'all') {
                filteredIdeas = filteredIdeas.filter(idea => idea.category === currentFilter);
            }
            
            filteredIdeas.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            if (filteredIdeas.length === 0) {
                ideasGrid.innerHTML = `
                    <div class="glass-card rounded-xl p-6 text-center text-gray-400 col-span-full">
                        <p class="text-5xl mb-4">ğŸ’­</p>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙÙƒØ§Ø± ${currentFilter !== 'all' ? 'ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ØªØµÙ†ÙŠÙ' : ''}</p>
                        <p class="text-sm mt-2">ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠØ´Ø§Ø±Ùƒ ÙÙƒØ±Ø©!</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            filteredIdeas.forEach(idea => {
                html += `
                    <div class="glass-card rounded-xl p-6 card-hover">
                        <div class="flex justify-between items-start mb-3">
                            <span class="category-tag px-3 py-1 rounded-full text-sm">
                                ${CATEGORY_ICONS[idea.category] || 'ğŸ’¡'} ${idea.category}
                            </span>
                            <span class="text-xs text-gray-500">${new Date(idea.createdAt).toLocaleDateString('ar-EG')}</span>
                        </div>
                        <h4 class="font-bold mb-3">${idea.title}</h4>
                        <p class="text-sm text-gray-300 mb-4 line-clamp-3">${idea.content.substring(0, 150)}...</p>
                        <div class="flex justify-between items-center text-sm">
                            <div class="flex items-center gap-4">
                                <span class="text-gray-400 flex items-center gap-1">
                                    ğŸ‘ï¸ ${idea.views || 0}
                                </span>
                                <span class="text-gray-400 flex items-center gap-1">
                                    ğŸ’¬ ${idea.commentsCount || 0}
                                </span>
                                <span class="text-gray-400 flex items-center gap-1">
                                    â¤ï¸ ${idea.likes || 0}
                                </span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="text-gray-400 text-xs">ğŸ‘¤ ${idea.authorName}</span>
                                <button onclick="openIdeaDetailsModal('${idea.id}')" class="text-pink-400 hover:text-pink-300 text-sm">
                                    Ø§Ù„ØªÙØ§ØµÙŠÙ„
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            ideasGrid.innerHTML = html;
        }

        function filterIdeas(category) {
            currentFilter = category;
            
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.filter === category) {
                    btn.classList.add('active');
                }
            });
            
            renderIdeasPage();
        }

        // ============================================
        // Comment System
        // ============================================
        async function openIdeaDetailsModal(ideaId) {
            const idea = appData.ideas.find(i => i.id === ideaId);
            if (!idea) return;
            
            currentIdeaId = ideaId;
            
            // Increment views
            if (!viewedIdeas.has(ideaId)) {
                viewedIdeas.add(ideaId);
                await db.collection('ideas').doc(ideaId).update({
                    views: firebase.firestore.FieldValue.increment(1)
                });
                idea.views++;
            }
            
            // Set modal content
            document.getElementById('ideaDetailsTitle').textContent = idea.title;
            
            const detailsContent = document.getElementById('ideaDetailsContent');
            detailsContent.innerHTML = `
                <div class="glass-card rounded-xl p-6">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <span class="category-tag px-3 py-1 rounded-full text-sm">
                                ${CATEGORY_ICONS[idea.category] || 'ğŸ’¡'} ${idea.category}
                            </span>
                            <p class="text-sm text-gray-400 mt-2">
                                ${idea.authorName} â€¢ ${new Date(idea.createdAt).toLocaleDateString('ar-EG')}
                            </p>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="text-gray-400 text-sm flex items-center gap-1">
                                ğŸ‘ï¸ ${idea.views}
                            </span>
                            <span class="text-gray-400 text-sm flex items-center gap-1">
                                ğŸ’¬ ${idea.commentsCount || 0}
                            </span>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <h4 class="text-lg font-bold mb-3">ÙˆØµÙ Ø§Ù„ÙÙƒØ±Ø©</h4>
                        <p class="text-gray-300 leading-relaxed whitespace-pre-line">${idea.content}</p>
                    </div>
                    
                    <div class="flex justify-between items-center pt-4 border-t border-white/10">
                        <div class="flex items-center gap-4">
                            <button onclick="likeIdea('${ideaId}')" class="flex items-center gap-2 text-gray-400 hover:text-pink-400">
                                <span>â¤ï¸</span>
                                <span>${idea.likes || 0}</span>
                            </button>
                            ${currentUser.role === 'admin' ? `
                            <button onclick="deleteIdea('${ideaId}')" class="text-red-400 hover:text-red-300 text-sm">
                                Ø­Ø°Ù Ø§Ù„ÙÙƒØ±Ø©
                            </button>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
            
            // Load comments
            await loadCommentsForIdea(ideaId);
            
            openModal('ideaDetailsModal');
        }

        async function loadCommentsForIdea(ideaId) {
            const commentsList = document.getElementById('commentsList');
            const commentsCount = document.getElementById('commentsCount');
            
            const ideaComments = appData.comments
                .filter(c => c.ideaId === ideaId)
                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            commentsCount.textContent = ideaComments.length;
            
            if (ideaComments.length === 0) {
                commentsList.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <p class="text-lg mb-2">ğŸ’­</p>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø¨Ø¹Ø¯</p>
                        <p class="text-sm">ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠØ¹Ù„Ù‚!</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            for (const comment of ideaComments) {
                const user = appData.users.find(u => u.id === comment.userId);
                const isAdmin = user?.role === 'admin';
                const isPremium = user?.role === 'premium';
                
                html += `
                    <div class="comment-bubble ${isAdmin ? 'border-r-4 border-yellow-500' : isPremium ? 'border-r-4 border-purple-500' : ''}">
                        <div class="flex justify-between items-start mb-2">
                            <div class="flex items-center gap-2">
                                <span class="text-lg">${isAdmin ? 'ğŸ‘‘' : isPremium ? 'ğŸ’¡' : 'ğŸ‘¤'}</span>
                                <span class="font-bold">${comment.userName}</span>
                                ${isAdmin ? '<span class="role-badge role-admin text-xs">Ù…Ø¯ÙŠØ±</span>' : ''}
                                ${isPremium ? '<span class="role-badge role-premium text-xs">Ù…Ù…ÙŠØ²</span>' : ''}
                            </div>
                            <span class="text-xs text-gray-500">${new Date(comment.createdAt).toLocaleString('ar-EG')}</span>
                        </div>
                        <p class="text-gray-300 mb-3 whitespace-pre-line">${comment.text}</p>
                        
                        <div class="comment-actions">
                            <button onclick="likeComment('${comment.id}')" class="comment-like-btn ${comment.likedBy && comment.likedBy.includes(currentUser.id) ? 'liked' : ''}">
                                <span>â¤ï¸</span>
                                <span>${comment.likes || 0}</span>
                            </button>
                            
                            <button onclick="replyToComment('${comment.id}')" class="text-blue-400 hover:text-blue-300 text-sm">
                                Ø±Ø¯
                            </button>
                            
                            ${currentUser.role === 'admin' || currentUser.id === comment.userId ? `
                            <button onclick="deleteComment('${comment.id}')" class="text-red-400 hover:text-red-300 text-sm mr-auto">
                                Ø­Ø°Ù
                            </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            }
            
            commentsList.innerHTML = html;
        }

        async function submitComment() {
            const text = document.getElementById('newCommentText').value.trim();
            
            if (!text) {
                showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù†Øµ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚', 'error');
                return;
            }
            
            if (!currentIdeaId) {
                showToast('Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ ÙÙƒØ±Ø©', 'error');
                return;
            }
            
            try {
                const commentData = {
                    text: text,
                    ideaId: currentIdeaId,
                    userId: currentUser.id,
                    userName: currentUser.name,
                    userRole: currentUser.role,
                    likes: 0,
                    likedBy: [],
                    replies: [],
                    createdAt: new Date().toISOString()
                };
                
                // Add comment to Firestore
                const docRef = await db.collection('comments').add(commentData);
                
                // Update idea's comments count
                await db.collection('ideas').doc(currentIdeaId).update({
                    commentsCount: firebase.firestore.FieldValue.increment(1)
                });
                
                // Update user's comments count
                await db.collection('users').doc(currentUser.id).update({
                    commentsCount: firebase.firestore.FieldValue.increment(1)
                });
                
                // Add points for comment
                await addUserPoints(currentUser.id, 5);
                
                // Clear comment textarea
                document.getElementById('newCommentText').value = '';
                
                // Reload comments
                await loadAllData();
                await loadCommentsForIdea(currentIdeaId);
                
                showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                
            } catch (error) {
                console.error('Error adding comment:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ‚', 'error');
            }
        }

        async function likeComment(commentId) {
            const comment = appData.comments.find(c => c.id === commentId);
            if (!comment) return;
            
            try {
                const commentRef = db.collection('comments').doc(commentId);
                
                if (comment.likedBy && comment.likedBy.includes(currentUser.id)) {
                    // Unlike
                    await commentRef.update({
                        likes: firebase.firestore.FieldValue.increment(-1),
                        likedBy: firebase.firestore.FieldValue.arrayRemove(currentUser.id)
                    });
                    comment.likes--;
                    if (comment.likedBy) {
                        comment.likedBy = comment.likedBy.filter(id => id !== currentUser.id);
                    }
                } else {
                    // Like
                    await commentRef.update({
                        likes: firebase.firestore.FieldValue.increment(1),
                        likedBy: firebase.firestore.FieldValue.arrayUnion(currentUser.id)
                    });
                    comment.likes = (comment.likes || 0) + 1;
                    if (!comment.likedBy) comment.likedBy = [];
                    comment.likedBy.push(currentUser.id);
                }
                
                // Reload comments
                await loadCommentsForIdea(currentIdeaId);
                
            } catch (error) {
                console.error('Error liking comment:', error);
            }
        }

        function replyToComment(commentId) {
            replyingToCommentId = commentId;
            const comment = appData.comments.find(c => c.id === commentId);
            if (comment) {
                document.getElementById('newCommentText').placeholder = `Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ ${comment.userName}...`;
                document.getElementById('newCommentText').focus();
            }
        }

        async function likeIdea(ideaId) {
            const idea = appData.ideas.find(i => i.id === ideaId);
            if (!idea) return;
            
            try {
                const ideaRef = db.collection('ideas').doc(ideaId);
                
                await ideaRef.update({
                    likes: firebase.firestore.FieldValue.increment(1)
                });
                
                idea.likes = (idea.likes || 0) + 1;
                
                showToast('ØªÙ… Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨ Ø¨Ø§Ù„ÙÙƒØ±Ø©!', 'success');
                
                await loadAllData();
                if (currentIdeaId === ideaId) {
                    await loadCommentsForIdea(ideaId);
                }
                
            } catch (error) {
                console.error('Error liking idea:', error);
            }
        }

        async function deleteIdea(ideaId) {
            if (currentUser.role !== 'admin') {
                showToast('Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ø­Ø°Ù Ø§Ù„Ø£ÙÙƒØ§Ø±', 'error');
                return;
            }
            
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„ÙÙƒØ±Ø©ØŸ')) return;
            
            try {
                await db.collection('ideas').doc(ideaId).delete();
                
                appData.ideas = appData.ideas.filter(i => i.id !== ideaId);
                
                closeModal('ideaDetailsModal');
                
                showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„ÙÙƒØ±Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                
                renderIdeasPage();
                
            } catch (error) {
                console.error('Error deleting idea:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„ÙÙƒØ±Ø©', 'error');
            }
        }

        async function deleteComment(commentId) {
            const comment = appData.comments.find(c => c.id === commentId);
            if (!comment) return;
            
            if (currentUser.role !== 'admin' && currentUser.id !== comment.userId) {
                showToast('Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚', 'error');
                return;
            }
            
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ØŸ')) return;
            
            try {
                await db.collection('comments').doc(commentId).delete();
                
                if (comment.ideaId) {
                    await db.collection('ideas').doc(comment.ideaId).update({
                        commentsCount: firebase.firestore.FieldValue.increment(-1)
                    });
                }
                
                showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                
                await loadAllData();
                if (currentIdeaId) {
                    await loadCommentsForIdea(currentIdeaId);
                }
                
            } catch (error) {
                console.error('Error deleting comment:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„ØªØ¹Ù„ÙŠÙ‚', 'error');
            }
        }

        // ============================================
        // Other Pages
        // ============================================
        function renderQuotesPage() {
            const quotesGrid = document.getElementById('quotesGrid');
            
            let quotesToShow = [...appData.quotes];
            
            if (quotesToShow.length === 0) {
                quotesGrid.innerHTML = `
                    <div class="glass-card rounded-xl p-6 text-center text-gray-400 col-span-full">
                        <p class="text-5xl mb-4">âœ¨</p>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ø¨Ø§Ø±Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</p>
                        <p class="text-sm mt-2">Ø£Ø¶Ù Ø£ÙˆÙ„ Ø¹Ø¨Ø§Ø±Ø© Ù…Ù„Ù‡Ù…Ø©!</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            quotesToShow.forEach(quote => {
                html += `
                    <div class="glass-card rounded-xl p-6 card-hover">
                        <div class="text-4xl mb-4">ğŸ’­</div>
                        <p class="text-lg font-amiri leading-relaxed mb-4">"${quote.text}"</p>
                        <div class="flex justify-between items-center pt-4 border-t border-white/10">
                            <span class="text-sm text-gray-400">${quote.author}</span>
                            ${quote.addedByName ? `
                                <span class="text-xs text-gray-500">Ø£Ø¶ÙŠÙØª Ø¨ÙˆØ§Ø³Ø·Ø© ${quote.addedByName}</span>
                            ` : ''}
                        </div>
                    </div>
                `;
            });
            
            quotesGrid.innerHTML = html;
        }

        function filterCourses(type) {
            currentCourseFilter = type;
            
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.filter === type) {
                    btn.classList.add('active');
                }
            });
            
            renderSkillsPage();
        }

        function renderSkillsPage() {
            const coursesGrid = document.getElementById('coursesGrid');
            
            let filteredCourses = [...appData.courses];
            if (currentCourseFilter !== 'all') {
                filteredCourses = filteredCourses.filter(course => course.type === currentCourseFilter);
            }
            
            filteredCourses.sort((a, b) => new Date(b.addedAt) - new Date(a.addedAt));
            
            if (filteredCourses.length === 0) {
                coursesGrid.innerHTML = `
                    <div class="course-card glass-card rounded-xl p-6 text-center text-gray-400 col-span-full">
                        <p class="text-5xl mb-4">ğŸš€</p>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ØµØ§Ø¯Ø± ØªØ¹Ù„ÙŠÙ…ÙŠØ© ${currentCourseFilter !== 'all' ? 'Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ù†ÙˆØ¹' : ''}</p>
                        <p class="text-sm mt-2">Ø£Ø¶Ù Ø£ÙˆÙ„ Ù…ØµØ¯Ø± ØªØ¹Ù„ÙŠÙ…ÙŠ!</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            filteredCourses.forEach(course => {
                html += `
                    <div class="course-card glass-card rounded-xl p-6 card-hover">
                        <div class="flex items-center gap-3 mb-4">
                            <span class="text-3xl">${COURSE_ICONS[course.type] || 'ğŸ“š'}</span>
                            <div>
                                <h4 class="font-bold">${course.title}</h4>
                                <p class="text-xs text-gray-400">${course.type}</p>
                            </div>
                        </div>
                        
                        <p class="text-sm text-gray-300 mb-4 line-clamp-3">${course.description}</p>
                        
                        ${course.link ? `
                            <a href="${course.link}" target="_blank" class="text-blue-400 hover:text-blue-300 text-sm flex items-center gap-2 mb-4">
                                <span>ğŸ”—</span>
                                <span>Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ø±Ø§Ø¨Ø·</span>
                            </a>
                        ` : ''}
                        
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-gray-400">Ø£Ø¶ÙŠÙØª Ø¨ÙˆØ§Ø³Ø·Ø© ${course.addedByName}</span>
                            <span class="text-xs text-gray-500">${new Date(course.addedAt).toLocaleDateString('ar-EG')}</span>
                        </div>
                    </div>
                `;
            });
            
            coursesGrid.innerHTML = html;
        }

        // ============================================
        // Toast Function
        // ============================================
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');
            
            const toast = document.createElement('div');
            toast.className = `toast glass-card rounded-xl p-4 shadow-lg border-r-4 ${
                type === 'success' ? 'border-green-500' :
                type === 'error' ? 'border-red-500' :
                type === 'warning' ? 'border-yellow-500' : 'border-blue-500'
            }`;
            
            const icon = type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : type === 'warning' ? 'âš ï¸' : 'â„¹ï¸';
            
            toast.innerHTML = `
                <div class="flex items-center gap-3">
                    <span class="text-xl">${icon}</span>
                    <p class="flex-1">${message}</p>
                </div>
            `;
            
            toastContainer.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateY(10px)';
                setTimeout(() => {
                    toastContainer.removeChild(toast);
                }, 300);
            }, 5000);
        }

        // ============================================
        // Initialize on Load
        // ============================================
        window.onload = initApp;

        // Export functions to global scope
        window.switchAuthTab = switchAuthTab;
        window.toggleEmailMode = toggleEmailMode;
        window.handleTraditionalLogin = handleTraditionalLogin;
        window.handleEmailAuth = handleEmailAuth;
        window.handleGoogleLogin = handleGoogleLogin;
        window.handleLogout = handleLogout;
        window.navigateTo = navigateTo;
        window.toggleSidebar = toggleSidebar;
        window.openAddIdeaModal = openAddIdeaModal;
        window.openAddQuoteModal = openAddQuoteModal;
        window.openAddCourseModal = openAddCourseModal;
        window.openMessageAdminModal = openMessageAdminModal;
        window.openRequestCodeModal = openRequestCodeModal;
        window.submitNewIdea = submitNewIdea;
        window.submitNewQuote = submitNewQuote;
        window.submitNewCourse = submitNewCourse;
        window.sendMessageToAdmin = sendMessageToAdmin;
        window.openIdeaDetailsModal = openIdeaDetailsModal;
        window.submitComment = submitComment;
        window.likeComment = likeComment;
        window.replyToComment = replyToComment;
        window.likeIdea = likeIdea;
        window.deleteIdea = deleteIdea;
        window.deleteComment = deleteComment;
        window.filterIdeas = filterIdeas;
        window.filterCourses = filterCourses;

    </script>
</body>
</html>