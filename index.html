<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¨ÙˆØ§Ø¨Ø© Ù…Ù†Ø§Ø±Ø© Ø§Ù„ÙÙƒØ± - Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠØ©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="./config.js"></script> 
    
    <style>
        body { font-family: 'Inter', system-ui, sans-serif; }
        .main-bg { background: linear-gradient(135deg, #1f2937 0%, #111827 100%); }
        .section-body-rendered p { margin-bottom: 1rem; }
        .highlight-quote { border-right: 4px solid #f59e0b; background: #fffbeb; padding: 1rem; font-style: italic; }
        .hidden { display: none; }
    </style>
</head>
<body class="main-bg min-h-screen flex items-center justify-center p-4 text-gray-800">

    <div id="app" class="w-full max-w-4xl bg-stone-100 shadow-2xl rounded-xl p-6 md:p-10 transition-all">
        
        <div id="registration-view">
            <h1 class="text-3xl font-extrabold text-blue-900 mb-6 text-center">Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ Ù…Ù†Ø§Ø±Ø© Ø§Ù„ÙÙƒØ±</h1>
            <p class="text-gray-600 mb-8 text-center">Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù„ØªØ¨Ø¯Ø£ ÙÙŠ Ø§Ø³ØªÙƒØ´Ø§Ù Ø£Ø«Ø±Ùƒ Ø§Ù„ÙÙƒØ±ÙŠ.</p>
            <form id="registration-form" class="space-y-6">
                <input type="text" id="reg-name" placeholder="Ø§Ù„Ø§Ø³Ù…" required class="w-full px-4 py-3 border rounded-lg focus:ring-blue-800 outline-none">
                <input type="text" id="reg-spec" placeholder="Ø§Ù„ØªØ®ØµØµ" required class="w-full px-4 py-3 border rounded-lg focus:ring-blue-800 outline-none">
                <button type="submit" class="w-full py-3 bg-blue-800 text-white rounded-lg font-bold hover:bg-blue-900 transition">Ø¯Ø®ÙˆÙ„</button>
            </form>
            <p id="reg-error" class="text-red-600 text-center mt-4 hidden">Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø©</p>
        </div>

        <div id="home-view" class="hidden">
            <div class="flex justify-between items-center mb-6 border-b pb-4">
                <h2 class="text-2xl font-bold text-blue-900">Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙƒØŒ <span id="user-name-display"></span></h2>
                <button onclick="location.reload()" class="text-sm text-red-600">Ø®Ø±ÙˆØ¬</button>
            </div>
            <div id="dynamic-sections-list" class="space-y-3"></div>
        </div>

        <div id="management-view" class="hidden">
            <div class="flex justify-between items-center mb-8 border-b-2 border-rose-200 pb-4">
                <h1 class="text-2xl font-bold text-rose-800">ğŸ” Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠØ©</h1>
                <button onclick="location.reload()" class="bg-gray-200 px-3 py-1 rounded">Ø®Ø±ÙˆØ¬</button>
            </div>

            <div class="flex gap-4 mb-6">
                <button onclick="showAdminTab('sections')" class="flex-1 py-2 bg-blue-700 text-white rounded-lg">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰</button>
                <button onclick="showAdminTab('users')" class="flex-1 py-2 bg-emerald-700 text-white rounded-lg">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø¶Ù…ÙŠÙ† ğŸ‘¥</button>
            </div>

            <div id="admin-sections-tab">
                <button onclick="openEditor('new')" class="mb-4 w-full py-2 bg-emerald-600 text-white rounded">+ Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù… Ø¬Ø¯ÙŠØ¯</button>
                <div id="editable-sections-list" class="space-y-2"></div>
            </div>

            <div id="admin-users-tab" class="hidden">
                <h3 class="font-bold mb-4 text-gray-700">Ø§Ù„Ø£Ø´Ø®Ø§Øµ Ø§Ù„Ø°ÙŠÙ† Ø³Ø¬Ù„ÙˆØ§ Ø¯Ø®ÙˆÙ„Ù‡Ù…:</h3>
                <div id="joiners-list" class="bg-white rounded-lg shadow divide-y">
                    <p class="p-4 text-center text-gray-400">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø¶Ù…ÙŠÙ†...</p>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getDatabase, ref, set, push, onValue, get } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";

        const app = initializeApp(window.FIREBASE_CONFIG);
        const db = getDatabase(app);
        const auth = getAuth(app);

        // Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¬Ù‡ÙˆÙ„ Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø§ØªØµØ§Ù„
        signInAnonymously(auth);

        // ÙˆØ¸ÙŠÙØ© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§ØªÙ‡ ÙÙŠ Firebase
        document.getElementById('registration-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('reg-name').value.trim();
            const spec = document.getElementById('reg-spec').value.trim();

            // ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø¯ÙŠØ± (Rasha)
            if (name === window.ADMIN_CREDENTIALS.name && spec === window.ADMIN_CREDENTIALS.specialty) {
                loadAdminData();
                showView('management-view');
                return;
            }

            // Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¹Ø§Ø¯ÙŠ: Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ ÙØ±Ø¹ "joiners"
            const newUserRef = push(ref(db, 'joiners'));
            await set(newUserRef, {
                name: name,
                specialty: spec,
                date: new Date().toLocaleString('ar-DZ')
            });

            document.getElementById('user-name-display').textContent = name;
            loadHomeData();
            showView('home-view');
        });

        // Ù…ÙŠØ²Ø© Ø§Ù„Ù…Ø¯ÙŠØ±: ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø¶Ù…ÙŠÙ†
        function loadAdminData() {
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
            onValue(ref(db, 'sections'), (snapshot) => {
                const list = document.getElementById('editable-sections-list');
                list.innerHTML = "";
                snapshot.forEach(child => {
                    const sec = child.val();
                    list.innerHTML += `<div class="p-3 bg-white border rounded flex justify-between">
                        <span>${sec.title}</span>
                        <span class="text-xs text-gray-400">ID: ${child.key}</span>
                    </div>`;
                });
            });

            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†Ø¶Ù…ÙŠÙ†
            onValue(ref(db, 'joiners'), (snapshot) => {
                const list = document.getElementById('joiners-list');
                list.innerHTML = "";
                if (!snapshot.exists()) { list.innerHTML = "<p class='p-4 text-center'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù†Ø¶Ù…ÙŠÙ† Ø¨Ø¹Ø¯.</p>"; return; }
                
                snapshot.forEach(child => {
                    const user = child.val();
                    list.innerHTML += `
                        <div class="p-4 flex justify-between items-center">
                            <div>
                                <p class="font-bold text-blue-900">${user.name}</p>
                                <p class="text-sm text-gray-500">${user.specialty}</p>
                            </div>
                            <span class="text-xs text-gray-400">${user.date}</span>
                        </div>`;
                });
            });
        }

        function loadHomeData() {
            onValue(ref(db, 'sections'), (snapshot) => {
                const list = document.getElementById('dynamic-sections-list');
                list.innerHTML = "";
                snapshot.forEach(child => {
                    const sec = child.val();
                    list.innerHTML += `<div class="p-4 bg-blue-100 rounded-lg shadow-sm border-r-4 border-blue-700">
                        <h3 class="font-bold text-blue-900">${sec.title}</h3>
                    </div>`;
                });
            });
        }

        // Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„ÙˆØ§Ø¬Ù‡Ø©
        window.showView = (id) => {
            ['registration-view', 'home-view', 'management-view'].forEach(v => document.getElementById(v).classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        };

        window.showAdminTab = (tab) => {
            if(tab === 'sections') {
                document.getElementById('admin-sections-tab').classList.remove('hidden');
                document.getElementById('admin-users-tab').classList.add('hidden');
            } else {
                document.getElementById('admin-sections-tab').classList.add('hidden');
                document.getElementById('admin-users-tab').classList.remove('hidden');
            }
        };
    </script>
</body>
</html>
