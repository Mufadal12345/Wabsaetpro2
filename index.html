<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ù‚Ø³Ø§Ù… â€“ Firebase</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="config.js"></script>

    <style>
        body {
            font-family: Tahoma, Arial;
            background: #0f172a;
            color: #e5e7eb;
            margin: 0;
        }
        header {
            background: #020617;
            padding: 15px;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
        }
        nav {
            display: flex;
            justify-content: center;
            gap: 10px;
            background: #020617;
            padding-bottom: 10px;
        }
        nav button {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            background: #1e293b;
            color: #fff;
            cursor: pointer;
        }
        nav button:hover {
            background: #334155;
        }
        section {
            padding: 20px;
        }
        .hidden {
            display: none;
        }
        .card {
            background: #020617;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }
        input, textarea {
            width: 100%;
            padding: 8px;
            margin-top: 5px;
            border-radius: 5px;
            border: none;
        }
        textarea {
            resize: vertical;
        }
        .btn {
            background: #2563eb;
            color: #fff;
            padding: 8px 14px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 10px;
        }
        .btn.danger {
            background: #dc2626;
        }
        footer {
            text-align: center;
            padding: 10px;
            background: #020617;
            font-size: 12px;
            color: #94a3b8;
        }
    </style>
</head>

<body>

<header>ğŸ“˜ Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ù‚Ø³Ø§Ù… (Realtime Firebase)</header>

<nav>
    <button onclick="showHome()">ğŸ  Ø§Ù„Ø¹Ø±Ø¶</button>
    <button onclick="showAdmin()">âš™ï¸ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</button>
</nav>

<section id="home-view"></section>

<section id="admin-view" class="hidden">
    <div class="card">
        <h3>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¯ÙŠØ±</h3>
        <input id="admin-name" placeholder="Ø§Ù„Ø§Ø³Ù…">
        <input id="admin-specialty" placeholder="Ø§Ù„Ø±Ù…Ø²">
        <button class="btn" onclick="loginAdmin()">Ø¯Ø®ÙˆÙ„</button>
        <p id="login-error" style="color:#f87171"></p>
    </div>

    <div id="admin-panel" class="hidden">
        <div class="card">
            <h3>Ø¥Ø¶Ø§ÙØ© Ù‚Ø³Ù…</h3>
            <input id="new-title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù‚Ø³Ù…">
            <textarea id="new-content" placeholder="Ø§Ù„Ù…Ø­ØªÙˆÙ‰"></textarea>
            <button class="btn" onclick="addSection()">â• Ø¥Ø¶Ø§ÙØ©</button>
        </div>

        <div id="sections-editor"></div>
    </div>
</section>

<footer>Realtime Firebase System</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import { getDatabase, ref, get, set, onValue } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";

/* Firebase Init */
const app = initializeApp(window.FIREBASE_CONFIG);
const db = getDatabase(app);
const sectionsRef = ref(db, "sections");

/* Global State */
let globalSectionsData = [];
let isAdmin = false;

/* Initial Data */
const initialSectionsData = [
    {
        id: "sec-1",
        order: 1,
        title: "Ù…Ø±Ø­Ø¨Ø§ Ø¨Ùƒ",
        content: "Ù‡Ø°Ø§ Ù…Ø«Ø§Ù„ Ù„Ù‚Ø³Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡ Ù…Ù† Firebase"
    }
];

/* Load Data */
async function loadSectionsData() {
    const snap = await get(sectionsRef);
    if (snap.exists()) {
        globalSectionsData = Object.values(snap.val()).sort((a,b)=>a.order-b.order);
    } else {
        globalSectionsData = initialSectionsData;
        saveSectionsData();
    }
    renderHome();
}

/* Save Data */
function saveSectionsData() {
    const obj = {};
    globalSectionsData.forEach(s => obj[s.id] = s);
    set(sectionsRef, obj);
}

/* Realtime Listener */
onValue(sectionsRef, snap => {
    if (snap.exists()) {
        globalSectionsData = Object.values(snap.val()).sort((a,b)=>a.order-b.order);
        renderHome();
        if (isAdmin) renderEditor();
    }
});

/* Render Home */
function renderHome() {
    const home = document.getElementById("home-view");
    home.innerHTML = "";
    globalSectionsData.forEach(sec => {
        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `<h3>${sec.title}</h3><p>${sec.content}</p>`;
        home.appendChild(div);
    });
}

/* Admin */
window.loginAdmin = function() {
    const name = document.getElementById("admin-name").value;
    const spec = document.getElementById("admin-specialty").value;

    if (name === window.ADMIN_CREDENTIALS.name && spec === window.ADMIN_CREDENTIALS.specialty) {
        isAdmin = true;
        document.getElementById("admin-panel").classList.remove("hidden");
        document.getElementById("login-error").textContent = "";
        renderEditor();
    } else {
        document.getElementById("login-error").textContent = "Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø©";
    }
};

window.addSection = function() {
    const title = document.getElementById("new-title").value;
    const content = document.getElementById("new-content").value;
    if (!title || !content) return;

    globalSectionsData.push({
        id: "sec-" + Date.now(),
        order: globalSectionsData.length + 1,
        title,
        content
    });
    saveSectionsData();
};

function renderEditor() {
    const editor = document.getElementById("sections-editor");
    editor.innerHTML = "";
    globalSectionsData.forEach(sec => {
        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `
            <input value="${sec.title}" 
                oninput="updateTitle('${sec.id}', this.value)">
            <textarea oninput="updateContent('${sec.id}', this.value)">${sec.content}</textarea>
            <button class="btn danger" onclick="deleteSection('${sec.id}')">ğŸ—‘ Ø­Ø°Ù</button>
        `;
        editor.appendChild(div);
    });
}

window.updateTitle = function(id, val) {
    const sec = globalSectionsData.find(s=>s.id===id);
    sec.title = val;
    saveSectionsData();
};

window.updateContent = function(id, val) {
    const sec = globalSectionsData.find(s=>s.id===id);
    sec.content = val;
    saveSectionsData();
};

window.deleteSection = function(id) {
    globalSectionsData = globalSectionsData.filter(s=>s.id!==id);
    saveSectionsData();
};

/* Navigation */
window.showHome = function() {
    document.getElementById("home-view").classList.remove("hidden");
    document.getElementById("admin-view").classList.add("hidden");
};

window.showAdmin = function() {
    document.getElementById("home-view").classList.add("hidden");
    document.getElementById("admin-view").classList.remove("hidden");
};

loadSectionsData();
</script>

</body>
</html>
