<!doctype html>
<html lang="ar" dir="rtl" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ØªØ­Ù Ø§Ù„ÙÙƒØ± - Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ Ø§Ù„ÙÙƒØ±ÙŠ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Tajawal', sans-serif;
            direction: rtl;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .gradient-bg {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .glass-nav {
            background: rgba(26, 26, 46, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .card-hover {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .sidebar {
            width: 280px;
            height: 100vh;
            position: fixed;
            right: 0;
            top: 0;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            z-index: 40;
        }

        .sidebar-open {
            transform: translateX(0);
        }

        .sidebar-overlay {
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 30;
            display: none;
        }

        .sidebar-overlay.active {
            display: block;
        }

        .menu-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 50;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        @media (min-width: 769px) {
            .sidebar {
                transform: translateX(0);
                position: relative;
                height: 100%;
            }
            
            .main-content {
                margin-right: 280px;
                width: calc(100% - 280px);
            }
            
            .menu-toggle {
                display: none;
            }
        }

        .sidebar-item {
            padding: 12px 20px;
            margin: 4px 12px;
            border-radius: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .sidebar-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .sidebar-item.active {
            background: rgba(236, 72, 153, 0.2);
            border-right: 4px solid #ec4899;
        }

        .category-tag {
            background: rgba(236, 72, 153, 0.2);
            color: #ec4899;
            font-size: 12px;
        }

        .trending-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255, 87, 34, 0.2);
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 12px;
        }

        .role-badge {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: bold;
        }

        .role-admin {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
        }

        .role-premium {
            background: rgba(156, 39, 176, 0.2);
            color: #9c27b0;
        }

        .level-indicator {
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }

        .level-progress {
            height: 100%;
            background: linear-gradient(90deg, #ec4899, #8b5cf6);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .toast {
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .line-clamp-1 {
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
        }

        .line-clamp-2 {
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .line-clamp-3 {
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 3;
                -webkit-box-orient: vertical;
        }

        .comment-bubble {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
        }

        .comment-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .comment-like-btn {
            background: transparent;
            border: none;
            color: #9ca3af;
            display: flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .comment-like-btn:hover {
            color: #ec4899;
        }

        .comment-like-btn.liked {
            color: #ec4899;
        }

        .input-field {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 12px 16px;
            color: white;
            width: 100%;
            transition: all 0.3s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: #ec4899;
            box-shadow: 0 0 0 3px rgba(236, 72, 153, 0.1);
        }

        .btn-primary {
            background: linear-gradient(135deg, #ec4899, #8b5cf6);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 12px 24px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(236, 72, 153, 0.3);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 12px 24px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #ec4899, #8b5cf6);
        }

        .font-amiri {
            font-family: 'Amiri', serif;
        }

        .page-content {
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal {
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .auth-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
        }

        .auth-tab {
            flex: 1;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: none;
            border-radius: 12px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .auth-tab.active {
            background: linear-gradient(135deg, #ec4899, #8b5cf6);
        }

        .loading-spinner {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .badge-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }
        
        .badge {
            display: flex;
            align-items: center;
            gap: 4px;
            background: rgba(255, 255, 255, 0.1);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
        }
        
        .achievement-modal {
            max-width: 500px;
        }
    </style>
    <style>@view-transition { navigation: auto; }</style>
</head>
<body class="h-full w-full gradient-bg text-white overflow-hidden">
    <!-- Menu Toggle Button (Mobile) -->
    <button id="menuToggle" onclick="toggleSidebar()" class="menu-toggle w-14 h-14 rounded-full flex items-center justify-center text-2xl hidden">ğŸ›ï¸</button>
    
    <!-- Sidebar Overlay (Mobile) -->
    <div id="sidebarOverlay" class="sidebar-overlay" onclick="toggleSidebar()"></div>
    
    <!-- Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª -->
    <div id="modalsContainer">
        <!-- Add Idea Modal -->
        <div id="addIdeaModal" class="modal hidden">
            <div class="modal-content p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold">ğŸ’¡ Ø¥Ø¶Ø§ÙØ© ÙÙƒØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
                    <button class="text-gray-400 hover:text-white" onclick="closeModal('addIdeaModal')">
                        âœ•
                    </button>
                </div>
                <div class="space-y-4">
                    <div>
                        <label class="block text-gray-400 mb-2">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙÙƒØ±Ø©</label>
                        <input type="text" id="newIdeaTitle" class="input-field" placeholder="Ø§ÙƒØªØ¨ Ø¹Ù†ÙˆØ§Ù†Ø§Ù‹ Ø¬Ø°Ø§Ø¨Ø§Ù‹ Ù„ÙÙƒØ±ØªÙƒ">
                    </div>
                    <div>
                        <label class="block text-gray-400 mb-2">Ø§Ù„ØªØµÙ†ÙŠÙ</label>
                        <select id="newIdeaCategory" class="input-field">
                            <option value="ÙÙ„Ø³ÙØ©">ğŸ§  ÙÙ„Ø³ÙØ©</option>
                            <option value="ØªÙ‚Ù†ÙŠØ©">ğŸ’» ØªÙ‚Ù†ÙŠØ©</option>
                            <option value="Ø£Ø¯Ø¨">ğŸ“– Ø£Ø¯Ø¨</option>
                            <option value="Ø¹Ù„ÙˆÙ…">ğŸ”¬ Ø¹Ù„ÙˆÙ…</option>
                            <option value="ÙÙ†">ğŸ¨ ÙÙ†</option>
                            <option value="Ø§Ø¬ØªÙ…Ø§Ø¹">ğŸ‘¥ Ø§Ø¬ØªÙ…Ø§Ø¹</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-400 mb-2">Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙÙƒØ±Ø©</label>
                        <textarea id="newIdeaContent" class="input-field h-32" placeholder="Ø§Ø´Ø±Ø­ ÙÙƒØ±ØªÙƒ Ø¨Ø§Ù„ØªÙØµÙŠÙ„..."></textarea>
                    </div>
                    <div class="flex gap-3 pt-4">
                        <button class="btn-primary flex-1" onclick="submitNewIdea()">Ù†Ø´Ø± Ø§Ù„ÙÙƒØ±Ø©</button>
                        <button class="btn-secondary" onclick="closeModal('addIdeaModal')">Ø¥Ù„ØºØ§Ø¡</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Quote Modal -->
        <div id="addQuoteModal" class="modal hidden">
            <div class="modal-content p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold">âœ¨ Ø¥Ø¶Ø§ÙØ© Ø¹Ø¨Ø§Ø±Ø© Ù…Ù„Ù‡Ù…Ø©</h3>
                    <button class="text-gray-400 hover:text-white" onclick="closeModal('addQuoteModal')">
                        âœ•
                    </button>
                </div>
                <div class="space-y-4">
                    <div>
                        <label class="block text-gray-400 mb-2">Ù†Øµ Ø§Ù„Ø¹Ø¨Ø§Ø±Ø©</label>
                        <textarea id="newQuoteText" class="input-field h-24" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø¹Ø¨Ø§Ø±Ø© Ø§Ù„Ù…Ù„Ù‡Ù…Ø©..."></textarea>
                    </div>
                    <div>
                        <label class="block text-gray-400 mb-2">Ø§Ù„Ù…Ø¤Ù„Ù (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                        <input type="text" id="newQuoteAuthor" class="input-field" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¤Ù„Ù Ø£Ùˆ 'Ù…Ø¬Ù‡ÙˆÙ„'">
                    </div>
                    <div class="flex gap-3 pt-4">
                        <button class="btn-primary flex-1" onclick="submitNewQuote()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø¨Ø§Ø±Ø©</button>
                        <button class="btn-secondary" onclick="closeModal('addQuoteModal')">Ø¥Ù„ØºØ§Ø¡</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Course Modal -->
        <div id="addCourseModal" class="modal hidden">
            <div class="modal-content p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold">ğŸš€ Ø¥Ø¶Ø§ÙØ© Ù…ØµØ¯Ø± ØªØ¹Ù„ÙŠÙ…ÙŠ</h3>
                    <button class="text-gray-400 hover:text-white" onclick="closeModal('addCourseModal')">
                        âœ•
                    </button>
                </div>
                <div class="space-y-4">
                    <div>
                        <label class="block text-gray-400 mb-2">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…ØµØ¯Ø±</label>
                        <input type="text" id="newCourseTitle" class="input-field" placeholder="Ù…Ø«Ø§Ù„: Ø¯ÙˆØ±Ø© ØªØ¹Ù„Ù… Ø§Ù„Ø¨Ø±Ù…Ø¬Ø©">
                    </div>
                    <div>
                        <label class="block text-gray-400 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ù…ØµØ¯Ø±</label>
                        <select id="newCourseType" class="input-field">
                            <option value="Ù‚Ù†Ø§Ø© ÙŠÙˆØªÙŠÙˆØ¨">ğŸ“º Ù‚Ù†Ø§Ø© ÙŠÙˆØªÙŠÙˆØ¨</option>
                            <option value="ÙƒÙˆØ±Ø³ Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†">ğŸ“ ÙƒÙˆØ±Ø³ Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†</option>
                            <option value="Ù…Ù†ØµØ© ØªØ¹Ù„ÙŠÙ…ÙŠØ©">ğŸ’» Ù…Ù†ØµØ© ØªØ¹Ù„ÙŠÙ…ÙŠØ©</option>
                            <option value="Ù…Ù‚Ø§Ù„Ø§Øª">ğŸ“ Ù…Ù‚Ø§Ù„Ø§Øª</option>
                            <option value="ÙƒØªØ¨">ğŸ“š ÙƒØªØ¨</option>
                            <option value="Ø¨ÙˆØ¯ÙƒØ§Ø³Øª">ğŸ™ï¸ Ø¨ÙˆØ¯ÙƒØ§Ø³Øª</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-400 mb-2">ÙˆØµÙ Ø§Ù„Ù…ØµØ¯Ø±</label>
                        <textarea id="newCourseDescription" class="input-field h-24" placeholder="ÙˆØµÙ Ù…Ø®ØªØµØ± Ù„Ù„Ù…ØµØ¯Ø±..."></textarea>
                    </div>
                    <div>
                        <label class="block text-gray-400 mb-2">Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ØµØ¯Ø± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                        <input type="url" id="newCourseLink" class="input-field" placeholder="https://example.com">
                    </div>
                    <div class="flex gap-3 pt-4">
                        <button class="btn-primary flex-1" onclick="submitNewCourse()">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ØµØ¯Ø±</button>
                        <button class="btn-secondary" onclick="closeModal('addCourseModal')">Ø¥Ù„ØºØ§Ø¡</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Message Admin Modal -->
        <div id="messageAdminModal" class="modal hidden">
            <div class="modal-content p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold">ğŸ“© Ù…Ø±Ø§Ø³Ù„Ø© Ø§Ù„Ù…Ø¯ÙŠØ±</h3>
                    <button class="text-gray-400 hover:text-white" onclick="closeModal('messageAdminModal')">
                        âœ•
                    </button>
                </div>
                <div class="space-y-4">
                    <div>
                        <label class="block text-gray-400 mb-2">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø±Ø³Ø§Ù„Ø©</label>
                        <input type="text" id="messageTitle" class="input-field" placeholder="Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ø±Ø³Ø§Ù„Ø©">
                    </div>
                    <div>
                        <label class="block text-gray-400 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ø±Ø³Ø§Ù„Ø©</label>
                        <select id="messageType" class="input-field">
                            <option value="Ø§Ù‚ØªØ±Ø§Ø­">Ø§Ù‚ØªØ±Ø§Ø­</option>
                            <option value="Ù…Ø´ÙƒÙ„Ø©">Ù…Ø´ÙƒÙ„Ø© ØªÙ‚Ù†ÙŠØ©</option>
                            <option value="Ø§Ø³ØªÙØ³Ø§Ø±">Ø§Ø³ØªÙØ³Ø§Ø±</option>
                            <option value="Ø·Ù„Ø¨ Ø±Ù…Ø² ØªØ±Ù‚ÙŠØ©">Ø·Ù„Ø¨ Ø±Ù…Ø² ØªØ±Ù‚ÙŠØ©</option>
                            <option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-400 mb-2">Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø³Ø§Ù„Ø©</label>
                        <textarea id="messageContent" class="input-field h-32" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..."></textarea>
                    </div>
                    <div class="flex gap-3 pt-4">
                        <button class="btn-primary flex-1" onclick="sendMessageToAdmin()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©</button>
                        <button class="btn-secondary" onclick="closeModal('messageAdminModal')">Ø¥Ù„ØºØ§Ø¡</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Idea Details Modal -->
        <div id="ideaDetailsModal" class="modal hidden">
            <div class="modal-content p-6 max-w-4xl">
                <div class="flex justify-between items-center mb-6">
                    <h3 id="ideaDetailsTitle" class="text-xl font-bold">ğŸ’¡ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙÙƒØ±Ø©</h3>
                    <button class="text-gray-400 hover:text-white" onclick="closeModal('ideaDetailsModal')">
                        âœ•
                    </button>
                </div>
                <div class="space-y-6">
                    <!-- Idea Content -->
                    <div id="ideaDetailsContent">
                        <!-- Idea details will be injected here -->
                    </div>

                    <!-- Comments Section -->
                    <div class="glass-card rounded-xl p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h4 class="font-bold">ğŸ’¬ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª (<span id="commentsCount">0</span>)</h4>
                        </div>
                        
                        <!-- Comments List -->
                        <div id="commentsList" class="mb-6 max-h-96 overflow-y-auto pr-2">
                            <!-- Comments will be injected here -->
                        </div>

                        <!-- Add Comment -->
                        <div class="pt-4 border-t border-white/10">
                            <textarea id="newCommentText" class="input-field h-24 mb-3" placeholder="Ø§ÙƒØªØ¨ ØªØ¹Ù„ÙŠÙ‚Ùƒ Ù‡Ù†Ø§..."></textarea>
                            <div class="flex justify-between items-center">
                                <div class="flex gap-2">
                                    <button class="btn-primary" onclick="submitComment()">
                                        Ø¥Ø¶Ø§ÙØ© ØªØ¹Ù„ÙŠÙ‚
                                    </button>
                                    <button class="btn-secondary" onclick="document.getElementById('newCommentText').value = ''">
                                        Ø¥Ù„ØºØ§Ø¡
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Achievements Modal -->
        <div id="achievementsModal" class="modal hidden">
            <div class="modal-content p-6 achievement-modal">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold">ğŸ† Ø¥Ù†Ø¬Ø§Ø²Ø§ØªÙŠ</h3>
                    <button class="text-gray-400 hover:text-white" onclick="closeModal('achievementsModal')">
                        âœ•
                    </button>
                </div>
                <div id="achievementsContent" class="space-y-4">
                    <!-- Achievements will be injected here -->
                </div>
            </div>
        </div>
    </div>
    
    <div id="app" class="h-full w-full">
        <!-- Login Screen -->
        <div id="loginScreen" class="h-full w-full flex items-center justify-center p-4 overflow-auto">
            <div class="max-w-md w-full">
                <!-- Museum Logo/Title -->
                <div class="text-center mb-8">
                    <h1 class="text-4xl font-bold mb-2">ğŸ›ï¸ Ù…ØªØ­Ù Ø§Ù„ÙÙƒØ±</h1>
                    <p class="text-gray-400">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ Ø§Ù„ÙÙƒØ±ÙŠ ÙˆØªØ¨Ø§Ø¯Ù„ Ø§Ù„Ø£ÙÙƒØ§Ø±</p>
                </div>

                <!-- Auth Tabs -->
                <div class="auth-tabs mb-6">
                    <button id="tabTraditional" class="auth-tab active" onclick="switchAuthTab('traditional')">
                        Ù…Ø¯ÙŠØ±
                    </button>
                    <button id="tabEmail" class="auth-tab" onclick="switchAuthTab('email')">
                        Ø£Ø¹Ø¶Ø§Ø¡
                    </button>
                </div>

                <!-- Traditional Login (Admin) -->
                <div id="traditionalLogin" class="space-y-4">
                    <div>
                        <label class="block text-gray-400 mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠØ±</label>
                        <input type="text" id="loginName" class="input-field" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠØ±">
                    </div>
                    <div>
                        <label class="block text-gray-400 mb-2">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                        <input type="password" id="loginSpecialty" class="input-field" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                    </div>
                    <button class="btn-primary w-full" onclick="handleTraditionalLogin()">
                        <span id="traditionalLoginBtnText">Ø¯Ø®ÙˆÙ„ ÙƒÙ…Ø¯ÙŠØ±</span>
                        <span id="traditionalLoginSpinner" class="hidden loading-spinner">âŸ³</span>
                    </button>
                </div>

                <!-- Email Login/Register -->
                <div id="emailLogin" class="space-y-4 hidden">
                    <!-- Login Fields -->
                    <div id="emailLoginFields">
                        <div>
                            <label class="block text-gray-400 mb-2">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                            <input type="email" id="loginEmail" class="input-field" placeholder="example@email.com">
                        </div>
                        <div>
                            <label class="block text-gray-400 mb-2">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                            <input type="password" id="loginPassword" class="input-field" placeholder="********">
                        </div>
                    </div>

                    <!-- Register Fields -->
                    <div id="registerFields" class="hidden space-y-4">
                        <div>
                            <label class="block text-gray-400 mb-2">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                            <input type="text" id="registerName" class="input-field" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ" required>
                        </div>
                        <div>
                            <label class="block text-gray-400 mb-2">Ø§Ù„ØªØ®ØµØµ</label>
                            <input type="text" id="registerSpecialty" class="input-field" placeholder="Ù…Ø«Ø§Ù„: Ø¹Ù„ÙˆÙ… Ø§Ù„Ø­Ø§Ø³Ø¨ØŒ Ù‡Ù†Ø¯Ø³Ø©..." required>
                        </div>
                        <div>
                            <label class="block text-gray-400 mb-2">Ø±Ù…Ø² Ø§Ù„ØªØ±Ù‚ÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                            <input type="text" id="registerCode" class="input-field" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ±Ù‚ÙŠØ© Ø¥Ø°Ø§ Ù„Ø¯ÙŠÙƒ">
                        </div>
                    </div>

                    <button class="btn-primary w-full" onclick="handleEmailAuth()">
                        <span id="emailAuthBtnText">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</span>
                        <span id="emailAuthSpinner" class="hidden loading-spinner">âŸ³</span>
                    </button>

                    <div class="text-center">
                        <button onclick="toggleEmailMode()" class="text-pink-400 hover:text-pink-300 text-sm">
                            <span id="emailToggleText">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</span>
                        </button>
                    </div>

                    <!-- Google Login -->
                    <div class="pt-4 border-t border-white/10">
                        <button class="btn-secondary w-full flex items-center justify-center gap-3" onclick="handleGoogleLogin()">
                            <span>ğŸ“§</span>
                            <span>Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ù…Ø¹ Ø¬ÙˆØ¬Ù„</span>
                        </button>
                    </div>
                </div>

                <!-- Info Box -->
                <div class="glass-card rounded-xl p-4 mt-6">
                    <p class="text-sm text-gray-300">
                        <span class="text-pink-400">ğŸ’¡ Ù…Ø¹Ù„ÙˆÙ…Ø©:</span> Ø§Ù„Ù…Ø¯ÙŠØ±ÙˆÙ† ÙŠØ¯Ø®Ù„ÙˆÙ† Ø¨Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙÙ‚Ø·. Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ø¬Ø¯Ø¯ ÙŠØ¬Ø¨ Ø¹Ù„ÙŠÙ‡Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£Ùˆ Ø­Ø³Ø§Ø¨ Ø¬ÙˆØ¬Ù„.
                    </p>
                </div>
            </div>
        </div>
        
        <!-- Main App -->
        <div id="mainApp" class="h-full w-full hidden">
            <!-- Sidebar -->
            <div id="sidebar" class="sidebar glass-nav p-6 overflow-y-auto">
                <div class="flex flex-col h-full">
                    <!-- User Profile -->
                    <div class="glass-card rounded-2xl p-4 mb-6">
                        <div class="flex items-center gap-3 mb-4">
                            <div class="w-12 h-12 rounded-full bg-gradient-to-br from-pink-500 to-purple-600 flex items-center justify-center text-white text-xl">
                                <span id="userAvatar">ğŸ‘¤</span>
                            </div>
                            <div>
                                <h3 id="currentUserName" class="font-bold">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h3>
                                <p id="currentUserSpecialty" class="text-sm text-gray-400">Ø§Ù„ØªØ®ØµØµ</p>
                                <div class="flex items-center gap-2 mt-1">
                                    <span id="userRoleDisplay" class="text-xs bg-pink-500/20 text-pink-400 px-2 py-1 rounded-full">Ø¹Ø¶Ùˆ</span>
                                    <button onclick="openAchievementsModal()" class="relative">
                                        <span class="text-xs bg-purple-500/20 text-purple-400 px-2 py-1 rounded-full">Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª</span>
                                        <span id="achievementsBadge" class="absolute -top-2 -left-2 bg-red-500 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center hidden">0</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div id="userLevel" class="mt-3">
                            <!-- Level indicator will be injected here -->
                        </div>
                    </div>

                    <!-- Navigation Menu -->
                    <div class="flex-1">
                        <div class="sidebar-item active" data-page="home" onclick="navigateTo('home')">
                            <span class="text-xl">ğŸ </span>
                            <span>Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
                        </div>
                        <div class="sidebar-item" data-page="ideas" onclick="navigateTo('ideas')">
                            <span class="text-xl">ğŸ’¡</span>
                            <span>Ø§Ù„Ø£ÙÙƒØ§Ø±</span>
                        </div>
                        <div class="sidebar-item" data-page="comments" onclick="navigateTo('comments')">
                            <span class="text-xl">ğŸ’¬</span>
                            <span>Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª</span>
                        </div>
                        <div class="sidebar-item" data-page="leaderboard" onclick="navigateTo('leaderboard')">
                            <span class="text-xl">ğŸ†</span>
                            <span>Ù„ÙˆØ­Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ†</span>
                        </div>
                        <div class="sidebar-item" data-page="content" onclick="navigateTo('content')">
                            <span class="text-xl">ğŸ“š</span>
                            <span>Ø§Ù„Ù…Ø­ØªÙˆÙ‰</span>
                        </div>
                        <div class="sidebar-item" data-page="philosophy" onclick="navigateTo('philosophy')">
                            <span class="text-xl">ğŸ§ </span>
                            <span>ÙÙ„Ø³ÙØ© Ø§Ù„Ù…ØªØ­Ù</span>
                        </div>
                        <div class="sidebar-item" data-page="quotes" onclick="navigateTo('quotes')">
                            <span class="text-xl">âœ¨</span>
                            <span>Ø¹Ø¨Ø§Ø±Ø§Øª Ù…Ù„Ù‡Ù…Ø©</span>
                        </div>
                        <div class="sidebar-item" data-page="skills" onclick="navigateTo('skills')">
                            <span class="text-xl">ğŸš€</span>
                            <span>ØªØ·ÙˆÙŠØ± Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª</span>
                        </div>
                        <div class="sidebar-item" data-page="suggestions" onclick="navigateTo('suggestions')">
                            <span class="text-xl">ğŸ“</span>
                            <span>Ù…Ù‚ØªØ±Ø­Ø§Øª</span>
                        </div>
                        <div class="sidebar-item" data-page="members" onclick="navigateTo('members')">
                            <span class="text-xl">ğŸ‘¥</span>
                            <span>Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</span>
                        </div>
                        
                        <!-- Admin Menu Items -->
                        <div id="adminMenuItems" class="hidden">
                            <div class="sidebar-item" data-page="messages" onclick="navigateTo('messages')">
                                <span class="text-xl">ğŸ“¨</span>
                                <span>Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</span>
                            </div>
                            <div class="sidebar-item" data-page="codes" onclick="navigateTo('codes')">
                                <span class="text-xl">ğŸ”‘</span>
                                <span>Ø±Ù…ÙˆØ² Ø§Ù„ØªØ±Ù‚ÙŠØ©</span>
                            </div>
                        </div>
                        
                        <!-- User Message Button -->
                        <div id="userMessageButton" class="mt-4">
                            <div class="sidebar-item" onclick="openMessageAdminModal()">
                                <span class="text-xl">ğŸ“©</span>
                                <span>Ù…Ø±Ø§Ø³Ù„Ø© Ø§Ù„Ù…Ø¯ÙŠØ±</span>
                            </div>
                            <div class="sidebar-item" onclick="openRequestCodeModal()">
                                <span class="text-xl">ğŸ”‘</span>
                                <span>Ø·Ù„Ø¨ ØªØ±Ù‚ÙŠØ©</span>
                            </div>
                        </div>
                    </div>

                    <!-- Bottom Section -->
                    <div class="pt-4 border-t border-white/10">
                        <div class="sidebar-item" data-page="settings" onclick="navigateTo('settings')">
                            <span class="text-xl">âš™ï¸</span>
                            <span>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
                        </div>
                        <div class="sidebar-item mt-2" onclick="handleLogout()">
                            <span class="text-xl">ğŸšª</span>
                            <span>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="main-content flex-1 h-full overflow-y-auto">
                <!-- Navigation Bar -->
                <nav class="glass-nav p-4">
                    <div class="flex justify-between items-center">
                        <div class="flex items-center gap-4">
                            <h1 class="text-2xl font-bold" id="pageTitle">Ù…ØªØ­Ù Ø§Ù„ÙÙƒØ±</h1>
                            <div class="hidden md:flex items-center gap-2 text-sm">
                                <span id="welcomeName" class="text-pink-400">Ù…Ø±Ø­Ø¨Ø§Ù‹</span>
                                <span>ÙÙŠ Ø¨ÙˆØ§Ø¨ØªÙƒ Ù„Ù„Ø¥Ø¨Ø¯Ø§Ø¹ Ø§Ù„ÙÙƒØ±ÙŠ</span>
                            </div>
                        </div>
                        <div class="flex items-center gap-4">
                            <button id="addIdeaBtn" class="btn-primary hidden" onclick="openAddIdeaModal()">
                                <span>+ ÙÙƒØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©</span>
                            </button>
                            <div class="relative">
                                <span class="text-sm bg-pink-500/20 text-pink-400 px-3 py-1 rounded-full">
                                    <span id="userPointsDisplay">0</span> Ù†Ù‚Ø·Ø©
                                </span>
                            </div>
                        </div>
                    </div>
                </nav>

                <!-- Pages Content -->
                <div class="p-4 md:p-6">
                    <!-- Home Page -->
                    <div id="homePage" class="page-content">
                        <!-- Hero Section -->
                        <div class="glass-card rounded-2xl p-6 md:p-8 mb-6">
                            <div class="flex flex-col md:flex-row items-center justify-between gap-6">
                                <div class="flex-1">
                                    <h2 class="text-2xl md:text-3xl font-bold mb-4">
                                        Ù…Ø±Ø­Ø¨Ø§Ù‹ <span id="welcomeNameLarge" class="text-pink-400">Ø±Ø§Ø´Ø§</span> ÙÙŠ Ù…ØªØ­Ù Ø§Ù„ÙÙƒØ± ğŸ›ï¸
                                    </h2>
                                    <p class="text-gray-300 mb-6">
                                        Ù…Ù†ØµØ© Ù„Ù„Ø¥Ø¨Ø¯Ø§Ø¹ Ø§Ù„ÙÙƒØ±ÙŠ ÙˆØªØ¨Ø§Ø¯Ù„ Ø§Ù„Ø£ÙÙƒØ§Ø± Ø§Ù„Ù…Ø¨ØªÙƒØ±Ø©. Ø´Ø§Ø±Ùƒ Ø£ÙÙƒØ§Ø±ÙƒØŒ Ù†Ø§Ù‚Ø´ØŒ ÙˆØªØ¹Ù„Ù… Ù…Ø¹ Ù…Ø¬ØªÙ…Ø¹ Ù…Ù† Ø§Ù„Ù…ÙÙƒØ±ÙŠÙ† Ø§Ù„Ù…Ø¨Ø¯Ø¹ÙŠÙ†.
                                    </p>
                                    <div class="flex flex-wrap gap-3">
                                        <button class="btn-primary" onclick="navigateTo('ideas')">
                                            Ø§Ø³ØªÙƒØ´Ù Ø§Ù„Ø£ÙÙƒØ§Ø± ğŸ’¡
                                        </button>
                                        <button class="btn-secondary" onclick="navigateTo('skills')">
                                            Ø·ÙˆØ± Ù…Ù‡Ø§Ø±Ø§ØªÙƒ ğŸš€
                                        </button>
                                    </div>
                                </div>
                                <div class="text-6xl md:text-8xl">
                                    ğŸ§ 
                                </div>
                            </div>
                        </div>

                        <!-- Stats Section -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                            <div class="stat-card">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <p class="text-gray-400 text-sm">Ø£ÙÙƒØ§Ø±Ùƒ</p>
                                        <h3 id="userIdeasCount" class="text-2xl font-bold mt-2">0</h3>
                                    </div>
                                    <span class="text-2xl">ğŸ’¡</span>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <p class="text-gray-400 text-sm">ØªØ¹Ù„ÙŠÙ‚Ø§ØªÙƒ</p>
                                        <h3 id="userCommentsCount" class="text-2xl font-bold mt-2">0</h3>
                                    </div>
                                    <span class="text-2xl">ğŸ’¬</span>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <p class="text-gray-400 text-sm">Ù†Ù‚Ø§Ø·Ùƒ</p>
                                        <h3 id="userPoints" class="text-2xl font-bold mt-2">0</h3>
                                    </div>
                                    <span class="text-2xl">â­</span>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <p class="text-gray-400 text-sm">Ù…Ø³ØªÙˆØ§Ùƒ</p>
                                        <h3 id="userLevelDisplay" class="text-2xl font-bold mt-2">Ù…Ø¨ØªØ¯Ø¦</h3>
                                    </div>
                                    <span class="text-2xl">ğŸ“ˆ</span>
                                </div>
                            </div>
                        </div>

                        <!-- Admin Stats (for admin only) - Hidden for regular users -->
                        <div id="adminStats" class="hidden mb-8">
                            <h3 class="text-xl font-bold mb-4">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                <div class="stat-card">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <p class="text-gray-400 text-sm">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ÙÙƒØ§Ø±</p>
                                            <h3 id="totalIdeas" class="text-2xl font-bold mt-2">0</h3>
                                        </div>
                                        <span class="text-2xl">ğŸ’­</span>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <p class="text-gray-400 text-sm">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª</p>
                                            <h3 id="totalViews" class="text-2xl font-bold mt-2">0</h3>
                                        </div>
                                        <span class="text-2xl">ğŸ‘ï¸</span>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <p class="text-gray-400 text-sm">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</p>
                                            <h3 id="totalMembers" class="text-2xl font-bold mt-2">0</h3>
                                        </div>
                                        <span class="text-2xl">ğŸ‘¥</span>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <p class="text-gray-400 text-sm">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙØ§Ø¹Ù„Ø§Øª</p>
                                            <h3 id="totalInteractions" class="text-2xl font-bold mt-2">0</h3>
                                        </div>
                                        <span class="text-2xl">ğŸ”¥</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Quote of the Day -->
                        <div class="glass-card rounded-2xl p-6 mb-8">
                            <div class="flex items-center gap-3 mb-4">
                                <span class="text-2xl">âœ¨</span>
                                <h3 class="text-xl font-bold">Ø¹Ø¨Ø§Ø±Ø© Ø§Ù„ÙŠÙˆÙ…</h3>
                            </div>
                            <div class="text-center py-4">
                                <p id="quoteOfDay" class="text-lg md:text-xl font-amiri mb-2">"Ø§Ù„Ø¹Ù‚Ù„ ÙƒØ§Ù„Ù…Ø¸Ù„Ø©ØŒ Ù„Ø§ ÙŠØ¹Ù…Ù„ Ø¥Ù„Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙØªÙˆØ­Ø§Ù‹"</p>
                                <p id="quoteAuthor" class="text-gray-400">- Ø­ÙƒÙ…Ø© Ø´Ø¹Ø¨ÙŠØ©</p>
                            </div>
                        </div>

                        <!-- Popular Content -->
                        <div class="mb-8">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-xl font-bold">ğŸ”¥ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø´Ø§Ø¦Ø¹</h3>
                                <button class="text-pink-400 hover:text-pink-300 text-sm" onclick="navigateTo('ideas')">
                                    Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„ â†’
                                </button>
                            </div>
                            <div id="popularContentGrid" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <!-- Popular content will be injected here -->
                            </div>
                        </div>

                        <!-- Latest Ideas -->
                        <div>
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-xl font-bold">ğŸ’¡ Ø£Ø­Ø¯Ø« Ø§Ù„Ø£ÙÙƒØ§Ø±</h3>
                                <button class="text-pink-400 hover:text-pink-300 text-sm" onclick="navigateTo('ideas')">
                                    Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„ â†’
                                </button>
                            </div>
                            <div id="latestIdeasGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                <!-- Latest ideas will be injected here -->
                            </div>
                        </div>
                    </div>

                    <!-- Ideas Page -->
                    <div id="ideasPage" class="page-content hidden">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">ğŸ’¡ Ø§Ù„Ø£ÙÙƒØ§Ø±</h2>
                            <button id="addIdeaBtn2" class="btn-primary hidden" onclick="openAddIdeaModal()">
                                <span>+ ÙÙƒØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©</span>
                            </button>
                        </div>

                        <!-- Filter Buttons -->
                        <div class="flex flex-wrap gap-2 mb-6">
                            <button class="filter-btn active px-4 py-2 rounded-full bg-pink-500/20 text-pink-400" data-filter="all" onclick="filterIdeas('all')">
                                Ø§Ù„ÙƒÙ„
                            </button>
                            <button class="filter-btn px-4 py-2 rounded-full bg-blue-500/20 text-blue-400" data-filter="ÙÙ„Ø³ÙØ©" onclick="filterIdeas('ÙÙ„Ø³ÙØ©')">
                                ğŸ§  ÙÙ„Ø³ÙØ©
                            </button>
                            <button class="filter-btn px-4 py-2 rounded-full bg-green-500/20 text-green-400" data-filter="ØªÙ‚Ù†ÙŠØ©" onclick="filterIdeas('ØªÙ‚Ù†ÙŠØ©')">
                                ğŸ’» ØªÙ‚Ù†ÙŠØ©
                            </button>
                            <button class="filter-btn px-4 py-2 rounded-full bg-yellow-500/20 text-yellow-400" data-filter="Ø£Ø¯Ø¨" onclick="filterIdeas('Ø£Ø¯Ø¨')">
                                ğŸ“– Ø£Ø¯Ø¨
                            </button>
                            <button class="filter-btn px-4 py-2 rounded-full bg-purple-500/20 text-purple-400" data-filter="Ø¹Ù„ÙˆÙ…" onclick="filterIdeas('Ø¹Ù„ÙˆÙ…')">
                                ğŸ”¬ Ø¹Ù„ÙˆÙ…
                            </button>
                            <button class="filter-btn px-4 py-2 rounded-full bg-red-500/20 text-red-400" data-filter="ÙÙ†" onclick="filterIdeas('ÙÙ†')">
                                ğŸ¨ ÙÙ†
                            </button>
                        </div>

                        <!-- Ideas Grid -->
                        <div id="ideasGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <!-- Ideas will be injected here -->
                        </div>
                    </div>

                    <!-- Comments Page -->
                    <div id="commentsPage" class="page-content hidden">
                        <h2 class="text-2xl font-bold mb-6">ğŸ’¬ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª</h2>
                        <div id="commentsPageContent">
                            <!-- Comments will be injected here -->
                        </div>
                    </div>

                    <!-- Leaderboard Page -->
                    <div id="leaderboardPage" class="page-content hidden">
                        <h2 class="text-2xl font-bold mb-6">ğŸ† Ù„ÙˆØ­Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ†</h2>
                        <div id="leaderboardContent">
                            <!-- Leaderboard will be injected here -->
                        </div>
                    </div>

                    <!-- Content Page -->
                    <div id="contentPage" class="page-content hidden">
                        <h2 class="text-2xl font-bold mb-6">ğŸ“š Ø§Ù„Ù…Ø­ØªÙˆÙ‰</h2>
                        <div id="contentPageContent">
                            <p>ØµÙØ­Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ</p>
                        </div>
                    </div>

                    <!-- Philosophy Page -->
                    <div id="philosophyPage" class="page-content hidden">
                        <div class="glass-card rounded-2xl p-6">
                            <h2 class="text-2xl font-bold mb-6">ğŸ§  ÙÙ„Ø³ÙØ© Ù…ØªØ­Ù Ø§Ù„ÙÙƒØ±</h2>
                            <div class="space-y-6">
                                <div>
                                    <h3 class="text-xl font-bold mb-3 text-pink-400">Ø±Ø¤ÙŠØªÙ†Ø§</h3>
                                    <p class="text-gray-300 leading-relaxed">
                                        Ù†Ø¤Ù…Ù† Ø£Ù† ÙƒÙ„ Ø¹Ù‚Ù„ ÙŠØ­ÙˆÙŠ ÙƒÙ†ÙˆØ²Ø§Ù‹ Ù…Ù† Ø§Ù„Ø£ÙÙƒØ§Ø± ØªÙ†ØªØ¸Ø± Ø§Ù„Ø§ÙƒØªØ´Ø§Ù. Ù…ØªØ­Ù Ø§Ù„ÙÙƒØ± Ù‡Ùˆ Ù…Ù†ØµØ© ØªÙ‡Ø¯Ù Ø¥Ù„Ù‰ Ø¬Ù…Ø¹ Ù‡Ø°Ù‡ Ø§Ù„ÙƒÙ†ÙˆØ² Ø§Ù„ÙÙƒØ±ÙŠØ© ÙˆÙˆØ¶Ø¹Ù‡Ø§ ÙÙŠ Ù…ØªÙ†Ø§ÙˆÙ„ ÙƒÙ„ Ø¨Ø§Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø¹Ø±ÙØ© ÙˆØ§Ù„Ø¥Ù„Ù‡Ø§Ù….
                                    </p>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold mb-3 text-pink-400">Ø±Ø³Ø§Ù„ØªÙ†Ø§</h3>
                                    <p class="text-gray-300 leading-relaxed">
                                        Ø®Ù„Ù‚ Ù…Ø¬ØªÙ…Ø¹ ÙÙƒØ±ÙŠ ØªÙØ§Ø¹Ù„ÙŠ Ø­ÙŠØ« ÙŠÙ…ÙƒÙ† Ù„Ù„Ø£ÙÙƒØ§Ø± Ø£Ù† ØªØªÙ†ÙØ³ØŒ ØªØªØ·ÙˆØ±ØŒ ÙˆØªÙ„Ù‡Ù… Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†. Ù†Ø­Ù† Ù‡Ù†Ø§ Ù„Ù†Ø¯Ø¹Ù… Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªÙÙƒÙŠØ± Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ÙŠ ÙˆØ§Ù„Ù†Ù‚Ø¯ Ø§Ù„Ø¨Ù†Ø§Ø¡.
                                    </p>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold mb-3 text-pink-400">Ù‚ÙŠÙ…Ù†Ø§</h3>
                                    <ul class="list-disc list-inside space-y-2 text-gray-300">
                                        <li>Ø§Ù„Ø§Ø­ØªØ±Ø§Ù… Ø§Ù„Ù…ØªØ¨Ø§Ø¯Ù„ ÙˆØ§Ù„Ø­ÙˆØ§Ø± Ø§Ù„Ø¨Ù†Ø§Ø¡</li>
                                        <li>Ø§Ù„ØªÙ†ÙˆØ¹ Ø§Ù„ÙÙƒØ±ÙŠ ÙˆØ§Ù„Ø§Ù†ÙØªØ§Ø­ Ø¹Ù„Ù‰ Ø§Ù„Ø¢Ø±Ø§Ø¡ Ø§Ù„Ù…Ø®ØªÙ„ÙØ©</li>
                                        <li>Ø§Ù„Ø¬ÙˆØ¯Ø© ÙˆØ§Ù„Ø¹Ù…Ù‚ ÙÙŠ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù‚Ø¯Ù…</li>
                                        <li>Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ù…Ø³ØªÙ…Ø± ÙˆØ§Ù„ØªØ·ÙˆØ± Ø§Ù„Ø°Ø§ØªÙŠ</li>
                                        <li>Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ ÙˆØ§Ù„Ø§Ø¨ØªÙƒØ§Ø± ÙÙŠ Ø·Ø±Ø­ Ø§Ù„Ø£ÙÙƒØ§Ø±</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quotes Page -->
                    <div id="quotesPage" class="page-content hidden">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">âœ¨ Ø¹Ø¨Ø§Ø±Ø§Øª Ù…Ù„Ù‡Ù…Ø©</h2>
                            <button class="btn-primary" onclick="openAddQuoteModal()">
                                <span>+ Ø¥Ø¶Ø§ÙØ© Ø¹Ø¨Ø§Ø±Ø©</span>
                            </button>
                        </div>
                        <div id="quotesGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <!-- Quotes will be injected here -->
                        </div>
                    </div>

                    <!-- Skills Page -->
                    <div id="skillsPage" class="page-content hidden">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold">ğŸš€ ØªØ·ÙˆÙŠØ± Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª</h2>
                            <button class="btn-primary" onclick="openAddCourseModal()">
                                <span>+ Ø¥Ø¶Ø§ÙØ© Ù…ØµØ¯Ø±</span>
                            </button>
                        </div>

                        <!-- Filter Buttons -->
                        <div class="flex flex-wrap gap-2 mb-6">
                            <button class="filter-btn active px-4 py-2 rounded-full bg-pink-500/20 text-pink-400" data-filter="all" onclick="filterCourses('all')">
                                Ø§Ù„ÙƒÙ„
                            </button>
                            <button class="filter-btn px-4 py-2 rounded-full bg-blue-500/20 text-blue-400" data-filter="Ù‚Ù†Ø§Ø© ÙŠÙˆØªÙŠÙˆØ¨" onclick="filterCourses('Ù‚Ù†Ø§Ø© ÙŠÙˆØªÙŠÙˆØ¨')">
                                ğŸ“º ÙŠÙˆØªÙŠÙˆØ¨
                            </button>
                            <button class="filter-btn px-4 py-2 rounded-full bg-green-500/20 text-green-400" data-filter="ÙƒÙˆØ±Ø³ Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†" onclick="filterCourses('ÙƒÙˆØ±Ø³ Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†')">
                                ğŸ“ ÙƒÙˆØ±Ø³
                            </button>
                            <button class="filter-btn px-4 py-2 rounded-full bg-yellow-500/20 text-yellow-400" data-filter="Ù…Ù†ØµØ© ØªØ¹Ù„ÙŠÙ…ÙŠØ©" onclick="filterCourses('Ù…Ù†ØµØ© ØªØ¹Ù„ÙŠÙ…ÙŠØ©')">
                                ğŸ’» Ù…Ù†ØµØ©
                            </button>
                            <button class="filter-btn px-4 py-2 rounded-full bg-purple-500/20 text-purple-400" data-filter="Ù…Ù‚Ø§Ù„Ø§Øª" onclick="filterCourses('Ù…Ù‚Ø§Ù„Ø§Øª')">
                                ğŸ“ Ù…Ù‚Ø§Ù„Ø§Øª
                            </button>
                            <button class="filter-btn px-4 py-2 rounded-full bg-red-500/20 text-red-400" data-filter="ÙƒØªØ¨" onclick="filterCourses('ÙƒØªØ¨')">
                                ğŸ“š ÙƒØªØ¨
                            </button>
                        </div>

                        <!-- Courses Grid -->
                        <div id="coursesGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <!-- Courses will be injected here -->
                        </div>
                    </div>

                    <!-- Suggestions Page -->
                    <div id="suggestionsPage" class="page-content hidden">
                        <h2 class="text-2xl font-bold mb-6">ğŸ“ Ù…Ù‚ØªØ±Ø­Ø§Øª</h2>
                        <div id="suggestionsContent">
                            <!-- Suggestions will be injected here -->
                        </div>
                    </div>

                    <!-- Members Page -->
                    <div id="membersPage" class="page-content hidden">
                        <h2 class="text-2xl font-bold mb-6">ğŸ‘¥ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</h2>
                        <div id="membersContent">
                            <!-- Members will be injected here -->
                        </div>
                    </div>

                    <!-- Messages Page (Admin Only) -->
                    <div id="messagesPage" class="page-content hidden">
                        <h2 class="text-2xl font-bold mb-6">ğŸ“¨ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</h2>
                        <div id="messagesContent">
                            <!-- Messages will be injected here -->
                        </div>
                    </div>

                    <!-- Codes Page (Admin Only) -->
                    <div id="codesPage" class="page-content hidden">
                        <h2 class="text-2xl font-bold mb-6">ğŸ”‘ Ø±Ù…ÙˆØ² Ø§Ù„ØªØ±Ù‚ÙŠØ©</h2>
                        <div id="codesContent">
                            <!-- Codes will be injected here -->
                        </div>
                    </div>

                    <!-- Settings Page -->
                    <div id="settingsPage" class="page-content hidden">
                        <h2 class="text-2xl font-bold mb-6">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2>
                        <div class="glass-card rounded-2xl p-6">
                            <div class="space-y-6">
                                <div>
                                    <h3 class="text-lg font-bold mb-3">Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©</h3>
                                    <div class="space-y-4">
                                        <div>
                                            <label class="block text-gray-400 mb-2">Ø§Ù„Ø§Ø³Ù…</label>
                                            <input type="text" id="settingsName" class="input-field" value="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
                                        </div>
                                        <div>
                                            <label class="block text-gray-400 mb-2">Ø§Ù„ØªØ®ØµØµ</label>
                                            <input type="text" id="settingsSpecialty" class="input-field" value="Ø§Ù„ØªØ®ØµØµ">
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <h3 class="text-lg font-bold mb-3">Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h3>
                                    <div class="space-y-3">
                                        <label class="flex items-center gap-3">
                                            <input type="checkbox" class="rounded" checked>
                                            <span>Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ ØªØ¹Ù„ÙŠÙ‚Ø§ØªÙŠ</span>
                                        </label>
                                        <label class="flex items-center gap-3">
                                            <input type="checkbox" class="rounded" checked>
                                            <span>Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª</span>
                                        </label>
                                    </div>
                                </div>
                                <div class="pt-4 border-t border-white/10">
                                    <button class="btn-primary w-full" onclick="saveSettings()">
                                        Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Toast Container -->
    <div id="toastContainer" class="fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-80 z-50 space-y-2"></div>

    <script>
        // ============================================
        // Firebase Configuration
        // ============================================
        const firebaseConfig = {
            apiKey: "AIzaSyAVp26636YGOwPIT8X6kWsxKWEnta3A0G4",
            authDomain: "ideas-museum.firebaseapp.com",
            projectId: "ideas-museum",
            storageBucket: "ideas-museum.firebasestorage.app",
            messagingSenderId: "776953892130",
            appId: "1:776953892130:web:b72d1a6e4c9b5f8290697b",
            measurementId: "G-FNKDJSJLE6"
        };

        // Initialize Firebase
        try {
            firebase.initializeApp(firebaseConfig);
        } catch (error) {
            console.log("Firebase already initialized");
        }
        
        const db = firebase.firestore();
        const auth = firebase.auth();
        
        // Initialize Google Auth Provider
        const googleProvider = new firebase.auth.GoogleAuthProvider();
        
        // Email Mode State
        let emailMode = 'login'; // 'login' or 'register'

        // App State
        let appData = {
            users: [],
            ideas: [],
            content: [],
            suggestions: [],
            codes: [],
            quotes: [],
            messages: [],
            courses: [],
            comments: []
        };
        
        let currentUser = null;
        let currentPage = 'home';
        let currentFilter = 'all';
        let currentCourseFilter = 'all';
        let confirmAction = null;
        let viewedIdeas = new Set();
        let currentIdeaId = null;
        let replyingToCommentId = null;

        // Admin Credentials
        const ADMINS = [
            { name: 'Rasha', specialty: '20250929' },
            { name: 'MUF', specialty: 'CS' }
        ];

        // Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª ÙˆØ§Ù„Ù…Ø¯Ø§Ù„ÙŠØ§Øª
        const ACHIEVEMENTS_SYSTEM = {
            levels: [
                { level: 1, name: "Ù…Ø¨ØªØ¯Ø¦", points: 0, color: "text-gray-400" },
                { level: 2, name: "Ù…Ø´Ø§Ø±Ùƒ", points: 50, color: "text-blue-400" },
                { level: 3, name: "Ù†Ø´Ø·", points: 100, color: "text-green-400" },
                { level: 4, name: "Ù…Ù…ÙŠØ²", points: 200, color: "text-purple-400" },
                { level: 5, name: "Ø±Ø§Ø¦Ø¯", points: 500, color: "text-yellow-400" },
                { level: 6, name: "Ø®Ø¨ÙŠØ±", points: 1000, color: "text-orange-400" },
                { level: 7, name: "Ø£Ø³Ø·ÙˆØ±Ø©", points: 2000, color: "text-red-400" }
            ],
            
            badges: {
                'Ø£ÙˆÙ„ ÙÙƒØ±Ø©': { icon: 'ğŸ¥‡', points: 10, description: 'Ù†Ø´Ø± Ø£ÙˆÙ„ ÙÙƒØ±Ø©' },
                'Ù…ÙÙƒØ± Ù†Ø´Ø·': { icon: 'ğŸ’¡', points: 25, description: 'Ù†Ø´Ø± 5 Ø£ÙÙƒØ§Ø±' },
                'Ù…Ø¨Ø¯Ø¹': { icon: 'âœ¨', points: 50, description: 'Ù†Ø´Ø± 10 Ø£ÙÙƒØ§Ø±' },
                'Ù‚Ø§Ø¦Ø¯ Ø§Ù„Ø£ÙÙƒØ§Ø±': { icon: 'ğŸ‘‘', points: 100, description: 'Ù†Ø´Ø± 20 ÙÙƒØ±Ø©' },
                'Ø£ÙˆÙ„ ØªØ¹Ù„ÙŠÙ‚': { icon: 'ğŸ’¬', points: 5, description: 'Ø¥Ø¶Ø§ÙØ© Ø£ÙˆÙ„ ØªØ¹Ù„ÙŠÙ‚' },
                'Ù…Ø¹Ù„Ù‚ Ù†Ø´Ø·': { icon: 'ğŸ—£ï¸', points: 20, description: '10 ØªØ¹Ù„ÙŠÙ‚Ø§Øª' },
                'Ù…ØªÙˆØ§ØµÙ„': { icon: 'ğŸ”', points: 30, description: 'Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª' },
                'Ù…Ø­Ø¨ÙˆØ¨': { icon: 'â¤ï¸', points: 15, description: '10 Ø¥Ø¹Ø¬Ø§Ø¨Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª' },
                'Ø´Ø¹Ø¨ÙŠ': { icon: 'ğŸ”¥', points: 40, description: 'ÙÙƒØ±Ø© Ø­ØµÙ„Øª Ø¹Ù„Ù‰ 50 Ù…Ø´Ø§Ù‡Ø¯Ø©' },
                'Ù…Ø¤Ø«Ø±': { icon: 'â­', points: 75, description: 'ÙÙƒØ±Ø© Ø­ØµÙ„Øª Ø¹Ù„Ù‰ 100 Ù…Ø´Ø§Ù‡Ø¯Ø©' },
                'Ù†Ø§Ø´Ø· Ø§Ù„Ù…Ø¬ØªÙ…Ø¹': { icon: 'ğŸ†', points: 150, description: '100 Ù†Ù‚Ø·Ø© Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©' },
                'Ø£Ø³Ø·ÙˆØ±Ø© Ø§Ù„Ù…ØªØ­Ù': { icon: 'ğŸ›ï¸', points: 500, description: '500 Ù†Ù‚Ø·Ø© Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©' },
                'Ù…ÙÙƒØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹': { icon: 'ğŸ“…', points: 30, description: 'Ø£ÙƒØ«Ø± ÙÙƒØ±Ø© ØªÙØ§Ø¹Ù„Ø§Ù‹ Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹' },
                'Ø§Ù„Ù…Ø¹Ù„Ù‚ Ø§Ù„Ø°Ù‡Ø¨ÙŠ': { icon: 'ğŸ’', points: 40, description: 'Ø£ÙƒØ«Ø± ØªØ¹Ù„ÙŠÙ‚ Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø¥Ø¹Ø¬Ø§Ø¨Ø§Øª' }
            },
            
            // Ø¥Ù†Ø¬Ø§Ø²Ø§Øª Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ù…ÙŠØ²ÙŠÙ†
            premiumAchievements: {
                'Ù†Ø¬Ù…Ø© Ø§Ù„ØµØ¨Ø§Ø­': { icon: 'ğŸŒ…', points: 50, description: 'Ù†Ø´Ø± 3 Ø£ÙÙƒØ§Ø± ÙÙŠ Ø§Ù„ØµØ¨Ø§Ø­ Ø§Ù„Ø¨Ø§ÙƒØ±' },
                'Ù…Ø­Ø§Ø±Ø¨ Ø§Ù„Ø£ÙÙƒØ§Ø±': { icon: 'âš”ï¸', points: 75, description: 'Ù†Ø´Ø± 15 ÙÙƒØ±Ø© Ù…Ø¹ ØªÙØ§Ø¹Ù„ Ø¹Ø§Ù„ÙŠ' },
                'ÙÙŠÙ„Ø³ÙˆÙ Ø§Ù„Ù…ØªØ­Ù': { icon: 'ğŸ›ï¸', points: 100, description: 'Ù†Ø´Ø± 10 Ø£ÙÙƒØ§Ø± ÙÙ„Ø³ÙÙŠØ©' },
                'ØªÙ‚Ù†ÙŠ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„': { icon: 'ğŸ¤–', points: 100, description: 'Ù†Ø´Ø± 10 Ø£ÙÙƒØ§Ø± ØªÙ‚Ù†ÙŠØ©' },
                'Ø£Ø¯ÙŠØ¨ Ø§Ù„Ù…ØªØ­Ù': { icon: 'ğŸ“š', points: 100, description: 'Ù†Ø´Ø± 10 Ø£ÙÙƒØ§Ø± Ø£Ø¯Ø¨ÙŠØ©' }
            }
        };

        // Default Quotes
        const DEFAULT_QUOTES = [
            { text: "Ø§Ù„Ø¹Ù‚Ù„ ÙƒØ§Ù„Ù…Ø¸Ù„Ø©ØŒ Ù„Ø§ ÙŠØ¹Ù…Ù„ Ø¥Ù„Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙØªÙˆØ­Ø§Ù‹", author: "Ø­ÙƒÙ…Ø© Ø´Ø¹Ø¨ÙŠØ©", id: "default_1", isDefault: true },
            { text: "Ø£Ù†Ø§ Ø£ÙÙƒØ±ØŒ Ø¥Ø°Ù† Ø£Ù†Ø§ Ù…ÙˆØ¬ÙˆØ¯", author: "Ø±ÙŠÙ†ÙŠÙ‡ Ø¯ÙŠÙƒØ§Ø±Øª", id: "default_2", isDefault: true },
            { text: "Ø§Ù„ÙÙƒØ±Ø© Ù‡ÙŠ Ø§Ù„Ø¨Ø°Ø±Ø©ØŒ ÙˆØ§Ù„Ø¹Ù‚Ù„ Ù‡Ùˆ Ø§Ù„ØªØ±Ø¨Ø©ØŒ ÙˆØ§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ Ù‡Ùˆ Ø§Ù„Ø«Ù…Ø±Ø©", author: "Ù…Ù† Ø­ÙƒÙ… Ù…ØªØ­Ù Ø§Ù„ÙÙƒØ±", id: "default_3", isDefault: true }
        ];

        const CATEGORY_ICONS = {
            'ÙÙ„Ø³ÙØ©': 'ğŸ§ ', 'ØªÙ‚Ù†ÙŠØ©': 'ğŸ’»', 'Ø£Ø¯Ø¨': 'ğŸ“–', 
            'Ø¹Ù„ÙˆÙ…': 'ğŸ”¬', 'ÙÙ†': 'ğŸ¨', 'Ø§Ø¬ØªÙ…Ø§Ø¹': 'ğŸ‘¥'
        };

        const COURSE_ICONS = {
            'Ù‚Ù†Ø§Ø© ÙŠÙˆØªÙŠÙˆØ¨': 'ğŸ“º', 'ÙƒÙˆØ±Ø³ Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†': 'ğŸ“', 'Ù…Ù†ØµØ© ØªØ¹Ù„ÙŠÙ…ÙŠØ©': 'ğŸ’»',
            'Ù…Ù‚Ø§Ù„Ø§Øª': 'ğŸ“', 'ÙƒØªØ¨': 'ğŸ“š', 'Ø¨ÙˆØ¯ÙƒØ§Ø³Øª': 'ğŸ™ï¸'
        };

        // ============================================
        // Initialize App
        // ============================================
        async function initApp() {
            try {
                console.log("Initializing app...");
                
                // Check for saved user
                const savedUser = localStorage.getItem('muf_user');
                if (savedUser) {
                    try {
                        currentUser = JSON.parse(savedUser);
                        console.log("Found saved user:", currentUser.name);
                        await loadAllData();
                        showMainApp();
                        return;
                    } catch (e) {
                        console.error("Error parsing saved user:", e);
                        localStorage.removeItem('muf_user');
                    }
                }
                
                // Set up auth state listener
                auth.onAuthStateChanged(async (user) => {
                    console.log("Auth state changed:", user ? "User signed in" : "User signed out");
                    if (user) {
                        await handleAuthenticatedUser(user);
                    } else {
                        // User signed out, do nothing
                    }
                });
                
                // Initial render of quotes
                renderQuotes();
                
                // Show menu toggle on mobile
                if (window.innerWidth < 769) {
                    document.getElementById('menuToggle').classList.remove('hidden');
                }
                
                // Handle window resize
                window.addEventListener('resize', handleWindowResize);
                
                // Test Firebase connection
                try {
                    const testDoc = await db.collection('test').doc('test').get();
                    console.log("Firebase connected successfully");
                } catch (error) {
                    console.error("Firebase connection error:", error);
                    showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
                }
                
            } catch (error) {
                console.error('Error initializing app:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚', 'error');
            }
        }

        function handleWindowResize() {
            if (window.innerWidth < 769) {
                document.getElementById('menuToggle').classList.remove('hidden');
            } else {
                document.getElementById('menuToggle').classList.add('hidden');
                document.getElementById('sidebar').classList.remove('sidebar-open');
                document.getElementById('sidebarOverlay').classList.remove('active');
            }
        }

        // ============================================
        // Auth Functions
        // ============================================
        function switchAuthTab(tab) {
            document.getElementById('tabTraditional').classList.remove('active');
            document.getElementById('tabEmail').classList.remove('active');
            document.getElementById(`tab${tab.charAt(0).toUpperCase() + tab.slice(1)}`).classList.add('active');
            
            document.getElementById('traditionalLogin').classList.add('hidden');
            document.getElementById('emailLogin').classList.add('hidden');
            document.getElementById(`${tab}Login`).classList.remove('hidden');
            
            if (tab === 'email') {
                emailMode = 'login';
                document.getElementById('emailToggleText').textContent = 'Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯';
                document.getElementById('emailAuthBtnText').textContent = 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
                document.getElementById('registerFields').classList.add('hidden');
                document.getElementById('emailLoginFields').classList.remove('hidden');
            }
        }

        function toggleEmailMode() {
            if (emailMode === 'login') {
                emailMode = 'register';
                document.getElementById('emailToggleText').textContent = 'Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
                document.getElementById('emailAuthBtnText').textContent = 'Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨';
                document.getElementById('registerFields').classList.remove('hidden');
                document.getElementById('emailLoginFields').classList.add('hidden');
            } else {
                emailMode = 'login';
                document.getElementById('emailToggleText').textContent = 'Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯';
                document.getElementById('emailAuthBtnText').textContent = 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
                document.getElementById('registerFields').classList.add('hidden');
                document.getElementById('emailLoginFields').classList.remove('hidden');
            }
        }

        // Traditional Login (Admin Only)
        async function handleTraditionalLogin() {
            const name = document.getElementById('loginName').value.trim();
            const specialty = document.getElementById('loginSpecialty').value.trim();
            
            if (!name || !specialty) {
                showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠØ± ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±', 'error');
                return;
            }
            
            const btnText = document.getElementById('traditionalLoginBtnText');
            const spinner = document.getElementById('traditionalLoginSpinner');
            
            btnText.classList.add('hidden');
            spinner.classList.remove('hidden');
            
            try {
                // Check if user is banned
                const bannedUsers = appData.users.filter(u => u.isBanned);
                const isBanned = bannedUsers.some(u => u.name === name);
                
                if (isBanned) {
                    showToast('Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ø­Ø¸ÙˆØ± Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø¯ÙŠØ±', 'error');
                    btnText.classList.remove('hidden');
                    spinner.classList.add('hidden');
                    return;
                }
                
                // Check admin credentials
                const isAdmin = ADMINS.find(admin => 
                    admin.name === name && admin.specialty === specialty
                );
                
                if (!isAdmin) {
                    showToast('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯ÙŠØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
                    btnText.classList.remove('hidden');
                    spinner.classList.add('hidden');
                    return;
                }
                
                // Create admin user object
                const adminUser = {
                    id: `admin_${name}_${Date.now()}`,
                    email: null,
                    name: name,
                    specialty: specialty,
                    role: 'admin',
                    points: 1000,
                    ideasCount: 0,
                    commentsCount: 0,
                    createdAt: new Date().toISOString(),
                    level: 7,
                    achievements: ['Ø£Ø³Ø·ÙˆØ±Ø© Ø§Ù„Ù…ØªØ­Ù', 'Ù‚Ø§Ø¦Ø¯ Ø§Ù„Ø£ÙÙƒØ§Ø±']
                };
                
                // Check if admin exists in Firestore
                const existingAdmin = appData.users.find(u => u.name === name && u.role === 'admin');
                if (!existingAdmin) {
                    // Save admin to Firestore
                    await db.collection('users').doc(adminUser.id).set(adminUser);
                }
                
                // Set current user
                currentUser = adminUser;
                
                // Save to localStorage
                localStorage.setItem('muf_user', JSON.stringify(adminUser));
                
                // Load data and show app
                await loadAllData();
                showMainApp();
                
                showToast(`Ù…Ø±Ø­Ø¨Ø§Ù‹ ${name}!`, 'success');
                
            } catch (error) {
                console.error('Traditional login error:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„', 'error');
            } finally {
                btnText.classList.remove('hidden');
                spinner.classList.add('hidden');
            }
        }

        // Email Authentication
        async function handleEmailAuth() {
            const btnText = document.getElementById('emailAuthBtnText');
            const spinner = document.getElementById('emailAuthSpinner');
            
            if (emailMode === 'login') {
                const email = document.getElementById('loginEmail').value.trim();
                const password = document.getElementById('loginPassword').value.trim();
                
                if (!email || !password) {
                    showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±', 'error');
                    return;
                }
                
                btnText.classList.add('hidden');
                spinner.classList.remove('hidden');
                
                try {
                    const userCredential = await auth.signInWithEmailAndPassword(email, password);
                    console.log("Email login successful");
                    // The user will be handled by auth state listener
                } catch (error) {
                    console.error('Login error:', error);
                    showToast('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: ' + error.message, 'error');
                } finally {
                    btnText.classList.remove('hidden');
                    spinner.classList.add('hidden');
                }
            } else {
                // Register mode
                const email = document.getElementById('loginEmail').value.trim();
                const password = document.getElementById('loginPassword').value.trim();
                const name = document.getElementById('registerName').value.trim();
                const specialty = document.getElementById('registerSpecialty').value.trim();
                const code = document.getElementById('registerCode').value.trim();
                
                if (!email || !password || !name || !specialty) {
                    showToast('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
                    return;
                }
                
                btnText.classList.add('hidden');
                spinner.classList.remove('hidden');
                
                try {
                    const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                    const user = userCredential.user;
                    
                    console.log("Registration successful, user ID:", user.uid);
                    
                    // Prepare user data
                    let userData = {
                        id: user.uid,
                        email: user.email,
                        name: name,
                        specialty: specialty,
                        role: 'user',
                        points: 0,
                        ideasCount: 0,
                        commentsCount: 0,
                        createdAt: new Date().toISOString(),
                        level: 1,
                        achievements: []
                    };
                    
                    // Check if promotion code is provided
                    if (code) {
                        const codeDoc = await db.collection('codes').doc(code).get();
                        if (codeDoc.exists && !codeDoc.data().used) {
                            userData.role = 'premium';
                            // Mark code as used
                            await db.collection('codes').doc(code).update({
                                used: true,
                                usedBy: user.uid,
                                usedAt: new Date().toISOString()
                            });
                            showToast('ØªÙ… Ø§Ù„ØªØ±Ù‚ÙŠØ© Ø¥Ù„Ù‰ Ø¹Ø¶Ùˆ Ù…Ù…ÙŠØ²!', 'success');
                        } else if (code) {
                            showToast('Ø±Ù…Ø² Ø§Ù„ØªØ±Ù‚ÙŠØ© ØºÙŠØ± ØµØ§Ù„Ø­ Ø£Ùˆ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¨Ù‚Ø§Ù‹', 'warning');
                        }
                    }
                    
                    // Save user data to Firestore
                    await db.collection('users').doc(user.uid).set(userData);
                    console.log("User data saved to Firestore");
                    
                    // Set current user and save to localStorage
                    currentUser = userData;
                    localStorage.setItem('muf_user', JSON.stringify(userData));
                    
                    // Load data and show app
                    await loadAllData();
                    showMainApp();
                    
                    showToast('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                    
                } catch (error) {
                    console.error('Registration error:', error);
                    if (error.code === 'auth/email-already-in-use') {
                        showToast('Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„', 'error');
                    } else if (error.code === 'auth/weak-password') {
                        showToast('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¶Ø¹ÙŠÙØ©ØŒ ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', 'error');
                    } else {
                        showToast('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨: ' + error.message, 'error');
                    }
                } finally {
                    btnText.classList.remove('hidden');
                    spinner.classList.add('hidden');
                }
            }
        }

        // Google Authentication
        async function handleGoogleLogin() {
            try {
                const result = await auth.signInWithPopup(googleProvider);
                const user = result.user;
                
                console.log("Google login successful, user:", user.displayName);
                // The user will be handled by auth state listener
                
            } catch (error) {
                console.error('Google login error:', error);
                if (error.code === 'auth/popup-closed-by-user') {
                    showToast('ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„', 'info');
                } else {
                    showToast('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø¬ÙˆØ¬Ù„: ' + error.message, 'error');
                }
            }
        }

        // Handle Authenticated User (Email or Google)
        async function handleAuthenticatedUser(user) {
            try {
                console.log("Handling authenticated user:", user.uid);
                
                // Get user data from Firestore
                const userDoc = await db.collection('users').doc(user.uid).get();
                
                if (userDoc.exists) {
                    // User exists in Firestore
                    currentUser = { id: user.uid, ...userDoc.data() };
                    console.log("User found in Firestore:", currentUser.name);
                } else {
                    // New user - create user data
                    let name = user.displayName || 'Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯';
                    let specialty = 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                    
                    // If user doesn't have name from Google, show modal to get name and specialty
                    if (!user.displayName || user.displayName === 'Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯') {
                        // We'll ask for name and specialty in a modal
                        const userName = prompt("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù…Ùƒ:");
                        const userSpecialty = prompt("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ØªØ®ØµØµÙƒ:");
                        
                        if (!userName || !userSpecialty) {
                            showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„ØªØ®ØµØµ', 'error');
                            await auth.signOut();
                            return;
                        }
                        
                        name = userName;
                        specialty = userSpecialty;
                    }
                    
                    const userData = {
                        id: user.uid,
                        email: user.email,
                        name: name,
                        specialty: specialty,
                        role: 'user',
                        points: 0,
                        ideasCount: 0,
                        commentsCount: 0,
                        createdAt: new Date().toISOString(),
                        level: 1,
                        achievements: []
                    };
                    
                    // Save to Firestore
                    await db.collection('users').doc(user.uid).set(userData);
                    currentUser = userData;
                    console.log("New user created in Firestore:", currentUser.name);
                }
                
                // Save to localStorage
                localStorage.setItem('muf_user', JSON.stringify(currentUser));
                console.log("User saved to localStorage");
                
                // Load all data
                await loadAllData();
                
                // Show main app
                showMainApp();
                
                showToast(`Ù…Ø±Ø­Ø¨Ø§Ù‹ ${currentUser.name}!`, 'success');
                
            } catch (error) {
                console.error('Error handling authenticated user:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', 'error');
            }
        }

        // ============================================
        // Core Functions
        // ============================================
        async function loadAllData() {
            try {
                console.log("Loading all data...");
                
                // Load users
                const usersSnapshot = await db.collection('users').get();
                appData.users = usersSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                console.log("Users loaded:", appData.users.length);
                
                // Load ideas
                const ideasSnapshot = await db.collection('ideas').get();
                appData.ideas = ideasSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                console.log("Ideas loaded:", appData.ideas.length);
                
                // Load comments
                const commentsSnapshot = await db.collection('comments').get();
                appData.comments = commentsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                console.log("Comments loaded:", appData.comments.length);
                
                // Load quotes
                const quotesSnapshot = await db.collection('quotes').get();
                const userQuotes = quotesSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                appData.quotes = [...DEFAULT_QUOTES, ...userQuotes];
                console.log("Quotes loaded:", appData.quotes.length);
                
                // Load courses
                const coursesSnapshot = await db.collection('courses').get();
                appData.courses = coursesSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                console.log("Courses loaded:", appData.courses.length);
                
                // Load messages
                const messagesSnapshot = await db.collection('messages').get();
                appData.messages = messagesSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                console.log("Messages loaded:", appData.messages.length);
                
                // Load suggestions
                const suggestionsSnapshot = await db.collection('suggestions').get();
                appData.suggestions = suggestionsSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                console.log("Suggestions loaded:", appData.suggestions.length);
                
                // Load codes
                const codesSnapshot = await db.collection('codes').get();
                appData.codes = codesSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                console.log("Codes loaded:", appData.codes.length);
                
                // Update UI
                updateUIAfterDataLoad();
                
                showToast('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                
            } catch (error) {
                console.error('Error loading data:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
            }
        }

        function updateUIAfterDataLoad() {
            if (!currentUser) return;
            
            console.log("Updating UI for user:", currentUser.name);
            
            // Update user info in sidebar
            document.getElementById('currentUserName').textContent = currentUser.name;
            document.getElementById('currentUserSpecialty').textContent = currentUser.specialty;
            document.getElementById('userRoleDisplay').textContent = 
                currentUser.role === 'admin' ? 'Ù…Ø¯ÙŠØ±' : 
                currentUser.role === 'premium' ? 'Ø¹Ø¶Ùˆ Ù…Ù…ÙŠØ²' : 'Ø¹Ø¶Ùˆ';
            
            // Update user avatar
            const avatar = document.getElementById('userAvatar');
            avatar.textContent = currentUser.role === 'admin' ? 'ğŸ‘‘' : 
                                currentUser.role === 'premium' ? 'ğŸ’¡' : 'ğŸ‘¤';
            
            // Update user level
            updateUserLevelDisplay();
            
            // Update achievements badge
            updateAchievementsBadge();
            
            // Update points display
            document.getElementById('userPointsDisplay').textContent = currentUser.points || 0;
            document.getElementById('userPoints').textContent = currentUser.points || 0;
            
            // Show/hide admin menu items
            const adminMenu = document.getElementById('adminMenuItems');
            const userMessageButton = document.getElementById('userMessageButton');
            if (currentUser.role === 'admin') {
                adminMenu.classList.remove('hidden');
                userMessageButton.classList.add('hidden');
                // Show admin stats
                document.getElementById('adminStats').classList.remove('hidden');
            } else {
                adminMenu.classList.add('hidden');
                userMessageButton.classList.remove('hidden');
                // Hide admin stats for regular users
                document.getElementById('adminStats').classList.add('hidden');
            }
            
            // Show/hide add idea button based on role
            const addIdeaBtn = document.getElementById('addIdeaBtn');
            const addIdeaBtn2 = document.getElementById('addIdeaBtn2');
            if (currentUser.role === 'admin' || currentUser.role === 'premium') {
                addIdeaBtn.classList.remove('hidden');
                addIdeaBtn2.classList.remove('hidden');
            } else {
                addIdeaBtn.classList.add('hidden');
                addIdeaBtn2.classList.add('hidden');
            }
            
            // Update welcome name
            document.getElementById('welcomeName').textContent = currentUser.name.split(' ')[0];
            document.getElementById('welcomeNameLarge').textContent = currentUser.name.split(' ')[0];
            
            // Update stats
            updateStats();
            
            // Render current page
            renderPage(currentPage);
        }

        function showMainApp() {
            console.log("Showing main app");
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
        }

        // ============================================
        // Navigation
        // ============================================
        function navigateTo(page) {
            // Update sidebar active item
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.page === page) {
                    item.classList.add('active');
                }
            });
            
            // Hide all pages
            document.querySelectorAll('.page-content').forEach(pageElement => {
                pageElement.classList.add('hidden');
            });
            
            // Show selected page
            const pageElement = document.getElementById(page + 'Page');
            if (pageElement) {
                pageElement.classList.remove('hidden');
                currentPage = page;
                renderPage(page);
            }
            
            // Close sidebar on mobile
            if (window.innerWidth < 769) {
                toggleSidebar();
            }
        }

        function renderPage(page) {
            switch(page) {
                case 'home':
                    renderHomePage();
                    break;
                case 'ideas':
                    renderIdeasPage();
                    break;
                case 'comments':
                    renderCommentsPage();
                    break;
                case 'leaderboard':
                    renderLeaderboardPage();
                    break;
                case 'content':
                    renderContentPage();
                    break;
                case 'philosophy':
                    // Static page, already loaded
                    break;
                case 'quotes':
                    renderQuotesPage();
                    break;
                case 'skills':
                    renderSkillsPage();
                    break;
                case 'suggestions':
                    renderSuggestionsPage();
                    break;
                case 'members':
                    renderMembersPage();
                    break;
                case 'messages':
                    renderMessagesPage();
                    break;
                case 'codes':
                    renderCodesPage();
                    break;
                case 'settings':
                    renderSettingsPage();
                    break;
            }
        }

        // ============================================
        // Modal Functions
        // ============================================
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('hidden');
                document.body.style.overflow = 'auto';
            }
        }

        function openAddIdeaModal() {
            if (!currentUser) return;
            if (currentUser.role === 'user') {
                showToast('ÙŠØ¬Ø¨ ØªØ±Ù‚ÙŠØ© Ø­Ø³Ø§Ø¨Ùƒ Ù„Ù†Ø´Ø± Ø§Ù„Ø£ÙÙƒØ§Ø±', 'error');
                return;
            }
            openModal('addIdeaModal');
        }

        function openAddQuoteModal() {
            openModal('addQuoteModal');
        }

        function openAddCourseModal() {
            openModal('addCourseModal');
        }

        function openMessageAdminModal() {
            openModal('messageAdminModal');
        }

        function openRequestCodeModal() {
            document.getElementById('messageType').value = 'Ø·Ù„Ø¨ Ø±Ù…Ø² ØªØ±Ù‚ÙŠØ©';
            openModal('messageAdminModal');
        }
        
        function openAchievementsModal() {
            renderAchievementsModal();
            openModal('achievementsModal');
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            if (window.innerWidth < 769) {
                sidebar.classList.toggle('sidebar-open');
                overlay.classList.toggle('active');
            }
        }

        // ============================================
        // Data Management Functions
        // ============================================
        async function submitNewIdea() {
            const title = document.getElementById('newIdeaTitle').value.trim();
            const category = document.getElementById('newIdeaCategory').value;
            const content = document.getElementById('newIdeaContent').value.trim();
            
            if (!title || !content) {
                showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† ÙˆÙ…Ø­ØªÙˆÙ‰ Ø§Ù„ÙÙƒØ±Ø©', 'error');
                return;
            }
            
            try {
                const ideaData = {
                    title: title,
                    category: category,
                    content: content,
                    authorId: currentUser.id,
                    authorName: currentUser.name,
                    authorRole: currentUser.role,
                    views: 0,
                    likes: 0,
                    commentsCount: 0,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                // Add to Firestore
                const docRef = await db.collection('ideas').add(ideaData);
                
                // Update user's ideas count
                await db.collection('users').doc(currentUser.id).update({
                    ideasCount: firebase.firestore.FieldValue.increment(1)
                });
                
                // Add points to user
                await addUserPoints(currentUser.id, 10);
                
                // Check for achievements
                await checkAchievements(currentUser.id);
                
                // Update local data
                ideaData.id = docRef.id;
                appData.ideas.unshift(ideaData);
                
                // Clear form
                document.getElementById('newIdeaTitle').value = '';
                document.getElementById('newIdeaContent').value = '';
                
                showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙÙƒØ±Ø© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                closeModal('addIdeaModal');
                
                // Navigate to ideas page
                navigateTo('ideas');
                
            } catch (error) {
                console.error('Error adding idea:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙÙƒØ±Ø©', 'error');
            }
        }

        async function submitNewQuote() {
            const text = document.getElementById('newQuoteText').value.trim();
            const author = document.getElementById('newQuoteAuthor').value.trim() || 'Ù…Ø¬Ù‡ÙˆÙ„';
            
            if (!text) {
                showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù†Øµ Ø§Ù„Ø¹Ø¨Ø§Ø±Ø©', 'error');
                return;
            }
            
            try {
                const quoteData = {
                    text: text,
                    author: author,
                    addedBy: currentUser.id,
                    addedByName: currentUser.name,
                    addedAt: new Date().toISOString(),
                    likes: 0
                };
                
                // Add to Firestore
                await db.collection('quotes').add(quoteData);
                
                showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø¨Ø§Ø±Ø© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                closeModal('addQuoteModal');
                
                // Update quotes
                await loadAllData();
                
            } catch (error) {
                console.error('Error adding quote:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø¨Ø§Ø±Ø©', 'error');
            }
        }

        async function submitNewCourse() {
            const title = document.getElementById('newCourseTitle').value.trim();
            const type = document.getElementById('newCourseType').value;
            const description = document.getElementById('newCourseDescription').value.trim();
            const link = document.getElementById('newCourseLink').value.trim();
            
            if (!title || !description) {
                showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† ÙˆÙˆØµÙ Ø§Ù„Ù…ØµØ¯Ø±', 'error');
                return;
            }
            
            try {
                const courseData = {
                    title: title,
                    type: type,
                    description: description,
                    link: link || null,
                    addedBy: currentUser.id,
                    addedByName: currentUser.name,
                    addedAt: new Date().toISOString(),
                    likes: 0
                };
                
                // Add to Firestore
                await db.collection('courses').add(courseData);
                
                showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ØµØ¯Ø± Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                closeModal('addCourseModal');
                
                // Update courses
                await loadAllData();
                
            } catch (error) {
                console.error('Error adding course:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ØµØ¯Ø±', 'error');
            }
        }

        async function sendMessageToAdmin() {
            const title = document.getElementById('messageTitle').value.trim();
            const type = document.getElementById('messageType').value;
            const content = document.getElementById('messageContent').value.trim();
            
            if (!title || !content) {
                showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† ÙˆÙ…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø³Ø§Ù„Ø©', 'error');
                return;
            }
            
            try {
                const messageData = {
                    title: title,
                    type: type,
                    content: content,
                    fromUserId: currentUser.id,
                    fromUserName: currentUser.name,
                    fromUserRole: currentUser.role,
                    isRead: false,
                    createdAt: new Date().toISOString()
                };
                
                // Add to Firestore
                await db.collection('messages').add(messageData);
                
                showToast('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                closeModal('messageAdminModal');
                
                // Update messages
                await loadAllData();
                
            } catch (error) {
                console.error('Error sending message:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©', 'error');
            }
        }

        // ============================================
        // User Functions
        // ============================================
        async function handleLogout() {
            try {
                // Sign out from Firebase
                await auth.signOut();
                
                // Clear local data
                currentUser = null;
                localStorage.removeItem('muf_user');
                
                // Show login screen
                document.getElementById('loginScreen').classList.remove('hidden');
                document.getElementById('mainApp').classList.add('hidden');
                
                // Reset login forms
                document.getElementById('loginEmail').value = '';
                document.getElementById('loginPassword').value = '';
                document.getElementById('loginName').value = '';
                document.getElementById('loginSpecialty').value = '';
                document.getElementById('registerName').value = '';
                document.getElementById('registerSpecialty').value = '';
                document.getElementById('registerCode').value = '';
                
                showToast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                
            } catch (error) {
                console.error('Logout error:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬', 'error');
            }
        }

        async function addUserPoints(userId, points) {
            try {
                const userRef = db.collection('users').doc(userId);
                await userRef.update({
                    points: firebase.firestore.FieldValue.increment(points)
                });
                
                // Update local user data
                const user = appData.users.find(u => u.id === userId);
                if (user) {
                    user.points = (user.points || 0) + points;
                    user.level = calculateLevel(user.points);
                }
                
                // Update current user if needed
                if (currentUser && currentUser.id === userId) {
                    currentUser.points += points;
                    currentUser.level = calculateLevel(currentUser.points);
                    updateUserLevelDisplay();
                    updateStats();
                }
                
            } catch (error) {
                console.error('Error adding user points:', error);
            }
        }

        function calculateLevel(points) {
            for (let i = ACHIEVEMENTS_SYSTEM.levels.length - 1; i >= 0; i--) {
                if (points >= ACHIEVEMENTS_SYSTEM.levels[i].points) {
                    return ACHIEVEMENTS_SYSTEM.levels[i].level;
                }
            }
            return 1;
        }

        function updateUserLevelDisplay() {
            const levelContainer = document.getElementById('userLevel');
            if (!currentUser || !levelContainer) return;
            
            const currentLevel = ACHIEVEMENTS_SYSTEM.levels.find(l => l.level === currentUser.level) || ACHIEVEMENTS_SYSTEM.levels[0];
            const nextLevel = ACHIEVEMENTS_SYSTEM.levels.find(l => l.level === currentUser.level + 1);
            
            let progress = 0;
            if (nextLevel) {
                const currentLevelPoints = currentLevel.points;
                const nextLevelPoints = nextLevel.points;
                const pointsNeeded = nextLevelPoints - currentLevelPoints;
                const pointsAchieved = currentUser.points - currentLevelPoints;
                progress = Math.min(100, Math.round((pointsAchieved / pointsNeeded) * 100));
            } else {
                progress = 100;
            }
            
            levelContainer.innerHTML = `
                <div class="flex justify-between text-xs mb-1">
                    <span class="${currentLevel.color}">Ø§Ù„Ù…Ø³ØªÙˆÙ‰ ${currentUser.level}: ${currentLevel.name}</span>
                    <span>${currentUser.points} Ù†Ù‚Ø·Ø©</span>
                </div>
                <div class="level-indicator">
                    <div class="level-progress" style="width: ${progress}%"></div>
                </div>
            `;
            
            // Update level display in home page
            document.getElementById('userLevelDisplay').textContent = currentLevel.name;
        }

        async function checkAchievements(userId) {
            try {
                const user = appData.users.find(u => u.id === userId);
                if (!user) return;
                
                const achievements = user.achievements || [];
                const newAchievements = [];
                
                // Check for idea-based achievements
                const userIdeas = appData.ideas.filter(i => i.authorId === userId);
                const userComments = appData.comments.filter(c => c.userId === userId);
                
                // Ø£ÙˆÙ„ ÙÙƒØ±Ø©
                if (userIdeas.length === 1 && !achievements.includes('Ø£ÙˆÙ„ ÙÙƒØ±Ø©')) {
                    newAchievements.push('Ø£ÙˆÙ„ ÙÙƒØ±Ø©');
                }
                
                // Ù…ÙÙƒØ± Ù†Ø´Ø· (5 Ø£ÙÙƒØ§Ø±)
                if (userIdeas.length >= 5 && !achievements.includes('Ù…ÙÙƒØ± Ù†Ø´Ø·')) {
                    newAchievements.push('Ù…ÙÙƒØ± Ù†Ø´Ø·');
                }
                
                // Ù…Ø¨Ø¯Ø¹ (10 Ø£ÙÙƒØ§Ø±)
                if (userIdeas.length >= 10 && !achievements.includes('Ù…Ø¨Ø¯Ø¹')) {
                    newAchievements.push('Ù…Ø¨Ø¯Ø¹');
                }
                
                // Ù‚Ø§Ø¦Ø¯ Ø§Ù„Ø£ÙÙƒØ§Ø± (20 ÙÙƒØ±Ø©)
                if (userIdeas.length >= 20 && !achievements.includes('Ù‚Ø§Ø¦Ø¯ Ø§Ù„Ø£ÙÙƒØ§Ø±')) {
                    newAchievements.push('Ù‚Ø§Ø¦Ø¯ Ø§Ù„Ø£ÙÙƒØ§Ø±');
                }
                
                // Ø£ÙˆÙ„ ØªØ¹Ù„ÙŠÙ‚
                if (userComments.length === 1 && !achievements.includes('Ø£ÙˆÙ„ ØªØ¹Ù„ÙŠÙ‚')) {
                    newAchievements.push('Ø£ÙˆÙ„ ØªØ¹Ù„ÙŠÙ‚');
                }
                
                // Ù…Ø¹Ù„Ù‚ Ù†Ø´Ø· (10 ØªØ¹Ù„ÙŠÙ‚Ø§Øª)
                if (userComments.length >= 10 && !achievements.includes('Ù…Ø¹Ù„Ù‚ Ù†Ø´Ø·')) {
                    newAchievements.push('Ù…Ø¹Ù„Ù‚ Ù†Ø´Ø·');
                }
                
                // Ù†Ø§Ø´Ø· Ø§Ù„Ù…Ø¬ØªÙ…Ø¹ (100 Ù†Ù‚Ø·Ø©)
                if (user.points >= 100 && !achievements.includes('Ù†Ø§Ø´Ø· Ø§Ù„Ù…Ø¬ØªÙ…Ø¹')) {
                    newAchievements.push('Ù†Ø§Ø´Ø· Ø§Ù„Ù…Ø¬ØªÙ…Ø¹');
                }
                
                // Ø£Ø³Ø·ÙˆØ±Ø© Ø§Ù„Ù…ØªØ­Ù (500 Ù†Ù‚Ø·Ø©)
                if (user.points >= 500 && !achievements.includes('Ø£Ø³Ø·ÙˆØ±Ø© Ø§Ù„Ù…ØªØ­Ù')) {
                    newAchievements.push('Ø£Ø³Ø·ÙˆØ±Ø© Ø§Ù„Ù…ØªØ­Ù');
                }
                
                // Check for premium user achievements
                if (user.role === 'premium') {
                    const premiumAchievements = ACHIEVEMENTS_SYSTEM.premiumAchievements;
                    
                    // Check morning star achievement (ideas published between 4 AM and 8 AM)
                    const morningIdeas = userIdeas.filter(idea => {
                        const hour = new Date(idea.createdAt).getHours();
                        return hour >= 4 && hour <= 8;
                    });
                    
                    if (morningIdeas.length >= 3 && !achievements.includes('Ù†Ø¬Ù…Ø© Ø§Ù„ØµØ¨Ø§Ø­')) {
                        newAchievements.push('Ù†Ø¬Ù…Ø© Ø§Ù„ØµØ¨Ø§Ø­');
                    }
                    
                    // Ù…Ø­Ø§Ø±Ø¨ Ø§Ù„Ø£ÙÙƒØ§Ø± (Ø£ÙÙƒØ§Ø± Ø°Ø§Øª ØªÙØ§Ø¹Ù„ Ø¹Ø§Ù„ÙŠ)
                    const highEngagementIdeas = userIdeas.filter(idea => 
                        (idea.views || 0) >= 50 || (idea.likes || 0) >= 10 || (idea.commentsCount || 0) >= 5
                    );
                    
                    if (highEngagementIdeas.length >= 15 && !achievements.includes('Ù…Ø­Ø§Ø±Ø¨ Ø§Ù„Ø£ÙÙƒØ§Ø±')) {
                        newAchievements.push('Ù…Ø­Ø§Ø±Ø¨ Ø§Ù„Ø£ÙÙƒØ§Ø±');
                    }
                    
                    // ÙÙŠÙ„Ø³ÙˆÙ Ø§Ù„Ù…ØªØ­Ù (Ø£ÙÙƒØ§Ø± ÙÙ„Ø³ÙÙŠØ©)
                    const philosophyIdeas = userIdeas.filter(idea => idea.category === 'ÙÙ„Ø³ÙØ©');
                    if (philosophyIdeas.length >= 10 && !achievements.includes('ÙÙŠÙ„Ø³ÙˆÙ Ø§Ù„Ù…ØªØ­Ù')) {
                        newAchievements.push('ÙÙŠÙ„Ø³ÙˆÙ Ø§Ù„Ù…ØªØ­Ù');
                    }
                    
                    // ØªÙ‚Ù†ÙŠ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ (Ø£ÙÙƒØ§Ø± ØªÙ‚Ù†ÙŠØ©)
                    const techIdeas = userIdeas.filter(idea => idea.category === 'ØªÙ‚Ù†ÙŠØ©');
                    if (techIdeas.length >= 10 && !achievements.includes('ØªÙ‚Ù†ÙŠ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„')) {
                        newAchievements.push('ØªÙ‚Ù†ÙŠ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„');
                    }
                    
                    // Ø£Ø¯ÙŠØ¨ Ø§Ù„Ù…ØªØ­Ù (Ø£ÙÙƒØ§Ø± Ø£Ø¯Ø¨ÙŠØ©)
                    const literatureIdeas = userIdeas.filter(idea => idea.category === 'Ø£Ø¯Ø¨');
                    if (literatureIdeas.length >= 10 && !achievements.includes('Ø£Ø¯ÙŠØ¨ Ø§Ù„Ù…ØªØ­Ù')) {
                        newAchievements.push('Ø£Ø¯ÙŠØ¨ Ø§Ù„Ù…ØªØ­Ù');
                    }
                }
                
                // Add new achievements
                if (newAchievements.length > 0) {
                    const updatedAchievements = [...achievements, ...newAchievements];
                    
                    await db.collection('users').doc(userId).update({
                        achievements: updatedAchievements
                    });
                    
                    // Update local user
                    user.achievements = updatedAchievements;
                    if (currentUser && currentUser.id === userId) {
                        currentUser.achievements = updatedAchievements;
                        updateAchievementsBadge();
                    }
                    
                    // Show achievement notifications
                    newAchievements.forEach(achievement => {
                        const badge = ACHIEVEMENTS_SYSTEM.badges[achievement] || ACHIEVEMENTS_SYSTEM.premiumAchievements[achievement];
                        if (badge) {
                            showToast(`ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ! Ù„Ù‚Ø¯ Ø­ØµÙ„Øª Ø¹Ù„Ù‰ Ø¥Ù†Ø¬Ø§Ø²: ${achievement} ${badge.icon}`, 'success');
                        }
                    });
                }
                
            } catch (error) {
                console.error('Error checking achievements:', error);
            }
        }

        function updateAchievementsBadge() {
            const badge = document.getElementById('achievementsBadge');
            if (!currentUser || !badge) return;
            
            const achievements = currentUser.achievements || [];
            
            if (achievements.length > 0) {
                badge.textContent = achievements.length;
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        }
        
        function renderAchievementsModal() {
            const achievementsContent = document.getElementById('achievementsContent');
            
            if (!currentUser) return;
            
            const achievements = currentUser.achievements || [];
            const allAchievements = { ...ACHIEVEMENTS_SYSTEM.badges, ...ACHIEVEMENTS_SYSTEM.premiumAchievements };
            
            let html = '';
            
            if (achievements.length === 0) {
                html = `
                    <div class="text-center py-8 text-gray-400">
                        <p class="text-5xl mb-4">ğŸ†</p>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ù†Ø¬Ø§Ø²Ø§Øª Ø¨Ø¹Ø¯</p>
                        <p class="text-sm mt-2">Ø§Ø¨Ø¯Ø£ Ø¨Ù†Ø´Ø± Ø§Ù„Ø£ÙÙƒØ§Ø± ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ‚ Ù„ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ø¥Ù†Ø¬Ø§Ø²Ø§Øª!</p>
                    </div>
                `;
            } else {
                html = `
                    <div class="mb-4">
                        <p class="text-gray-300">Ù„Ø¯ÙŠÙƒ <span class="text-pink-400 font-bold">${achievements.length}</span> Ø¥Ù†Ø¬Ø§Ø²</p>
                    </div>
                    <div class="space-y-3">
                `;
                
                achievements.forEach(achievementName => {
                    const achievement = allAchievements[achievementName];
                    if (achievement) {
                        html += `
                            <div class="glass-card rounded-xl p-4 flex items-center gap-4">
                                <span class="text-2xl">${achievement.icon}</span>
                                <div class="flex-1">
                                    <h4 class="font-bold">${achievementName}</h4>
                                    <p class="text-sm text-gray-400">${achievement.description}</p>
                                </div>
                                <span class="text-yellow-400">+${achievement.points} Ù†Ù‚Ø·Ø©</span>
                            </div>
                        `;
                    }
                });
                
                html += `</div>`;
                
                // Show locked achievements for premium users
                if (currentUser.role === 'premium') {
                    const unlockedAchievements = achievements;
                    const premiumAchievements = Object.keys(ACHIEVEMENTS_SYSTEM.premiumAchievements);
                    const lockedAchievements = premiumAchievements.filter(a => !unlockedAchievements.includes(a));
                    
                    if (lockedAchievements.length > 0) {
                        html += `
                            <div class="mt-8 pt-6 border-t border-white/10">
                                <h4 class="font-bold mb-4 text-gray-400">Ø¥Ù†Ø¬Ø§Ø²Ø§Øª Ù‚Ø§Ø¯Ù…Ø©</h4>
                                <div class="space-y-3 opacity-60">
                        `;
                        
                        lockedAchievements.forEach(achievementName => {
                            const achievement = ACHIEVEMENTS_SYSTEM.premiumAchievements[achievementName];
                            if (achievement) {
                                html += `
                                    <div class="glass-card rounded-xl p-4 flex items-center gap-4">
                                        <span class="text-2xl">${achievement.icon}</span>
                                        <div class="flex-1">
                                            <h4 class="font-bold">${achievementName}</h4>
                                            <p class="text-sm text-gray-400">${achievement.description}</p>
                                        </div>
                                        <span class="text-gray-500">ğŸ”’</span>
                                    </div>
                                `;
                            }
                        });
                        
                        html += `</div></div>`;
                    }
                }
            }
            
            achievementsContent.innerHTML = html;
        }

        // ============================================
        // Page Rendering Functions
        // ============================================
        function renderHomePage() {
            // Update quote of the day
            const quoteOfDay = document.getElementById('quoteOfDay');
            const quoteAuthor = document.getElementById('quoteAuthor');
            
            if (appData.quotes.length > 0) {
                const today = new Date().getDate();
                const quoteIndex = today % appData.quotes.length;
                const randomQuote = appData.quotes[quoteIndex];
                quoteOfDay.textContent = `"${randomQuote.text}"`;
                quoteAuthor.textContent = `- ${randomQuote.author}`;
            }
            
            // Update stats
            updateStats();
            
            // Render popular content
            renderPopularContent();
            
            // Render latest ideas
            renderLatestIdeas();
            
            // Hide admin stats for regular users (already handled in updateUIAfterDataLoad)
        }

        function updateStats() {
            if (!currentUser) return;
            
            // User stats
            document.getElementById('userIdeasCount').textContent = currentUser.ideasCount || 0;
            document.getElementById('userCommentsCount').textContent = currentUser.commentsCount || 0;
            document.getElementById('userPoints').textContent = currentUser.points || 0;
            
            // Admin stats (only show for admin)
            if (currentUser.role === 'admin') {
                const totalIdeas = appData.ideas.length;
                const totalViews = appData.ideas.reduce((sum, idea) => sum + (idea.views || 0), 0);
                const totalMembers = appData.users.filter(u => u.role !== 'admin').length;
                const totalInteractions = appData.comments.length + 
                                        appData.ideas.reduce((sum, idea) => sum + (idea.likes || 0), 0);
                
                document.getElementById('totalIdeas').textContent = totalIdeas;
                document.getElementById('totalViews').textContent = totalViews;
                document.getElementById('totalMembers').textContent = totalMembers;
                document.getElementById('totalInteractions').textContent = totalInteractions;
            }
        }

        function renderPopularContent() {
            const popularContentGrid = document.getElementById('popularContentGrid');
            
            // Get most viewed ideas
            const popularIdeas = [...appData.ideas]
                .sort((a, b) => (b.views || 0) - (a.views || 0))
                .slice(0, 3);
            
            if (popularIdeas.length === 0) {
                popularContentGrid.innerHTML = `
                    <div class="glass-card rounded-xl p-6 text-center text-gray-400 col-span-3">
                        <p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø­ØªÙˆÙ‰ Ø´Ø§Ø¦Ø¹ Ø¨Ø¹Ø¯</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            popularIdeas.forEach((idea, index) => {
                const isTrending = index === 0;
                
                html += `
                    <div class="popular-content-card glass-card rounded-xl p-6 card-hover relative">
                        ${isTrending ? '<span class="trending-badge">ğŸ”¥</span>' : ''}
                        <div class="flex items-center gap-3 mb-4">
                            <span class="text-2xl">${CATEGORY_ICONS[idea.category] || 'ğŸ’¡'}</span>
                            <div class="flex-1">
                                <h4 class="font-bold line-clamp-1">${idea.title}</h4>
                                <p class="text-xs text-gray-400">${idea.authorName}</p>
                            </div>
                        </div>
                        <p class="text-sm text-gray-300 line-clamp-2 mb-4">${idea.content.substring(0, 100)}...</p>
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-gray-400">ğŸ‘ï¸ ${idea.views || 0}</span>
                            <button onclick="openIdeaDetailsModal('${idea.id}')" class="text-pink-400 hover:text-pink-300">
                                Ø§Ù‚Ø±Ø£ Ø§Ù„Ù…Ø²ÙŠØ¯
                            </button>
                        </div>
                    </div>
                `;
            });
            
            popularContentGrid.innerHTML = html;
        }

        function renderLatestIdeas() {
            const latestIdeasGrid = document.getElementById('latestIdeasGrid');
            
            const latestIdeas = [...appData.ideas]
                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
                .slice(0, 6);
            
            if (latestIdeas.length === 0) {
                latestIdeasGrid.innerHTML = `
                    <div class="glass-card rounded-xl p-6 text-center text-gray-400 col-span-3">
                        <p class="text-5xl mb-4">ğŸ’­</p>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙÙƒØ§Ø± Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</p>
                        <p class="text-sm mt-2">ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠØ´Ø§Ø±Ùƒ ÙÙƒØ±Ø©!</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            latestIdeas.forEach(idea => {
                html += `
                    <div class="glass-card rounded-xl p-6 card-hover">
                        <div class="flex justify-between items-start mb-3">
                            <span class="category-tag px-3 py-1 rounded-full text-sm">
                                ${CATEGORY_ICONS[idea.category] || 'ğŸ’¡'} ${idea.category}
                            </span>
                            <span class="text-xs text-gray-500">${new Date(idea.createdAt).toLocaleDateString('ar-EG')}</span>
                        </div>
                        <h4 class="font-bold mb-3 line-clamp-1">${idea.title}</h4>
                        <p class="text-sm text-gray-300 mb-4 line-clamp-2">${idea.content.substring(0, 80)}...</p>
                        <div class="flex justify-between items-center text-sm">
                            <div class="flex items-center gap-2">
                                <span class="text-gray-400">ğŸ‘¤ ${idea.authorName}</span>
                            </div>
                            <button onclick="openIdeaDetailsModal('${idea.id}')" class="text-pink-400 hover:text-pink-300">
                                Ø§Ù„ØªÙØ§ØµÙŠÙ„
                            </button>
                        </div>
                    </div>
                `;
            });
            
            latestIdeasGrid.innerHTML = html;
        }

        function renderIdeasPage() {
            const ideasGrid = document.getElementById('ideasGrid');
            
            let filteredIdeas = [...appData.ideas];
            if (currentFilter !== 'all') {
                filteredIdeas = filteredIdeas.filter(idea => idea.category === currentFilter);
            }
            
            filteredIdeas.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            if (filteredIdeas.length === 0) {
                ideasGrid.innerHTML = `
                    <div class="glass-card rounded-xl p-6 text-center text-gray-400 col-span-full">
                        <p class="text-5xl mb-4">ğŸ’­</p>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙÙƒØ§Ø± ${currentFilter !== 'all' ? 'ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ØªØµÙ†ÙŠÙ' : ''}</p>
                        <p class="text-sm mt-2">ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠØ´Ø§Ø±Ùƒ ÙÙƒØ±Ø©!</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            filteredIdeas.forEach(idea => {
                html += `
                    <div class="glass-card rounded-xl p-6 card-hover">
                        <div class="flex justify-between items-start mb-3">
                            <span class="category-tag px-3 py-1 rounded-full text-sm">
                                ${CATEGORY_ICONS[idea.category] || 'ğŸ’¡'} ${idea.category}
                            </span>
                            <span class="text-xs text-gray-500">${new Date(idea.createdAt).toLocaleDateString('ar-EG')}</span>
                        </div>
                        <h4 class="font-bold mb-3">${idea.title}</h4>
                        <p class="text-sm text-gray-300 mb-4 line-clamp-3">${idea.content.substring(0, 150)}...</p>
                        <div class="flex justify-between items-center text-sm">
                            <div class="flex items-center gap-4">
                                <span class="text-gray-400 flex items-center gap-1">
                                    ğŸ‘ï¸ ${idea.views || 0}
                                </span>
                                <span class="text-gray-400 flex items-center gap-1">
                                    ğŸ’¬ ${idea.commentsCount || 0}
                                </span>
                                <span class="text-gray-400 flex items-center gap-1">
                                    â¤ï¸ ${idea.likes || 0}
                                </span>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="text-gray-400 text-xs">ğŸ‘¤ ${idea.authorName}</span>
                                <button onclick="openIdeaDetailsModal('${idea.id}')" class="text-pink-400 hover:text-pink-300 text-sm">
                                    Ø§Ù„ØªÙØ§ØµÙŠÙ„
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            ideasGrid.innerHTML = html;
        }

        function filterIdeas(category) {
            currentFilter = category;
            
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.filter === category) {
                    btn.classList.add('active');
                }
            });
            
            renderIdeasPage();
        }

        // ============================================
        // Comment System
        // ============================================
        async function openIdeaDetailsModal(ideaId) {
            const idea = appData.ideas.find(i => i.id === ideaId);
            if (!idea) return;
            
            currentIdeaId = ideaId;
            
            // Increment views
            if (!viewedIdeas.has(ideaId)) {
                viewedIdeas.add(ideaId);
                await db.collection('ideas').doc(ideaId).update({
                    views: firebase.firestore.FieldValue.increment(1)
                });
                idea.views++;
            }
            
            // Set modal content
            document.getElementById('ideaDetailsTitle').textContent = idea.title;
            
            const detailsContent = document.getElementById('ideaDetailsContent');
            detailsContent.innerHTML = `
                <div class="glass-card rounded-xl p-6">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <span class="category-tag px-3 py-1 rounded-full text-sm">
                                ${CATEGORY_ICONS[idea.category] || 'ğŸ’¡'} ${idea.category}
                            </span>
                            <p class="text-sm text-gray-400 mt-2">
                                ${idea.authorName} â€¢ ${new Date(idea.createdAt).toLocaleDateString('ar-EG')}
                            </p>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="text-gray-400 text-sm flex items-center gap-1">
                                ğŸ‘ï¸ ${idea.views}
                            </span>
                            <span class="text-gray-400 text-sm flex items-center gap-1">
                                ğŸ’¬ ${idea.commentsCount || 0}
                            </span>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <h4 class="text-lg font-bold mb-3">ÙˆØµÙ Ø§Ù„ÙÙƒØ±Ø©</h4>
                        <p class="text-gray-300 leading-relaxed whitespace-pre-line">${idea.content}</p>
                    </div>
                    
                    <div class="flex justify-between items-center pt-4 border-t border-white/10">
                        <div class="flex items-center gap-4">
                            <button onclick="likeIdea('${ideaId}')" class="flex items-center gap-2 text-gray-400 hover:text-pink-400">
                                <span>â¤ï¸</span>
                                <span>${idea.likes || 0}</span>
                            </button>
                            ${currentUser.role === 'admin' ? `
                            <button onclick="deleteIdea('${ideaId}')" class="text-red-400 hover:text-red-300 text-sm">
                                Ø­Ø°Ù Ø§Ù„ÙÙƒØ±Ø©
                            </button>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
            
            // Load comments
            await loadCommentsForIdea(ideaId);
            
            openModal('ideaDetailsModal');
        }

        async function loadCommentsForIdea(ideaId) {
            const commentsList = document.getElementById('commentsList');
            const commentsCount = document.getElementById('commentsCount');
            
            const ideaComments = appData.comments
                .filter(c => c.ideaId === ideaId)
                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            commentsCount.textContent = ideaComments.length;
            
            if (ideaComments.length === 0) {
                commentsList.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <p class="text-lg mb-2">ğŸ’­</p>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø¨Ø¹Ø¯</p>
                        <p class="text-sm">ÙƒÙ† Ø£ÙˆÙ„ Ù…Ù† ÙŠØ¹Ù„Ù‚!</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            for (const comment of ideaComments) {
                const user = appData.users.find(u => u.id === comment.userId);
                const isAdmin = user?.role === 'admin';
                const isPremium = user?.role === 'premium';
                
                html += `
                    <div class="comment-bubble ${isAdmin ? 'border-r-4 border-yellow-500' : isPremium ? 'border-r-4 border-purple-500' : ''}">
                        <div class="flex justify-between items-start mb-2">
                            <div class="flex items-center gap-2">
                                <span class="text-lg">${isAdmin ? 'ğŸ‘‘' : isPremium ? 'ğŸ’¡' : 'ğŸ‘¤'}</span>
                                <span class="font-bold">${comment.userName}</span>
                                ${isAdmin ? '<span class="role-badge role-admin text-xs">Ù…Ø¯ÙŠØ±</span>' : ''}
                                ${isPremium ? '<span class="role-badge role-premium text-xs">Ù…Ù…ÙŠØ²</span>' : ''}
                            </div>
                            <span class="text-xs text-gray-500">${new Date(comment.createdAt).toLocaleString('ar-EG')}</span>
                        </div>
                        <p class="text-gray-300 mb-3 whitespace-pre-line">${comment.text}</p>
                        
                        <div class="comment-actions">
                            <button onclick="likeComment('${comment.id}')" class="comment-like-btn ${comment.likedBy && comment.likedBy.includes(currentUser.id) ? 'liked' : ''}">
                                <span>â¤ï¸</span>
                                <span>${comment.likes || 0}</span>
                            </button>
                            
                            <button onclick="replyToComment('${comment.id}')" class="text-blue-400 hover:text-blue-300 text-sm">
                                Ø±Ø¯
                            </button>
                            
                            ${currentUser.role === 'admin' || currentUser.id === comment.userId ? `
                            <button onclick="deleteComment('${comment.id}')" class="text-red-400 hover:text-red-300 text-sm mr-auto">
                                Ø­Ø°Ù
                            </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            }
            
            commentsList.innerHTML = html;
        }

        async function submitComment() {
            const text = document.getElementById('newCommentText').value.trim();
            
            if (!text) {
                showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù†Øµ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚', 'error');
                return;
            }
            
            if (!currentIdeaId) {
                showToast('Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ ÙÙƒØ±Ø©', 'error');
                return;
            }
            
            try {
                const commentData = {
                    text: text,
                    ideaId: currentIdeaId,
                    userId: currentUser.id,
                    userName: currentUser.name,
                    userRole: currentUser.role,
                    likes: 0,
                    likedBy: [],
                    replies: [],
                    createdAt: new Date().toISOString()
                };
                
                // Add comment to Firestore
                const docRef = await db.collection('comments').add(commentData);
                
                // Update idea's comments count
                await db.collection('ideas').doc(currentIdeaId).update({
                    commentsCount: firebase.firestore.FieldValue.increment(1)
                });
                
                // Update user's comments count
                await db.collection('users').doc(currentUser.id).update({
                    commentsCount: firebase.firestore.FieldValue.increment(1)
                });
                
                // Add points for comment
                await addUserPoints(currentUser.id, 5);
                
                // Check for achievements
                await checkAchievements(currentUser.id);
                
                // Clear comment textarea
                document.getElementById('newCommentText').value = '';
                
                // Reload comments
                await loadAllData();
                await loadCommentsForIdea(currentIdeaId);
                
                showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                
            } catch (error) {
                console.error('Error adding comment:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ‚', 'error');
            }
        }

        async function likeComment(commentId) {
            const comment = appData.comments.find(c => c.id === commentId);
            if (!comment) return;
            
            try {
                const commentRef = db.collection('comments').doc(commentId);
                
                if (comment.likedBy && comment.likedBy.includes(currentUser.id)) {
                    // Unlike
                    await commentRef.update({
                        likes: firebase.firestore.FieldValue.increment(-1),
                        likedBy: firebase.firestore.FieldValue.arrayRemove(currentUser.id)
                    });
                    comment.likes--;
                    if (comment.likedBy) {
                        comment.likedBy = comment.likedBy.filter(id => id !== currentUser.id);
                    }
                } else {
                    // Like
                    await commentRef.update({
                        likes: firebase.firestore.FieldValue.increment(1),
                        likedBy: firebase.firestore.FieldValue.arrayUnion(currentUser.id)
                    });
                    comment.likes = (comment.likes || 0) + 1;
                    if (!comment.likedBy) comment.likedBy = [];
                    comment.likedBy.push(currentUser.id);
                }
                
                // Reload comments
                await loadCommentsForIdea(currentIdeaId);
                
            } catch (error) {
                console.error('Error liking comment:', error);
            }
        }

        function replyToComment(commentId) {
            replyingToCommentId = commentId;
            const comment = appData.comments.find(c => c.id === commentId);
            if (comment) {
                document.getElementById('newCommentText').placeholder = `Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ ${comment.userName}...`;
                document.getElementById('newCommentText').focus();
            }
        }

        async function likeIdea(ideaId) {
            const idea = appData.ideas.find(i => i.id === ideaId);
            if (!idea) return;
            
            try {
                const ideaRef = db.collection('ideas').doc(ideaId);
                
                await ideaRef.update({
                    likes: firebase.firestore.FieldValue.increment(1)
                });
                
                idea.likes = (idea.likes || 0) + 1;
                
                showToast('ØªÙ… Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨ Ø¨Ø§Ù„ÙÙƒØ±Ø©!', 'success');
                
                await loadAllData();
                if (currentIdeaId === ideaId) {
                    await loadCommentsForIdea(ideaId);
                }
                
            } catch (error) {
                console.error('Error liking idea:', error);
            }
        }

        async function deleteIdea(ideaId) {
            if (currentUser.role !== 'admin') {
                showToast('Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ø­Ø°Ù Ø§Ù„Ø£ÙÙƒØ§Ø±', 'error');
                return;
            }
            
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„ÙÙƒØ±Ø©ØŸ')) return;
            
            try {
                await db.collection('ideas').doc(ideaId).delete();
                
                appData.ideas = appData.ideas.filter(i => i.id !== ideaId);
                
                closeModal('ideaDetailsModal');
                
                showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„ÙÙƒØ±Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                
                renderIdeasPage();
                
            } catch (error) {
                console.error('Error deleting idea:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„ÙÙƒØ±Ø©', 'error');
            }
        }

        async function deleteComment(commentId) {
            const comment = appData.comments.find(c => c.id === commentId);
            if (!comment) return;
            
            if (currentUser.role !== 'admin' && currentUser.id !== comment.userId) {
                showToast('Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚', 'error');
                return;
            }
            
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ØŸ')) return;
            
            try {
                await db.collection('comments').doc(commentId).delete();
                
                if (comment.ideaId) {
                    await db.collection('ideas').doc(comment.ideaId).update({
                        commentsCount: firebase.firestore.FieldValue.increment(-1)
                    });
                }
                
                showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                
                await loadAllData();
                if (currentIdeaId) {
                    await loadCommentsForIdea(currentIdeaId);
                }
                
            } catch (error) {
                console.error('Error deleting comment:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„ØªØ¹Ù„ÙŠÙ‚', 'error');
            }
        }

        // ============================================
        // Other Pages
        // ============================================
        function renderQuotesPage() {
            const quotesGrid = document.getElementById('quotesGrid');
            
            let quotesToShow = [...appData.quotes];
            
            if (quotesToShow.length === 0) {
                quotesGrid.innerHTML = `
                    <div class="glass-card rounded-xl p-6 text-center text-gray-400 col-span-full">
                        <p class="text-5xl mb-4">âœ¨</p>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ø¨Ø§Ø±Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</p>
                        <p class="text-sm mt-2">Ø£Ø¶Ù Ø£ÙˆÙ„ Ø¹Ø¨Ø§Ø±Ø© Ù…Ù„Ù‡Ù…Ø©!</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            quotesToShow.forEach(quote => {
                html += `
                    <div class="glass-card rounded-xl p-6 card-hover">
                        <div class="text-4xl mb-4">ğŸ’­</div>
                        <p class="text-lg font-amiri leading-relaxed mb-4">"${quote.text}"</p>
                        <div class="flex justify-between items-center pt-4 border-t border-white/10">
                            <span class="text-sm text-gray-400">${quote.author}</span>
                            ${quote.addedByName ? `
                                <span class="text-xs text-gray-500">Ø£Ø¶ÙŠÙØª Ø¨ÙˆØ§Ø³Ø·Ø© ${quote.addedByName}</span>
                            ` : ''}
                        </div>
                    </div>
                `;
            });
            
            quotesGrid.innerHTML = html;
        }

        function filterCourses(type) {
            currentCourseFilter = type;
            
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.filter === type) {
                    btn.classList.add('active');
                }
            });
            
            renderSkillsPage();
        }

        function renderSkillsPage() {
            const coursesGrid = document.getElementById('coursesGrid');
            
            let filteredCourses = [...appData.courses];
            if (currentCourseFilter !== 'all') {
                filteredCourses = filteredCourses.filter(course => course.type === currentCourseFilter);
            }
            
            filteredCourses.sort((a, b) => new Date(b.addedAt) - new Date(a.addedAt));
            
            if (filteredCourses.length === 0) {
                coursesGrid.innerHTML = `
                    <div class="course-card glass-card rounded-xl p-6 text-center text-gray-400 col-span-full">
                        <p class="text-5xl mb-4">ğŸš€</p>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ØµØ§Ø¯Ø± ØªØ¹Ù„ÙŠÙ…ÙŠØ© ${currentCourseFilter !== 'all' ? 'Ù…Ù† Ù‡Ø°Ø§ Ø§Ù„Ù†ÙˆØ¹' : ''}</p>
                        <p class="text-sm mt-2">Ø£Ø¶Ù Ø£ÙˆÙ„ Ù…ØµØ¯Ø± ØªØ¹Ù„ÙŠÙ…ÙŠ!</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            filteredCourses.forEach(course => {
                html += `
                    <div class="course-card glass-card rounded-xl p-6 card-hover">
                        <div class="flex items-center gap-3 mb-4">
                            <span class="text-3xl">${COURSE_ICONS[course.type] || 'ğŸ“š'}</span>
                            <div>
                                <h4 class="font-bold">${course.title}</h4>
                                <p class="text-xs text-gray-400">${course.type}</p>
                            </div>
                        </div>
                        
                        <p class="text-sm text-gray-300 mb-4 line-clamp-3">${course.description}</p>
                        
                        ${course.link ? `
                            <a href="${course.link}" target="_blank" class="text-blue-400 hover:text-blue-300 text-sm flex items-center gap-2 mb-4">
                                <span>ğŸ”—</span>
                                <span>Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ø±Ø§Ø¨Ø·</span>
                            </a>
                        ` : ''}
                        
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-gray-400">Ø£Ø¶ÙŠÙØª Ø¨ÙˆØ§Ø³Ø·Ø© ${course.addedByName}</span>
                            <span class="text-xs text-gray-500">${new Date(course.addedAt).toLocaleDateString('ar-EG')}</span>
                        </div>
                    </div>
                `;
            });
            
            coursesGrid.innerHTML = html;
        }

        function renderCommentsPage() {
            const commentsContent = document.getElementById('commentsPageContent');
            
            // Get all comments by current user
            const userComments = appData.comments
                .filter(c => c.userId === currentUser.id)
                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            if (userComments.length === 0) {
                commentsContent.innerHTML = `
                    <div class="glass-card rounded-2xl p-6 text-center text-gray-400">
                        <p class="text-5xl mb-4">ğŸ’¬</p>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø¨Ø¹Ø¯</p>
                        <p class="text-sm mt-2">Ø§Ø¨Ø¯Ø£ Ø¨Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ø£ÙÙƒØ§Ø±!</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            for (const comment of userComments) {
                const idea = appData.ideas.find(i => i.id === comment.ideaId);
                if (!idea) continue;
                
                html += `
                    <div class="glass-card rounded-xl p-6 mb-4">
                        <div class="flex justify-between items-start mb-3">
                            <div class="flex items-center gap-2">
                                <span class="text-lg">ğŸ’¡</span>
                                <h4 class="font-bold">${idea.title}</h4>
                            </div>
                            <span class="text-xs text-gray-500">${new Date(comment.createdAt).toLocaleString('ar-EG')}</span>
                        </div>
                        <p class="text-gray-300 mb-4 p-3 bg-white/5 rounded-lg">${comment.text}</p>
                        <div class="flex justify-between items-center text-sm">
                            <div class="flex items-center gap-4">
                                <span class="text-gray-400 flex items-center gap-1">
                                    â¤ï¸ ${comment.likes || 0}
                                </span>
                            </div>
                            <button onclick="openIdeaDetailsModal('${idea.id}')" class="text-pink-400 hover:text-pink-300">
                                Ø¹Ø±Ø¶ Ø§Ù„ÙÙƒØ±Ø©
                            </button>
                        </div>
                    </div>
                `;
            }
            
            commentsContent.innerHTML = html;
        }

        function renderLeaderboardPage() {
            const leaderboardContent = document.getElementById('leaderboardContent');
            
            // Sort users by points (exclude admins)
            const topUsers = [...appData.users]
                .filter(u => u.role !== 'admin')
                .sort((a, b) => (b.points || 0) - (a.points || 0))
                .slice(0, 20);
            
            if (topUsers.length === 0) {
                leaderboardContent.innerHTML = `
                    <div class="glass-card rounded-2xl p-6 text-center text-gray-400">
                        <p class="text-5xl mb-4">ğŸ†</p>
                        <p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø¹Ø¶Ø§Ø¡ Ø¨Ø¹Ø¯</p>
                    </div>
                `;
                return;
            }
            
            let html = `
                <div class="glass-card rounded-2xl p-6">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b border-white/10">
                                    <th class="text-right p-3">#</th>
                                    <th class="text-right p-3">Ø§Ù„Ø¹Ø¶Ùˆ</th>
                                    <th class="text-right p-3">Ø§Ù„Ù†Ù‚Ø§Ø·</th>
                                    <th class="text-right p-3">Ø§Ù„Ù…Ø³ØªÙˆÙ‰</th>
                                    <th class="text-right p-3">Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            topUsers.forEach((user, index) => {
                const levelInfo = ACHIEVEMENTS_SYSTEM.levels.find(l => l.level === user.level) || ACHIEVEMENTS_SYSTEM.levels[0];
                const achievements = user.achievements || [];
                
                html += `
                    <tr class="border-b border-white/5 hover:bg-white/5 ${user.id === currentUser.id ? 'bg-pink-500/10' : ''}">
                        <td class="p-3">
                            ${index < 3 ? ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'][index] : index + 1}
                        </td>
                        <td class="p-3">
                            <div class="flex items-center gap-3">
                                <span class="text-lg">${user.role === 'premium' ? 'ğŸ’¡' : 'ğŸ‘¤'}</span>
                                <div>
                                    <div class="font-bold">${user.name}</div>
                                    <div class="text-xs text-gray-400">${user.specialty}</div>
                                </div>
                            </div>
                        </td>
                        <td class="p-3">
                            <span class="font-bold ${levelInfo.color}">${user.points || 0}</span>
                        </td>
                        <td class="p-3">
                            <div class="flex items-center gap-2">
                                <span class="${levelInfo.color}">${levelInfo.name}</span>
                                <span class="text-xs text-gray-400">(${user.level})</span>
                            </div>
                        </td>
                        <td class="p-3">
                            <div class="flex gap-1 flex-wrap">
                                ${achievements.slice(0, 3).map(achievement => {
                                    const badge = ACHIEVEMENTS_SYSTEM.badges[achievement] || ACHIEVEMENTS_SYSTEM.premiumAchievements[achievement];
                                    return badge ? `<span title="${badge.description}">${badge.icon}</span>` : '';
                                }).join('')}
                                ${achievements.length > 3 ? `<span class="text-xs text-gray-400">+${achievements.length - 3}</span>` : ''}
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            leaderboardContent.innerHTML = html;
        }

        function renderMembersPage() {
            const membersContent = document.getElementById('membersContent');
            
            const allUsers = [...appData.users]
                .filter(u => u.role !== 'admin')
                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            if (allUsers.length === 0) {
                membersContent.innerHTML = `
                    <div class="glass-card rounded-2xl p-6 text-center text-gray-400">
                        <p class="text-5xl mb-4">ğŸ‘¥</p>
                        <p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø¹Ø¶Ø§Ø¡ Ø¨Ø¹Ø¯</p>
                    </div>
                `;
                return;
            }
            
            let html = `
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            `;
            
            allUsers.forEach(user => {
                const levelInfo = ACHIEVEMENTS_SYSTEM.levels.find(l => l.level === user.level) || ACHIEVEMENTS_SYSTEM.levels[0];
                const achievements = user.achievements || [];
                
                html += `
                    <div class="glass-card rounded-xl p-6 ${user.id === currentUser.id ? 'border-2 border-pink-500' : ''}">
                        <div class="flex items-center gap-3 mb-4">
                            <div class="w-12 h-12 rounded-full ${user.role === 'premium' ? 'bg-gradient-to-br from-purple-500 to-pink-600' : 'bg-gradient-to-br from-blue-500 to-teal-600'} flex items-center justify-center text-white text-xl">
                                ${user.role === 'premium' ? 'ğŸ’¡' : 'ğŸ‘¤'}
                            </div>
                            <div class="flex-1">
                                <h4 class="font-bold">${user.name}</h4>
                                <p class="text-sm text-gray-400">${user.specialty}</p>
                            </div>
                        </div>
                        
                        <div class="space-y-3">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-400">Ø§Ù„Ù…Ø³ØªÙˆÙ‰</span>
                                <span class="${levelInfo.color} font-bold">${levelInfo.name}</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-400">Ø§Ù„Ù†Ù‚Ø§Ø·</span>
                                <span class="font-bold">${user.points || 0}</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-400">Ø§Ù„Ø£ÙÙƒØ§Ø±</span>
                                <span>${user.ideasCount || 0}</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-400">Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª</span>
                                <span>${user.commentsCount || 0}</span>
                            </div>
                        </div>
                        
                        ${achievements.length > 0 ? `
                            <div class="pt-4 mt-4 border-t border-white/10">
                                <p class="text-sm text-gray-400 mb-2">Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª</p>
                                <div class="flex gap-2 flex-wrap">
                                    ${achievements.slice(0, 5).map(achievement => {
                                        const badge = ACHIEVEMENTS_SYSTEM.badges[achievement] || ACHIEVEMENTS_SYSTEM.premiumAchievements[achievement];
                                        return badge ? `
                                            <div class="text-xs bg-white/10 px-2 py-1 rounded-lg flex items-center gap-1" title="${badge.description}">
                                                ${badge.icon} ${achievement}
                                            </div>
                                        ` : '';
                                    }).join('')}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            
            html += `</div>`;
            membersContent.innerHTML = html;
        }

        function renderMessagesPage() {
            const messagesContent = document.getElementById('messagesContent');
            
            if (currentUser.role !== 'admin') {
                messagesContent.innerHTML = `
                    <div class="glass-card rounded-2xl p-6 text-center text-gray-400">
                        <p class="text-5xl mb-4">ğŸš«</p>
                        <p>Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©</p>
                    </div>
                `;
                return;
            }
            
            const messages = [...appData.messages]
                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            if (messages.length === 0) {
                messagesContent.innerHTML = `
                    <div class="glass-card rounded-2xl p-6 text-center text-gray-400">
                        <p class="text-5xl mb-4">ğŸ“¨</p>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„ Ø¨Ø¹Ø¯</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            messages.forEach(message => {
                const isUnread = !message.isRead;
                
                html += `
                    <div class="glass-card rounded-xl p-6 mb-4 ${isUnread ? 'border-r-4 border-blue-500' : ''}">
                        <div class="flex justify-between items-start mb-3">
                            <div>
                                <h4 class="font-bold">${message.title}</h4>
                                <p class="text-sm text-gray-400">Ù…Ù†: ${message.fromUserName} (${message.fromUserRole})</p>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="text-xs px-2 py-1 rounded-full ${message.type === 'Ø·Ù„Ø¨ Ø±Ù…Ø² ØªØ±Ù‚ÙŠØ©' ? 'bg-purple-500/20 text-purple-400' : 'bg-blue-500/20 text-blue-400'}">
                                    ${message.type}
                                </span>
                                <span class="text-xs text-gray-500">${new Date(message.createdAt).toLocaleString('ar-EG')}</span>
                            </div>
                        </div>
                        
                        <p class="text-gray-300 mb-4 p-3 bg-white/5 rounded-lg whitespace-pre-line">${message.content}</p>
                        
                        <div class="flex justify-between items-center">
                            <div class="flex gap-2">
                                ${message.type === 'Ø·Ù„Ø¨ Ø±Ù…Ø² ØªØ±Ù‚ÙŠØ©' ? `
                                    <button onclick="generateCodeForUser('${message.fromUserId}', '${message.fromUserName}')" class="text-xs bg-purple-500/20 text-purple-400 px-3 py-1 rounded-full hover:bg-purple-500/30">
                                        Ø¥Ù†Ø´Ø§Ø¡ Ø±Ù…Ø² ØªØ±Ù‚ÙŠØ©
                                    </button>
                                ` : ''}
                                <button onclick="markMessageAsRead('${message.id}')" class="text-xs bg-blue-500/20 text-blue-400 px-3 py-1 rounded-full hover:bg-blue-500/30">
                                    ${isUnread ? 'ØªØ­Ø¯ÙŠØ¯ ÙƒÙ…Ù‚Ø±ÙˆØ¡' : 'Ù…Ù‚Ø±ÙˆØ¡'}
                                </button>
                                <button onclick="deleteMessage('${message.id}')" class="text-xs bg-red-500/20 text-red-400 px-3 py-1 rounded-full hover:bg-red-500/30">
                                    Ø­Ø°Ù
                                </button>
                            </div>
                            ${isUnread ? '<span class="text-xs text-blue-400 animate-pulse">Ø¬Ø¯ÙŠØ¯</span>' : ''}
                        </div>
                    </div>
                `;
            });
            
            messagesContent.innerHTML = html;
        }

        function renderCodesPage() {
            const codesContent = document.getElementById('codesContent');
            
            if (currentUser.role !== 'admin') {
                codesContent.innerHTML = `
                    <div class="glass-card rounded-2xl p-6 text-center text-gray-400">
                        <p class="text-5xl mb-4">ğŸš«</p>
                        <p>Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©</p>
                    </div>
                `;
                return;
            }
            
            const codes = [...appData.codes]
                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            
            let html = `
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold">Ø±Ù…ÙˆØ² Ø§Ù„ØªØ±Ù‚ÙŠØ©</h3>
                    <button onclick="generateNewCode()" class="btn-primary">
                        + Ø¥Ù†Ø´Ø§Ø¡ Ø±Ù…Ø² Ø¬Ø¯ÙŠØ¯
                    </button>
                </div>
            `;
            
            if (codes.length === 0) {
                html += `
                    <div class="glass-card rounded-2xl p-6 text-center text-gray-400">
                        <p class="text-5xl mb-4">ğŸ”‘</p>
                        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ù…ÙˆØ² ØªØ±Ù‚ÙŠØ©</p>
                    </div>
                `;
            } else {
                html += `
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                `;
                
                codes.forEach(code => {
                    const usedByUser = code.usedBy ? appData.users.find(u => u.id === code.usedBy) : null;
                    
                    html += `
                        <div class="glass-card rounded-xl p-6">
                            <div class="flex justify-between items-start mb-3">
                                <div>
                                    <h4 class="font-bold font-mono">${code.code}</h4>
                                    <p class="text-sm text-gray-400">${code.type === 'premium' ? 'ØªØ±Ù‚ÙŠØ© Ù…Ù…ÙŠØ²Ø©' : 'ØªØ±Ù‚ÙŠØ© Ø¹Ø§Ø¯ÙŠØ©'}</p>
                                </div>
                                <span class="text-xs px-2 py-1 rounded-full ${code.used ? 'bg-red-500/20 text-red-400' : 'bg-green-500/20 text-green-400'}">
                                    ${code.used ? 'Ù…Ø³ØªØ®Ø¯Ù…' : 'Ù†Ø´Ø·'}
                                </span>
                            </div>
                            
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-400">Ø£Ù†Ø´Ø¦ Ø¨ÙˆØ§Ø³Ø·Ø©:</span>
                                    <span>${code.createdBy || 'Ù…Ø¯ÙŠØ±'}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-400">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡:</span>
                                    <span>${new Date(code.createdAt).toLocaleDateString('ar-EG')}</span>
                                </div>
                                ${code.used ? `
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">Ø§Ø³ØªØ®Ø¯Ù… Ø¨ÙˆØ§Ø³Ø·Ø©:</span>
                                        <span>${usedByUser ? usedByUser.name : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-400">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:</span>
                                        <span>${new Date(code.usedAt).toLocaleDateString('ar-EG')}</span>
                                    </div>
                                ` : ''}
                            </div>
                            
                            <div class="flex gap-2 mt-4">
                                ${!code.used ? `
                                    <button onclick="copyCode('${code.code}')" class="text-xs bg-blue-500/20 text-blue-400 px-3 py-1 rounded-full hover:bg-blue-500/30 flex-1">
                                        Ù†Ø³Ø® Ø§Ù„Ø±Ù…Ø²
                                    </button>
                                ` : ''}
                                <button onclick="deleteCode('${code.id}')" class="text-xs bg-red-500/20 text-red-400 px-3 py-1 rounded-full hover:bg-red-500/30">
                                    Ø­Ø°Ù
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                html += `</div>`;
            }
            
            codesContent.innerHTML = html;
        }

        function renderSuggestionsPage() {
            const suggestionsContent = document.getElementById('suggestionsContent');
            
            let html = `
                <div class="glass-card rounded-2xl p-6 mb-6">
                    <h3 class="text-lg font-bold mb-4">Ø´Ø§Ø±ÙƒÙ†Ø§ Ø§Ù‚ØªØ±Ø§Ø­Ø§ØªÙƒ ğŸ’­</h3>
                    <p class="text-gray-300 mb-4">
                        Ù†Ø­Ù† Ù†Ù‚Ø¯Ù‘Ø± Ø¢Ø±Ø§Ø¦Ùƒ ÙˆØ§Ù‚ØªØ±Ø§Ø­Ø§ØªÙƒ Ù„ØªØ·ÙˆÙŠØ± Ù…ØªØ­Ù Ø§Ù„ÙÙƒØ±. Ø´Ø§Ø±ÙƒÙ†Ø§ Ø£ÙÙƒØ§Ø±Ùƒ Ù„ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªØ¬Ø±Ø¨Ø©!
                    </p>
                    <button onclick="openMessageAdminModal()" class="btn-primary">
                        Ø¥Ø±Ø³Ø§Ù„ Ø§Ù‚ØªØ±Ø§Ø­
                    </button>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="glass-card rounded-xl p-6">
                        <div class="text-3xl mb-4 text-center">ğŸ“ˆ</div>
                        <h4 class="font-bold mb-2">Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¹Ø§Ù…</h4>
                        <p class="text-sm text-gray-400 mb-4">ÙƒÙŠÙ ØªÙ‚ÙŠÙ… ØªØ¬Ø±Ø¨ØªÙƒ ÙÙŠ Ù…ØªØ­Ù Ø§Ù„ÙÙƒØ±ØŸ</p>
                        <div class="flex justify-center gap-1 mb-4">
                            ${[1,2,3,4,5].map(star => `
                                <button onclick="rateApp(${star})" class="text-2xl hover:text-yellow-400">â˜†</button>
                            `).join('')}
                        </div>
                        <p id="ratingMessage" class="text-center text-sm text-gray-400"></p>
                    </div>
                    
                    <div class="glass-card rounded-xl p-6">
                        <div class="text-3xl mb-4 text-center">ğŸ’¡</div>
                        <h4 class="font-bold mb-2">Ø§Ù„Ø£ÙÙƒØ§Ø± Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</h4>
                        <ul class="space-y-2 text-sm text-gray-300">
                            <li class="flex items-center gap-2">âœ“ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø¯Ø§Ù„ÙŠØ§Øª ÙˆØ§Ù„Ù…Ø³ØªÙˆÙŠØ§Øª</li>
                            <li class="flex items-center gap-2">âœ“ Ù„ÙˆØ­Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ†</li>
                            <li class="flex items-center gap-2">â—‹ Ø¯Ø±Ø¯Ø´Ø© Ø¬Ù…Ø§Ø¹ÙŠØ©</li>
                            <li class="flex items-center gap-2">â—‹ Ù…Ø¤ØªÙ…Ø±Ø§Øª ØµÙˆØªÙŠØ©</li>
                            <li class="flex items-center gap-2">â—‹ ØªØ­Ø¯ÙŠ Ø§Ù„Ø£ÙÙƒØ§Ø± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ</li>
                        </ul>
                    </div>
                </div>
            `;
            
            suggestionsContent.innerHTML = html;
        }

        function renderSettingsPage() {
            // Populate settings fields with current user data
            if (currentUser) {
                document.getElementById('settingsName').value = currentUser.name;
                document.getElementById('settingsSpecialty').value = currentUser.specialty;
            }
        }

        // ============================================
        // Additional Admin Functions
        // ============================================
        async function generateNewCode() {
            if (currentUser.role !== 'admin') return;
            
            try {
                // Generate random code
                const code = 'MUF' + Math.random().toString(36).substring(2, 8).toUpperCase();
                
                const codeData = {
                    code: code,
                    type: 'premium',
                    createdBy: currentUser.name,
                    createdAt: new Date().toISOString(),
                    used: false,
                    usedBy: null,
                    usedAt: null
                };
                
                await db.collection('codes').doc(code).set(codeData);
                
                showToast('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø±Ù…Ø² Ø§Ù„ØªØ±Ù‚ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                await loadAllData();
                
            } catch (error) {
                console.error('Error generating code:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ù…Ø²', 'error');
            }
        }

        async function generateCodeForUser(userId, userName) {
            if (currentUser.role !== 'admin') return;
            
            try {
                const code = 'USER' + Math.random().toString(36).substring(2, 6).toUpperCase();
                
                const codeData = {
                    code: code,
                    type: 'premium',
                    createdBy: currentUser.name,
                    createdAt: new Date().toISOString(),
                    used: false,
                    usedBy: null,
                    usedAt: null,
                    forUser: userId
                };
                
                await db.collection('codes').doc(code).set(codeData);
                
                showToast(`ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø±Ù…Ø² Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… ${userName}`, 'success');
                await loadAllData();
                
            } catch (error) {
                console.error('Error generating code for user:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ù…Ø²', 'error');
            }
        }

        async function markMessageAsRead(messageId) {
            try {
                await db.collection('messages').doc(messageId).update({
                    isRead: true
                });
                
                showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø©', 'success');
                await loadAllData();
                
            } catch (error) {
                console.error('Error marking message as read:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±Ø³Ø§Ù„Ø©', 'error');
            }
        }

        async function deleteMessage(messageId) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø©ØŸ')) return;
            
            try {
                await db.collection('messages').doc(messageId).delete();
                
                showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ù„Ø©', 'success');
                await loadAllData();
                
            } catch (error) {
                console.error('Error deleting message:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ù„Ø©', 'error');
            }
        }

        async function deleteCode(codeId) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø±Ù…Ø²ØŸ')) return;
            
            try {
                await db.collection('codes').doc(codeId).delete();
                
                showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø±Ù…Ø²', 'success');
                await loadAllData();
                
            } catch (error) {
                console.error('Error deleting code:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø­Ø°Ù Ø§Ù„Ø±Ù…Ø²', 'error');
            }
        }

        function copyCode(code) {
            navigator.clipboard.writeText(code).then(() => {
                showToast('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ù…Ø²', 'success');
            }).catch(() => {
                showToast('Ø®Ø·Ø£ ÙÙŠ Ù†Ø³Ø® Ø§Ù„Ø±Ù…Ø²', 'error');
            });
        }

        function rateApp(rating) {
            // Update stars display
            const stars = document.querySelectorAll('#suggestionsPage .flex.justify-center button');
            stars.forEach((star, index) => {
                star.textContent = index < rating ? 'â˜…' : 'â˜†';
                star.className = index < rating ? 'text-2xl text-yellow-400' : 'text-2xl hover:text-yellow-400';
            });
            
            const messages = [
                'Ø´ÙƒØ±Ø§Ù‹ Ù„ØªÙ‚ÙŠÙŠÙ…Ùƒ!',
                'Ù†Ø­Ù† Ù†Ø³Ø¹Ù‰ Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ù„Ù„Ø£ÙØ¶Ù„!',
                'Ø±Ø§Ø¦Ø¹! Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ!',
                'Ù…Ø°Ù‡Ù„! Ù‡Ø°Ø§ ÙŠØ´Ø¬Ø¹Ù†Ø§!',
                'Ù…Ù…ØªØ§Ø²! Ø´ÙƒØ±Ø§Ù‹ Ù„Ø¯Ø¹Ù…Ùƒ!'
            ];
            
            document.getElementById('ratingMessage').textContent = messages[rating - 1];
            
            // Save rating
            localStorage.setItem('muf_rating', rating);
        }

        async function saveSettings() {
            const name = document.getElementById('settingsName').value.trim();
            const specialty = document.getElementById('settingsSpecialty').value.trim();
            
            if (!name || !specialty) {
                showToast('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', 'error');
                return;
            }
            
            try {
                await db.collection('users').doc(currentUser.id).update({
                    name: name,
                    specialty: specialty
                });
                
                // Update current user
                currentUser.name = name;
                currentUser.specialty = specialty;
                
                // Update localStorage
                localStorage.setItem('muf_user', JSON.stringify(currentUser));
                
                // Update UI
                updateUIAfterDataLoad();
                
                showToast('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
                
            } catch (error) {
                console.error('Error saving settings:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª', 'error');
            }
        }

        // ============================================
        // Utility Functions
        // ============================================
        function renderQuotes() {
            // This function initializes quotes on the home page
            const quoteElement = document.getElementById('quoteOfDay');
            const authorElement = document.getElementById('quoteAuthor');
            
            if (quoteElement && authorElement && appData.quotes && appData.quotes.length > 0) {
                const today = new Date().getDate();
                const quoteIndex = today % appData.quotes.length;
                const quote = appData.quotes[quoteIndex];
                
                quoteElement.textContent = `"${quote.text}"`;
                authorElement.textContent = `- ${quote.author}`;
            }
        }

        // ============================================
        // Toast Function
        // ============================================
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');
            
            const toast = document.createElement('div');
            toast.className = `toast glass-card rounded-xl p-4 shadow-lg border-r-4 ${
                type === 'success' ? 'border-green-500' :
                type === 'error' ? 'border-red-500' :
                type === 'warning' ? 'border-yellow-500' : 'border-blue-500'
            }`;
            
            const icon = type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : type === 'warning' ? 'âš ï¸' : 'â„¹ï¸';
            
            toast.innerHTML = `
                <div class="flex items-center gap-3">
                    <span class="text-xl">${icon}</span>
                    <p class="flex-1">${message}</p>
                </div>
            `;
            
            toastContainer.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateY(10px)';
                setTimeout(() => {
                    toastContainer.removeChild(toast);
                }, 300);
            }, 5000);
        }

        // ============================================
        // Initialize on Load
        // ============================================
        window.onload = initApp;

        // Export functions to global scope
        window.switchAuthTab = switchAuthTab;
        window.toggleEmailMode = toggleEmailMode;
        window.handleTraditionalLogin = handleTraditionalLogin;
        window.handleEmailAuth = handleEmailAuth;
        window.handleGoogleLogin = handleGoogleLogin;
        window.handleLogout = handleLogout;
        window.navigateTo = navigateTo;
        window.toggleSidebar = toggleSidebar;
        window.openAddIdeaModal = openAddIdeaModal;
        window.openAddQuoteModal = openAddQuoteModal;
        window.openAddCourseModal = openAddCourseModal;
        window.openMessageAdminModal = openMessageAdminModal;
        window.openRequestCodeModal = openRequestCodeModal;
        window.openAchievementsModal = openAchievementsModal;
        window.submitNewIdea = submitNewIdea;
        window.submitNewQuote = submitNewQuote;
        window.submitNewCourse = submitNewCourse;
        window.sendMessageToAdmin = sendMessageToAdmin;
        window.openIdeaDetailsModal = openIdeaDetailsModal;
        window.submitComment = submitComment;
        window.likeComment = likeComment;
        window.replyToComment = replyToComment;
        window.likeIdea = likeIdea;
        window.deleteIdea = deleteIdea;
        window.deleteComment = deleteComment;
        window.filterIdeas = filterIdeas;
        window.filterCourses = filterCourses;
        window.generateNewCode = generateNewCode;
        window.generateCodeForUser = generateCodeForUser;
        window.markMessageAsRead = markMessageAsRead;
        window.deleteMessage = deleteMessage;
        window.deleteCode = deleteCode;
        window.copyCode = copyCode;
        window.rateApp = rateApp;
        window.saveSettings = saveSettings;

    </script>
</body>
</html>