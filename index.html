<!doctype html>
<html lang="ar" dir="rtl" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ØªØ­Ù Ø§Ù„ÙÙƒØ± - Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ Ø§Ù„ÙÙƒØ±ÙŠ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&amp;family=Amiri:wght@400;700&amp;display=swap" rel="stylesheet">
    <style>
        /* Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ */
        body {
            box-sizing: border-box;
            font-family: 'Tajawal', sans-serif;
        }
        
        .font-amiri {
            font-family: 'Amiri', serif;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(233, 69, 96, 0.4); }
            50% { box-shadow: 0 0 40px rgba(233, 69, 96, 0.7); }
        }
        
        @keyframes gradient-shift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-float {
            animation: float 3s ease-in-out infinite;
        }
        
        .animate-pulse-glow {
            animation: pulse-glow 2s ease-in-out infinite;
        }
        
        .animate-gradient {
            background-size: 200% 200%;
            animation: gradient-shift 8s ease infinite;
        }
        
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
        
        .animate-rotate-slow {
            animation: rotate-slow 20s linear infinite;
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .glass-dark {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 25%, #312e81 50%, #4c1d95 75%, #581c87 100%);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #e94560, #f472b6, #fb923c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #e94560, #f472b6);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #ff5577, #f896d8);
            transform: scale(1.05);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .btn-google {
            background: #ffffff;
            color: #757575;
            border: 1px solid #dadce0;
            transition: all 0.3s ease;
        }
        
        .btn-google:hover {
            background: #f8f9fa;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .input-style {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .input-style:focus {
            background: rgba(255, 255, 255, 0.15);
            border-color: #e94560;
            outline: none;
            box-shadow: 0 0 0 3px rgba(233, 69, 96, 0.3);
        }
        
        .divider {
            display: flex;
            align-items: center;
            text-align: center;
            margin: 20px 0;
        }
        
        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .divider-text {
            padding: 0 15px;
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.9rem;
        }
        
        .auth-tab {
            padding: 10px 20px;
            border-radius: 10px 10px 0 0;
            background: rgba(255, 255, 255, 0.05);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .auth-tab.active {
            background: rgba(233, 69, 96, 0.2);
            border-bottom: 2px solid #e94560;
        }
        
        .auth-tab:hover:not(.active) {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .logo-glow {
            filter: drop-shadow(0 0 20px rgba(233, 69, 96, 0.6)) drop-shadow(0 0 40px rgba(251, 191, 36, 0.4));
        }
        
        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: #e94560;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .toast {
            animation: fade-in 0.3s ease-out;
        }
    </style>
</head>
<body class="h-full w-full gradient-bg text-white overflow-hidden">
    
    <!-- Login Screen -->
    <div id="loginScreen" class="h-full w-full flex items-center justify-center p-4 overflow-auto">
        <div class="glass-card rounded-3xl p-8 w-full max-w-md animate-fade-in">
            <div class="text-center mb-8">
                <!-- Logo -->
                <div class="mb-6 flex justify-center logo-container">
                    <svg width="140" height="140" viewbox="0 0 140 140" xmlns="http://www.w3.org/2000/svg" class="logo-glow animate-float">
                        <!-- SVG Logo Content -->
                        <defs>
                            <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#0f172a;stop-opacity:1" />
                                <stop offset="30%" style="stop-color:#e94560;stop-opacity:0.9" />
                                <stop offset="70%" style="stop-color:#f472b6;stop-opacity:0.9" />
                                <stop offset="100%" style="stop-color:#fbbf24;stop-opacity:1" />
                            </linearGradient>
                            <linearGradient id="goldGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                                <stop offset="0%" style="stop-color:#fbbf24;stop-opacity:1" />
                                <stop offset="50%" style="stop-color:#fcd34d;stop-opacity:1" />
                                <stop offset="100%" style="stop-color:#fbbf24;stop-opacity:1" />
                            </linearGradient>
                            <filter id="glow">
                                <feGaussianBlur stdDeviation="2" result="coloredBlur" />
                                <feMerge>
                                    <feMergeNode in="coloredBlur" />
                                    <feMergeNode in="SourceGraphic" />
                                </feMerge>
                            </filter>
                            <radialGradient id="glassGradient">
                                <stop offset="0%" style="stop-color:#ffffff;stop-opacity:0.3" />
                                <stop offset="100%" style="stop-color:#ffffff;stop-opacity:0.05" />
                            </radialGradient>
                        </defs>
                        
                        <circle cx="70" cy="70" r="65" fill="none" stroke="url(#logoGradient)" stroke-width="1.5" opacity="0.4" class="animate-rotate-slow" />
                        <circle cx="70" cy="70" r="58" fill="url(#glassGradient)" filter="url(#glow)" />
                        <circle cx="70" cy="70" r="58" fill="none" stroke="url(#logoGradient)" stroke-width="3" />
                        
                        <!-- Museum and Brain Icons -->
                        <g transform="translate(35, 80)">
                            <rect x="5" y="5" width="6" height="30" fill="#e94560" opacity="0.9" />
                            <rect x="17" y="5" width="6" height="30" fill="#e94560" opacity="0.9" />
                            <rect x="29" y="5" width="6" height="30" fill="#e94560" opacity="0.9" />
                            <rect x="41" y="5" width="6" height="30" fill="#e94560" opacity="0.9" />
                            <rect x="53" y="5" width="6" height="30" fill="#e94560" opacity="0.9" />
                            <rect x="65" y="5" width="6" height="30" fill="#e94560" opacity="0.9" />
                            
                            <polygon points="37.5,-8 -2,5 77,5" fill="url(#goldGradient)" filter="url(#glow)" />
                            <line x1="-2" y1="5" x2="77" y2="5" stroke="#fbbf24" stroke-width="2" />
                            <rect x="0" y="35" width="75" height="6" fill="url(#goldGradient)" opacity="0.9" />
                        </g>
                        
                        <g transform="translate(70, 42)">
                            <ellipse cx="0" cy="0" rx="22" ry="18" fill="#f472b6" opacity="0.95" filter="url(#glow)" />
                            <path d="M-10,-8 Q-15,-11 -13,-16 Q-10,-18 -5,-16 Q0,-20 5,-16 Q10,-18 13,-16 Q15,-11 10,-8" fill="none" stroke="#fbbf24" stroke-width="2.5" opacity="0.9" filter="url(#glow)" />
                            
                            <circle cx="-8" cy="-3" r="2.5" fill="#fbbf24" opacity="0.95" />
                            <circle cx="8" cy="-3" r="2.5" fill="#fbbf24" opacity="0.95" />
                            <circle cx="0" cy="4" r="2.5" fill="#fbbf24" opacity="0.95" />
                            <circle cx="-4" cy="8" r="1.5" fill="#fcd34d" opacity="0.9" />
                            <circle cx="4" cy="8" r="1.5" fill="#fcd34d" opacity="0.9" />
                            
                            <line x1="-8" y1="-3" x2="0" y2="4" stroke="#fbbf24" stroke-width="1.5" opacity="0.6" />
                            <line x1="8" y1="-3" x2="0" y2="4" stroke="#fbbf24" stroke-width="1.5" opacity="0.6" />
                        </g>
                    </svg>
                </div>
                
                <h1 class="text-3xl font-bold gradient-text font-amiri mb-3">Ù…ØªØ­Ù Ø§Ù„ÙÙƒØ±</h1>
                <p class="text-gray-400 text-sm mb-4">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ Ø§Ù„ÙÙƒØ±ÙŠ Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</p>
            </div>
            
            <!-- Tabs for Authentication Methods -->
            <div class="flex mb-6 border-b border-white/10">
                <div class="auth-tab active" onclick="switchAuthTab('traditional')" id="tabTraditional">
                    <span>ğŸ‘¤ Ø¯Ø®ÙˆÙ„ ØªÙ‚Ù„ÙŠØ¯ÙŠ</span>
                </div>
                <div class="auth-tab" onclick="switchAuthTab('email')" id="tabEmail">
                    <span>ğŸ“§ Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</span>
                </div>
            </div>
            
            <!-- Traditional Login Form -->
            <div id="traditionalLogin" class="auth-form">
                <div class="space-y-4">
                    <div>
                        <label for="loginName" class="block text-sm text-gray-300 mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                        <input type="text" id="loginName" class="input-style w-full px-4 py-3 rounded-xl text-white placeholder-gray-400" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ">
                    </div>
                    
                    <div>
                        <label for="loginSpecialty" class="block text-sm text-gray-300 mb-2">Ø§Ù„ØªØ®ØµØµ / Ø±Ù…Ø² Ø§Ù„ØªØ±Ù‚ÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                        <input type="text" id="loginSpecialty" class="input-style w-full px-4 py-3 rounded-xl text-white placeholder-gray-400" placeholder="Ø£Ø¯Ø®Ù„ ØªØ®ØµØµÙƒ Ø£Ùˆ Ø±Ù…Ø² Ø§Ù„ØªØ±Ù‚ÙŠØ©">
                    </div>
                    
                    <button onclick="handleTraditionalLogin()" class="btn-primary w-full py-3 rounded-xl text-white font-bold mt-6">
                        <span id="traditionalLoginBtnText">ğŸš€ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…ØªØ­Ù</span>
                        <div id="traditionalLoginSpinner" class="loading-spinner hidden mx-auto"></div>
                    </button>
                </div>
            </div>
            
            <!-- Email Login/Register Form -->
            <div id="emailLogin" class="auth-form hidden">
                <div class="space-y-4">
                    <div id="emailLoginFields">
                        <div class="mb-4">
                            <label for="loginEmail" class="block text-sm text-gray-300 mb-2">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                            <input type="email" id="loginEmail" class="input-style w-full px-4 py-3 rounded-xl text-white placeholder-gray-400" placeholder="example@email.com">
                        </div>
                        
                        <div>
                            <label for="loginPassword" class="block text-sm text-gray-300 mb-2">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                            <input type="password" id="loginPassword" class="input-style w-full px-4 py-3 rounded-xl text-white placeholder-gray-400" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                        </div>
                        
                        <div class="mt-2 text-right">
                            <button onclick="toggleEmailMode()" class="text-pink-400 hover:text-pink-300 text-sm">
                                <span id="emailToggleText">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</span>
                            </button>
                        </div>
                    </div>
                    
                    <div id="registerFields" class="hidden">
                        <div class="mb-4">
                            <label for="registerName" class="block text-sm text-gray-300 mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                            <input type="text" id="registerName" class="input-style w-full px-4 py-3 rounded-xl text-white placeholder-gray-400" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø°ÙŠ Ø³ÙŠØ¸Ù‡Ø±">
                        </div>
                        
                        <div class="mb-4">
                            <label for="registerSpecialty" class="block text-sm text-gray-300 mb-2">Ø§Ù„ØªØ®ØµØµ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                            <input type="text" id="registerSpecialty" class="input-style w-full px-4 py-3 rounded-xl text-white placeholder-gray-400" placeholder="ØªØ®ØµØµÙƒ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ">
                        </div>
                    </div>
                    
                    <button onclick="handleEmailAuth()" class="btn-primary w-full py-3 rounded-xl text-white font-bold mt-2">
                        <span id="emailAuthBtnText">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</span>
                        <div id="emailAuthSpinner" class="loading-spinner hidden mx-auto"></div>
                    </button>
                </div>
            </div>
            
            <!-- Divider -->
            <div class="divider mt-6">
                <span class="divider-text">Ø£Ùˆ</span>
            </div>
            
            <!-- Google Sign-In Button -->
            <button onclick="handleGoogleLogin()" class="btn-google w-full py-3 rounded-xl font-bold mb-4 flex items-center justify-center gap-3">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 48 48">
                    <path fill="#FFC107" d="M43.611 20.083H42V20H24v8h11.303c-1.649 4.657-6.08 8-11.303 8-6.627 0-12-5.373-12-12s5.373-12 12-12c3.059 0 5.842 1.154 7.961 3.039l5.657-5.657C34.046 6.053 29.268 4 24 4 12.955 4 4 12.955 4 24s8.955 20 20 20 20-8.955 20-20c0-1.341-.138-2.65-.389-3.917z"/>
                    <path fill="#FF3D00" d="m6.306 14.691 6.571 4.819C14.655 15.108 18.961 12 24 12c3.059 0 5.842 1.154 7.961 3.039l5.657-5.657C34.046 6.053 29.268 4 24 4 16.318 4 9.656 8.337 6.306 14.691z"/>
                    <path fill="#4CAF50" d="M24 44c5.166 0 9.86-1.977 13.409-5.192l-6.19-5.238A11.91 11.91 0 0 1 24 36c-5.202 0-9.619-3.317-11.283-7.946l-6.522 5.025C9.505 39.556 16.227 44 24 44z"/>
                    <path fill="#1976D2" d="M43.611 20.083H42V20H24v8h11.303a12.04 12.04 0 0 1-4.087 5.571l.003-.002 6.19 5.238C36.971 39.205 44 34 44 24c0-1.341-.138-2.65-.389-3.917z"/>
                </svg>
                <span>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø­Ø³Ø§Ø¨ Ø¬ÙˆØ¬Ù„</span>
            </button>
            
            <!-- Additional Info -->
            <div class="mt-6 text-center text-sm text-gray-400">
                <p>Ø§Ù†Ø¶Ù… Ø¥Ù„Ù‰ Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ù…ÙÙƒØ±ÙŠÙ† ÙˆØ§Ù„Ù…Ø¨Ø¯Ø¹ÙŠÙ†</p>
                <div class="glass-card rounded-xl p-4 mt-4 space-y-2">
                    <div class="flex items-center justify-center gap-2 text-sm">
                        <span class="text-pink-300 font-bold">ğŸ’¡ ÙÙƒØ±Ø©:</span>
                        <span class="text-gray-300">Ø´Ø¹ÙŠØ¨ Ø³Ø¹Ø§Ø¯ Ø±Ø´Ø§</span>
                    </div>
                    <div class="flex items-center justify-center gap-2 text-sm">
                        <span class="text-purple-300 font-bold">ğŸ’» Ø¨Ø±Ù…Ø¬Ø©:</span>
                        <span class="text-gray-300">Ù…ÙØ¶Ù„</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Toast Container -->
    <div id="toastContainer" class="fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-80 z-50 space-y-2"></div>

    <script>
        // ============================================
        // Firebase Configuration - Ù…Ø¶Ø§ÙØ© Ù‡Ù†Ø§ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
        // ============================================
        const firebaseConfig = {
            apiKey: "AIzaSyAVp26636YGOwPIT8X6kWsxKWEnta3A0G4",
            authDomain: "ideas-museum.firebaseapp.com",
            projectId: "ideas-museum",
            storageBucket: "ideas-museum.firebasestorage.app",
            messagingSenderId: "776953892130",
            appId: "1:776953892130:web:b72d1a6e4c9b5f8290697b",
            measurementId: "G-FNKDJSJLE6"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        
        // Initialize Google Auth Provider
        const googleProvider = new firebase.auth.GoogleAuthProvider();
        
        // Email Mode State
        let emailMode = 'login'; // 'login' or 'register'

        // App State
        let appData = {
            users: [],
            ideas: [],
            content: [],
            suggestions: [],
            codes: []
        };
        let currentUser = null;

        // Admin Credentials
        const ADMINS = [
            { name: 'Rasha', specialty: '20250929' },
            { name: 'MUF', specialty: 'CS' }
        ];

        // Initialize App
        async function initApp() {
            try {
                // Set up auth state listener
                auth.onAuthStateChanged(async (user) => {
                    if (user) {
                        // User is signed in
                        await handleAuthenticatedUser(user);
                    } else {
                        // User is signed out
                        console.log('User signed out');
                    }
                });

                // Check for saved session
                const savedUser = localStorage.getItem('muf_user');
                if (savedUser) {
                    currentUser = JSON.parse(savedUser);
                    await loadAllData();
                    showMainApp();
                }

                // Render quotes
                renderQuotes();

            } catch (error) {
                console.error('Error initializing app:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚', 'error');
            }
        }

        // Switch between auth tabs
        function switchAuthTab(tab) {
            // Update tabs
            document.getElementById('tabTraditional').classList.remove('active');
            document.getElementById('tabEmail').classList.remove('active');
            document.getElementById(`tab${tab.charAt(0).toUpperCase() + tab.slice(1)}`).classList.add('active');
            
            // Update forms
            document.getElementById('traditionalLogin').classList.add('hidden');
            document.getElementById('emailLogin').classList.add('hidden');
            document.getElementById(`${tab}Login`).classList.remove('hidden');
            
            // Reset email mode to login
            if (tab === 'email') {
                emailMode = 'login';
                document.getElementById('emailToggleText').textContent = 'Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯';
                document.getElementById('emailAuthBtnText').textContent = 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
                document.getElementById('registerFields').classList.add('hidden');
                document.getElementById('emailLoginFields').classList.remove('hidden');
            }
        }

        // Toggle between login and register for email auth
        function toggleEmailMode() {
            if (emailMode === 'login') {
                // Switch to register
                emailMode = 'register';
                document.getElementById('emailToggleText').textContent = 'Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
                document.getElementById('emailAuthBtnText').textContent = 'Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨';
                document.getElementById('registerFields').classList.remove('hidden');
            } else {
                // Switch to login
                emailMode = 'login';
                document.getElementById('emailToggleText').textContent = 'Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯';
                document.getElementById('emailAuthBtnText').textContent = 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
                document.getElementById('registerFields').classList.add('hidden');
            }
        }

        // Handle Traditional Login
        async function handleTraditionalLogin() {
            const name = document.getElementById('loginName').value.trim();
            const specialty = document.getElementById('loginSpecialty').value.trim();
            
            if (!name) {
                showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', 'error');
                return;
            }
            
            const btnText = document.getElementById('traditionalLoginBtnText');
            const spinner = document.getElementById('traditionalLoginSpinner');
            
            btnText.classList.add('hidden');
            spinner.classList.remove('hidden');
            
            try {
                // Check if admin
                const isAdmin = ADMINS.some(a => a.name === name && a.specialty === specialty);
                
                // Check if using upgrade code
                const unusedCodes = appData.codes.filter(c => !c.usedBy);
                const usedCode = unusedCodes.find(c => c.code === specialty);
                
                let role = 'user';
                let upgradeCode = null;
                
                if (isAdmin) {
                    role = 'admin';
                } else if (usedCode) {
                    role = 'premium';
                    upgradeCode = specialty;
                    // Mark code as used
                    await db.collection('codes').doc(usedCode.id).update({
                        usedBy: name,
                        usedAt: new Date().toISOString()
                    });
                }
                
                // Check if user already exists
                let userDoc = await db.collection('users').where('name', '==', name).get();
                
                if (!userDoc.empty) {
                    // User exists, update if needed
                    const existingUser = userDoc.docs[0];
                    const userData = existingUser.data();
                    
                    if (upgradeCode && userData.role === 'user') {
                        await db.collection('users').doc(existingUser.id).update({
                            role: 'premium',
                            upgradeCode: upgradeCode
                        });
                        role = 'premium';
                    } else {
                        role = userData.role;
                        upgradeCode = userData.upgradeCode;
                    }
                    
                    currentUser = {
                        id: existingUser.id,
                        name: userData.name,
                        specialty: userData.specialty,
                        role: role,
                        upgradeCode: upgradeCode,
                        authMethod: 'traditional'
                    };
                } else {
                    // Create new user
                    const userData = {
                        name,
                        specialty: role === 'premium' ? 'Ø¹Ø¶Ùˆ Ù…Ù…ÙŠØ²' : (specialty || 'Ù…Ø³ØªØ®Ø¯Ù…'),
                        role,
                        upgradeCode: upgradeCode || '',
                        authMethod: 'traditional',
                        createdAt: new Date().toISOString()
                    };
                    
                    const docRef = await db.collection('users').add(userData);
                    currentUser = {
                        id: docRef.id,
                        ...userData
                    };
                }
                
                localStorage.setItem('muf_user', JSON.stringify(currentUser));
                await loadAllData();
                showMainApp();
                
                const roleText = role === 'admin' ? 'ğŸ‘‘ Ù…Ø¯ÙŠØ±' : role === 'premium' ? 'ğŸ’¡ Ø¹Ø¶Ùˆ Ù…Ù…ÙŠØ²' : 'ğŸ‘¤ Ø¹Ø¶Ùˆ';
                showToast(`Ù…Ø±Ø­Ø¨Ø§Ù‹ ${name}! ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒÙ€ ${roleText}`, 'success');
                
            } catch (error) {
                console.error('Traditional login error:', error);
                showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„', 'error');
            } finally {
                btnText.classList.remove('hidden');
                spinner.classList.add('hidden');
            }
        }

        // Handle Google Login
        async function handleGoogleLogin() {
            try {
                const result = await auth.signInWithPopup(googleProvider);
                // The user will be handled by onAuthStateChanged
            } catch (error) {
                console.error('Google login error:', error);
                
                // Handle specific Google auth errors
                let errorMessage = 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø­Ø³Ø§Ø¨ Ø¬ÙˆØ¬Ù„';
                switch (error.code) {
                    case 'auth/popup-closed-by-user':
                        errorMessage = 'ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
                        break;
                    case 'auth/cancelled-popup-request':
                        errorMessage = 'ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø·Ù„Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
                        break;
                    case 'auth/account-exists-with-different-credential':
                        errorMessage = 'Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„ Ø¨ÙˆØ³ÙŠÙ„Ø© ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ù…Ø®ØªÙ„ÙØ©';
                        break;
                }
                
                showToast(errorMessage, 'error');
            }
        }

        // Handle Email Authentication
        async function handleEmailAuth() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value.trim();
            
            if (!email || !password) {
                showToast('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', 'error');
                return;
            }
            
            if (password.length < 6) {
                showToast('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', 'error');
                return;
            }
            
            const btnText = document.getElementById('emailAuthBtnText');
            const spinner = document.getElementById('emailAuthSpinner');
            
            btnText.classList.add('hidden');
            spinner.classList.remove('hidden');
            
            try {
                if (emailMode === 'login') {
                    // Sign in with email
                    await auth.signInWithEmailAndPassword(email, password);
                } else {
                    // Register new user
                    const name = document.getElementById('registerName').value.trim();
                    const specialty = document.getElementById('registerSpecialty').value.trim();
                    
                    if (!name) {
                        showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', 'error');
                        btnText.classList.remove('hidden');
                        spinner.classList.add('hidden');
                        return;
                    }
                    
                    // Create user with email/password
                    const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                    
                    // Send email verification
                    await userCredential.user.sendEmailVerification();
                    
                    // Create user document in Firestore
                    const userData = {
                        name,
                        specialty: specialty || 'Ù…Ø³ØªØ®Ø¯Ù…',
                        role: 'user',
                        upgradeCode: '',
                        authMethod: 'email',
                        email: email,
                        emailVerified: false,
                        createdAt: new Date().toISOString()
                    };
                    
                    await db.collection('users').doc(userCredential.user.uid).set(userData);
                    
                    showToast('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­! ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ', 'success');
                    
                    // Reset form
                    document.getElementById('registerName').value = '';
                    document.getElementById('registerSpecialty').value = '';
                    document.getElementById('loginEmail').value = '';
                    document.getElementById('loginPassword').value = '';
                    
                    // Switch back to login mode
                    toggleEmailMode();
                }
            } catch (error) {
                console.error('Email auth error:', error);
                
                let errorMessage = 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©';
                switch (error.code) {
                    case 'auth/email-already-in-use':
                        errorMessage = 'Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„';
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± ØµØ§Ù„Ø­';
                        break;
                    case 'auth/weak-password':
                        errorMessage = 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¶Ø¹ÙŠÙØ©ØŒ ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„';
                        break;
                    case 'auth/user-not-found':
                        errorMessage = 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ';
                        break;
                    case 'auth/wrong-password':
                        errorMessage = 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©';
                        break;
                    case 'auth/too-many-requests':
                        errorMessage = 'ØªÙ… Ø¥Ø¬Ø±Ø§Ø¡ Ù…Ø­Ø§ÙˆÙ„Ø§Øª ÙƒØ«ÙŠØ±Ø©ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹';
                        break;
                }
                
                showToast(errorMessage, 'error');
            } finally {
                btnText.classList.remove('hidden');
                spinner.classList.add('hidden');
            }
        }

        // Handle authenticated user from Firebase Auth
        async function handleAuthenticatedUser(firebaseUser) {
            try {
                // Check if user exists in our users collection
                const userDoc = await db.collection('users').doc(firebaseUser.uid).get();
                
                if (userDoc.exists) {
                    // Existing user
                    const userData = userDoc.data();
                    currentUser = {
                        id: firebaseUser.uid,
                        ...userData,
                        email: firebaseUser.email,
                        emailVerified: firebaseUser.emailVerified,
                        photoURL: firebaseUser.photoURL,
                        authMethod: userData.authMethod || 'email'
                    };
                    
                    // Update last login time
                    await db.collection('users').doc(firebaseUser.uid).update({
                        lastLogin: new Date().toISOString()
                    });
                } else {
                    // New user from Google or Email
                    let name = '';
                    let specialty = 'Ù…Ø³ØªØ®Ø¯Ù…';
                    
                    if (firebaseUser.providerData[0].providerId === 'google.com') {
                        // Google user
                        name = firebaseUser.displayName || firebaseUser.email.split('@')[0];
                    } else {
                        // Email user
                        name = firebaseUser.email.split('@')[0];
                    }
                    
                    // Create user document
                    const userData = {
                        name,
                        specialty,
                        role: 'user',
                        upgradeCode: '',
                        authMethod: firebaseUser.providerData[0].providerId,
                        email: firebaseUser.email,
                        emailVerified: firebaseUser.emailVerified,
                        photoURL: firebaseUser.photoURL,
                        createdAt: new Date().toISOString(),
                        lastLogin: new Date().toISOString()
                    };
                    
                    await db.collection('users').doc(firebaseUser.uid).set(userData);
                    currentUser = {
                        id: firebaseUser.uid,
                        ...userData
                    };
                }
                
                localStorage.setItem('muf_user', JSON.stringify(currentUser));
                await loadAllData();
                showMainApp();
                
                const roleText = currentUser.role === 'admin' ? 'ğŸ‘‘ Ù…Ø¯ÙŠØ±' : 
                                currentUser.role === 'premium' ? 'ğŸ’¡ Ø¹Ø¶Ùˆ Ù…Ù…ÙŠØ²' : 'ğŸ‘¤ Ø¹Ø¶Ùˆ';
                showToast(`Ù…Ø±Ø­Ø¨Ø§Ù‹ ${currentUser.name}! ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒÙ€ ${roleText}`, 'success');
                
            } catch (error) {
                console.error('Error handling authenticated user:', error);
                showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', 'error');
            }
        }

        // Load all data from Firestore
        async function loadAllData() {
            try {
                const promises = [
                    db.collection('users').get(),
                    db.collection('ideas').get(),
                    db.collection('content').get(),
                    db.collection('suggestions').get(),
                    db.collection('codes').get()
                ];

                const results = await Promise.all(promises);

                appData = {
                    users: results[0].docs.map(doc => ({ id: doc.id, ...doc.data() })),
                    ideas: results[1].docs.map(doc => ({ id: doc.id, ...doc.data() })),
                    content: results[2].docs.map(doc => ({ id: doc.id, ...doc.data() })),
                    suggestions: results[3].docs.map(doc => ({ id: doc.id, ...doc.data() })),
                    codes: results[4].docs.map(doc => ({ id: doc.id, ...doc.data() }))
                };

                // Set up real-time listeners
                setupRealtimeListeners();

            } catch (error) {
                console.error('Error loading data:', error);
                showToast('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
            }
        }

        // Set up real-time listeners
        function setupRealtimeListeners() {
            // Listen for users changes
            db.collection('users').onSnapshot((snapshot) => {
                appData.users = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                updateUI();
            });

            // Listen for ideas changes
            db.collection('ideas').onSnapshot((snapshot) => {
                appData.ideas = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                updateUI();
            });

            // Listen for content changes
            db.collection('content').onSnapshot((snapshot) => {
                appData.content = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                updateUI();
            });

            // Listen for suggestions changes
            db.collection('suggestions').onSnapshot((snapshot) => {
                appData.suggestions = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                updateUI();
            });

            // Listen for codes changes
            db.collection('codes').onSnapshot((snapshot) => {
                appData.codes = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                updateUI();
            });
        }

        // Logout Handler
        async function handleLogout() {
            try {
                // Sign out from Firebase if using email/google auth
                if (currentUser.authMethod === 'email' || currentUser.authMethod === 'google.com') {
                    await auth.signOut();
                }
                
                currentUser = null;
                localStorage.removeItem('muf_user');
                document.getElementById('mainApp').classList.add('hidden');
                document.getElementById('loginScreen').classList.remove('hidden');
                
                // Reset form fields
                document.getElementById('loginName').value = '';
                document.getElementById('loginSpecialty').value = '';
                document.getElementById('loginEmail').value = '';
                document.getElementById('loginPassword').value = '';
                document.getElementById('registerName').value = '';
                document.getElementById('registerSpecialty').value = '';
                
                // Switch to traditional login tab
                switchAuthTab('traditional');
                
                showToast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            } catch (error) {
                console.error('Logout error:', error);
                showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬', 'error');
            }
        }

        // Show Main App
        function showMainApp() {
            document.getElementById('loginScreen').classList.add('hidden');
            
            // Create main app if it doesn't exist
            if (!document.getElementById('mainApp')) {
                // We would need to create the main app structure here
                // For now, just show a simple message
                const mainAppHTML = `
                    <div id="mainApp" class="h-full w-full flex flex-col items-center justify-center p-8">
                        <div class="glass-card rounded-3xl p-8 max-w-md text-center">
                            <h2 class="text-2xl font-bold mb-4">Ù…Ø±Ø­Ø¨Ø§Ù‹ ${currentUser.name}!</h2>
                            <p class="text-gray-400 mb-4">ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… ${getAuthMethodName(currentUser.authMethod)}</p>
                            <p class="mb-2">ğŸ“§ Ø§Ù„Ø¨Ø±ÙŠØ¯: ${currentUser.email || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                            <p class="mb-2">ğŸ¯ Ø§Ù„Ø¯ÙˆØ±: ${currentUser.role}</p>
                            <p class="mb-6">ğŸ” Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„: ${getAuthMethodName(currentUser.authMethod)}</p>
                            <button onclick="handleLogout()" class="btn-primary px-6 py-3 rounded-xl">
                                ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
                            </button>
                        </div>
                    </div>
                `;
                document.body.insertAdjacentHTML('beforeend', mainAppHTML);
            } else {
                document.getElementById('mainApp').classList.remove('hidden');
            }
        }

        // Helper function to get auth method name
        function getAuthMethodName(method) {
            const methods = {
                'traditional': 'Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„ØªÙ‚Ù„ÙŠØ¯ÙŠ',
                'email': 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ',
                'google.com': 'Ø­Ø³Ø§Ø¨ Ø¬ÙˆØ¬Ù„',
                'password': 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±'
            };
            return methods[method] || method;
        }

        // Render Quotes (placeholder)
        function renderQuotes() {
            // Implementation depends on your quotes system
        }

        // Update UI (placeholder)
        function updateUI() {
            // Implementation depends on your UI
        }

        // Show Toast Notification
        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            const colors = {
                success: 'bg-green-500/90',
                error: 'bg-red-500/90',
                info: 'bg-pink-500/90'
            };
            const icons = {
                success: 'âœ…',
                error: 'âŒ',
                info: 'â„¹ï¸'
            };
            
            toast.className = `toast ${colors[type]} backdrop-blur-sm rounded-xl px-4 py-3 flex items-center gap-3 shadow-lg`;
            toast.innerHTML = `<span class="text-xl">${icons[type]}</span><span>${message}</span>`;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transition = 'opacity 0.3s';
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
